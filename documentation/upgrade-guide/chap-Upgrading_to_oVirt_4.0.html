<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie10 lt-ie9 lt-ie8 lt-ie7" lang="en-us"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie10 lt-ie9 lt-ie8" lang="en-us"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie10 lt-ie9" lang="en-us"> <![endif]-->
<!--[if IE 9]> <html class="no-js lt-ie10 lt-ie9" lang="en-us"> <![endif]-->
<!--[if lt IE 10]> <html class="no-js lt-ie10" lang="en-us"> <![endif]-->
<!--[if !IE]> > <![endif]-->
<html class='no-js' lang='en'>
<!-- <![endif] -->
<head>
<title>
Upgrading to oVirt 4.0 &mdash;
oVirt
</title>
<meta charset='utf-8'>
<meta content='' name='description'>
<meta content='' name='author'>
<meta content='initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width' name='viewport'>

<link href='/images/favicon.ico' rel='shortcut icon'>
<link href='/images/apple-touch-icon-precomposed.png' rel='apple-touch-icon-precomposed'>
<link href='/images/apple-touch-icon-57x57-precomposed.png' rel='apple-touch-icon-precomposed' sizes='57x57'>
<link href='/images/apple-touch-icon-72x72-precomposed.png' rel='apple-touch-icon-precomposed' sizes='72x72'>
<link href='/images/apple-touch-icon-114x114-precomposed.png' rel='apple-touch-icon-precomposed' sizes='114x114'>
<link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet'>
<link href="/stylesheets/application.css?1560777611" rel="stylesheet" type="text/css" />
<link href="/stylesheets/print.css?1560777612" rel="stylesheet" type="text/css" media="print" />
</head>
<body class=' source-md'>
<header class='masthead hidden-print' id='branding' role='banner'>
<section class='hgroup'></section>
<div id='access'>
<nav id="mainNav" class="navbar-fixed-top affix-top navForMobileHack" style="font-family: 'Open Sans', sans-serif; display: flex; justify-content: center;">
      <a href="/"><img id="logo" style="float: left; margin-right: 70px; height: 40px; padding: 0; margin-top: 12px;" alt="oVirt" src="/images/logo.svg"></a>
      <div>
          <div class="navbar-header page-scroll" style="min-width: 170px">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#menu_id0980fddf">
                  <span class="sr-only">Toggle navigation</span> Menu <i class="fa fa-bars"></i>
              </button>
          </div>

          <!-- Collect the nav links, forms, and other content for toggling -->
          <div class="collapse navbar-collapse" id="menu_id0980fddf">

              <ul class="nav navbar-nav">
                  <li class="hidden active">
                      <a href="#page-top"></a>
                  </li>
<li role='menuitem'>
  <a href='/'>Home</a>
</li>

<li role='menuitem'>
  <a href='/download/'>Download</a>
</li>

<li role='menuitem'>
  <a href='/documentation/'>Documentation</a>
</li>

<li role='menuitem'>
  <a href='/develop/'>Developers</a>
</li>

<li role='menuitem'>
  <a href='/community/'>Community</a>
</li>

<li role='menuitem'>
  <a href='//lists.ovirt.org/archives/'>Forum</a>
</li>

<li role='menuitem'>
  <a href='/blog/'>Blog</a>
</li>

              </ul>
          </div>
          <!-- /.navbar-collapse -->
      </div>
      <!-- /.container-fluid -->
  </nav>

</div>
</header>

<section class='page-wrap' id='page-wrap'>
<section class='page' id='page'>
<ul class='breadcrumb'>
<li><a href="/documentation/">Documentation</a></li>
<li><a href="/documentation/upgrade-guide/">Upgrade-guide</a></li>
</ul>

<section class='container content' id='content'>
<!--[if lt IE 7]>
<p class="chromeframe">You are using an outdated browser.
<a href="http://browsehappy.com/">Upgrade your browser today</a> or
<a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
<![endif]-->
<h1 id="chapter-3-upgrading-to-ovirt-40">Chapter 3: Upgrading to oVirt 4.0</h1>

<h2 id="ovirt-40-upgrade-considerations">oVirt 4.0 Upgrade Considerations</h2>

<p>The following is a list of key considerations that must be made when planning your upgrade.</p>

<p><strong>Upgrading to version 4.0 can only be performed from version 3.6</strong></p>

<p>To upgrade a version of oVirt earlier than 3.6 to oVirt 4.0, you must sequentially upgrade to any newer versions of oVirt before upgrading to the latest version. For example, if you are using oVirt 3.5, you must upgrade to the latest minor version of oVirt 3.6 before you can upgrade to oVirt 4.0. See the <a href="/documentation/upgrade-guide/upgrade-guide/">Upgrade Guide</a> for oVirt 3.6 for instructions to upgrade to the latest 3.6 minor version.</p>

<p>The data center and cluster compatibility version must be at version 3.6 before performing the upgrade.</p>

<p><strong>oVirt Engine 4.0 is supported to run on Red Hat Enterprise Linux 7.2</strong></p>

<p>Upgrading to version 4.0 involves also upgrading the base operating system of the machine that hosts the Engine.</p>

<h2 id="upgrading-to-ovirt-engine-40">Upgrading to oVirt Engine 4.0</h2>

<p>oVirt Engine 4.0 is only supported on Red Hat Enterprise Linux 7. A clean installation of Red Hat Enterprise Linux 7 and oVirt Engine 4.0 is required, even if you are using the same physical machine used to run oVirt Engine 3.6. The upgrade process involves restoring oVirt Engine 3.6 backup files onto the oVirt Engine 4.0 machine.</p>

<p><strong>Important:</strong> All data centers and clusters in the environment must have the cluster compatibility level set to version 3.6 before attempting the procedure.</p>

<p>After the Engine has been upgraded, you can upgrade the hosts. See <a href="chap-Updates_between_Minor_Releases">Chapter 2: Updates between Minor Releases</a>. Then the cluster compatibility level can be updated to 4.0. See <a href="chap-Post-Upgrade_Tasks">Chapter 4: Post-Upgrade Tasks</a>.</p>

<p><strong>Note:</strong> Connected hosts and virtual machines can continue to work while the Engine is being upgraded.</p>

<p>If the Engine has a different IP address or FQDN after the upgrade, use <code>ovirt-engine-rename</code> to rename the Engine.</p>

<p>If any optional extension packages, such as <code>ovirt-engine-extension-aaa-ldap</code>, <code>ovirt-engine-extension-aaa-misc</code>, or <code>ovirt-engine-extension-logger-log4j</code> are installed on oVirt Engine 3.6, these will need to be installed on the upgraded Engine before running <code>engine-setup</code>. The settings for these package extensions are not migrated as part of the upgrade.</p>

<p><strong>Upgrading to oVirt Engine 4.0</strong></p>

<ol>
  <li>
    <p>On oVirt Engine 3.6, back up the environment.</p>

<div class="highlight"><pre class="highlight plaintext"><code> # engine-backup --scope=all --mode=backup --file=backup.bck --log=backuplog.log&#x000A;</code></pre></div>  </li>
  <li>
    <p>Copy the backup file to a suitable device.</p>
  </li>
  <li>
    <p>Install Enterprise Linux 7.</p>
  </li>
  <li>
    <p>Install oVirt Engine 4.0. See the <a href="/documentation/install-guide/Installation_Guide/">Installation Guide</a>.</p>
  </li>
  <li>
    <p>Copy the backup file to the oVirt Engine 4.0 machine and restore the backup.</p>

<div class="highlight"><pre class="highlight plaintext"><code> # engine-backup --mode=restore --file=backup.bck --log=restore.log --provision-db --provision-dwh-db --restore-permissions&#x000A;</code></pre></div>
    <p><strong>Note:</strong> If the backup contained grants for extra database users, this command will create the extra users with random passwords. You must change these passwords manually if the extra users require access to the restored system. See <a href="https://access.redhat.com/articles/2686731">https://access.redhat.com/articles/2686731</a>.</p>

    <p><strong>Note:</strong> Use the <code>--provision-dwh-db</code> option if the backup contains Data Warehouse data.</p>

    <p>Reports have been deprecated in oVirt 4.0 and will not be restored. See <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1340810">BZ#1340810</a> for more information.</p>
  </li>
  <li>
    <p>Install optional extension packages if they were installed on the oVirt Engine 3.6 machine.</p>

<div class="highlight"><pre class="highlight plaintext"><code> # yum install ovirt-engine-extension-aaa-ldap ovirt-engine-extension-aaa-misc ovirt-engine-extension-logger-log4j&#x000A;</code></pre></div>
    <p><strong>Note:</strong> The configuration for these package extensions must be manually reapplied because they are not migrated as part of the backup and restore process.</p>
  </li>
  <li>
    <p>Decommission the oVirt Engine 3.6 machine if a different machine is used for oVirt Engine 4.0.</p>
  </li>
  <li>
    <p>Run <code>engine-setup</code> to configure the Engine.</p>

<div class="highlight"><pre class="highlight plaintext"><code> # engine-setup&#x000A;</code></pre></div>  </li>
  <li>
    <p>Run <code>ovirt-engine-rename</code> to rename the Engine if the IP address or FQDN differs from the oVirt Engine 3.6 machine, and follow the prompts to set the new details.</p>

<div class="highlight"><pre class="highlight plaintext"><code> # /usr/share/ovirt-engine/setup/bin/ovirt-engine-rename&#x000A;</code></pre></div>  </li>
</ol>

<p><strong>Note:</strong> If you use external CA to sign HTTPS certificates, follow the steps in "Replacing the oVirt Engine SSL Certificate" in the <a href="/documentation/admin-guide/administration-guide/">Administration Guide</a> to log in to the Administration portal after the upgrade. Ensure the CA certificate is added to system-wide trust stores of all clients to ensure the foreign menu of virt-viewer works.</p>

<p>Before updating the Red Hat Enterprise Linux hosts in the environment, disable the version 3.6 repositories and enable the required 4.0 repository.</p>

<p>oVirt Node hosts must be reinstalled with oVirt Node 4.0. See "oVirt Nodes" in the <a href="/documentation/install-guide/Installation_Guide/">Installation Guide</a>.</p>

<p>You may now update the hosts, then change the cluster and data center compatibility version to 4.0.</p>

<h2 id="upgrading-the-self-hosted-engine">Upgrading the Self-Hosted Engine</h2>

<p>To upgrade a Red Hat Enterprise Linux-based self-hosted environment, see "Upgrading an Enterprise Linux-Based Self-Hosted Engine Environment" in the <a href="/documentation/self-hosted/Self-Hosted_Engine_Guide/">Self-Hosted Engine Guide</a>.</p>

<p>To upgrade an oVirt Hypervisor-based self-hosted environment to an oVirt Node-based self-hosted environment, see "Upgrading an oVirt Node-Based Self-Hosted Engine Environment" in the <a href="/documentation/self-hosted/Self-Hosted_Engine_Guide/">Self-Hosted Engine Guide</a>.</p>

<p><strong>Prev:</strong> <a href="chap-Updates_between_Minor_Releases">Chapter 2: Updates Between Minor Releases</a> <br />
<strong>Next:</strong> <a href="chap-Post-Upgrade_Tasks">Chapter 4: Post-Upgrade Tasks</a></p>

</section>
</section>
</section>
<footer class='text-center' id='footer'>
<hr class='visible-print'>
<ul class='footer-nav-list'>
<li><a target="_blank" href="../../site/privacy-policy.html">Privacy policy</a></li>
<li><a target="_blank" href="../../community/about.html">About</a></li>
<li><a target="_blank" href="../../site/general-disclaimer.html">Disclaimers</a></li>
</ul>

&copy; 2013&ndash;2019 oVirt
<div class='edit-this-page'>
<a target="_blank" href="https://github.com/oVirt/ovirt-site/issues/new?labels=documentation&amp;title=Issue:%20/source/documentation/upgrade-guide/chap-Upgrading_to_oVirt_4.0.html.md&amp;template=issue_template_documentation.md"><i class="icon fa fa-github"></i>Report an issue with this page</a>
</div>
<div class='edit-this-page'>
<a target="_blank" href="https://github.com/oVirt/ovirt-site/edit/master/source/documentation/upgrade-guide/chap-Upgrading_to_oVirt_4.0.html.md"><i class="icon fa fa-github"></i>Edit this page</a>
</div>
<div class='last-modified'>
Page last modified
Sun 16 Dec 2018 00:48 UTC
</div>
        <script type="text/javascript">
        var _paq = _paq || [];
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
        var u=(("https:" == document.location.protocol) ? "https" : "http") + "://stats.phx.ovirt.org/";
        _paq.push(['setTrackerUrl', u+'piwik.php']);
        _paq.push(['setSiteId', 1]);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0]; g.type='text/javascript';
        g.defer=true; g.async=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
        })();
        </script>
<noscript><p><img src="https://stats.phx.ovirt.org/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
</footer>


<script src="/javascripts/application.js?1560777657" type="text/javascript"></script>

</body>
</html>
