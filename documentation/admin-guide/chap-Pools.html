<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie10 lt-ie9 lt-ie8 lt-ie7" lang="en-us"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie10 lt-ie9 lt-ie8" lang="en-us"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie10 lt-ie9" lang="en-us"> <![endif]-->
<!--[if IE 9]> <html class="no-js lt-ie10 lt-ie9" lang="en-us"> <![endif]-->
<!--[if lt IE 10]> <html class="no-js lt-ie10" lang="en-us"> <![endif]-->
<!--[if !IE]> > <![endif]-->
<html class='no-js' lang='en'>
<!-- <![endif] -->
<head>
<title>
Pools &mdash;
oVirt
</title>
<meta charset='utf-8'>
<meta content='' name='description'>
<meta content='' name='author'>
<meta content='initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width' name='viewport'>

<link href='/images/favicon.ico' rel='shortcut icon'>
<link href='/images/apple-touch-icon-precomposed.png' rel='apple-touch-icon-precomposed'>
<link href='/images/apple-touch-icon-57x57-precomposed.png' rel='apple-touch-icon-precomposed' sizes='57x57'>
<link href='/images/apple-touch-icon-72x72-precomposed.png' rel='apple-touch-icon-precomposed' sizes='72x72'>
<link href='/images/apple-touch-icon-114x114-precomposed.png' rel='apple-touch-icon-precomposed' sizes='114x114'>
<link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet'>
<link href="/stylesheets/application.css?1560777611" rel="stylesheet" type="text/css" />
<link href="/stylesheets/print.css?1560777612" rel="stylesheet" type="text/css" media="print" />
</head>
<body class=' source-md'>
<header class='masthead hidden-print' id='branding' role='banner'>
<section class='hgroup'></section>
<div id='access'>
<nav id="mainNav" class="navbar-fixed-top affix-top navForMobileHack" style="font-family: 'Open Sans', sans-serif; display: flex; justify-content: center;">
      <a href="/"><img id="logo" style="float: left; margin-right: 70px; height: 40px; padding: 0; margin-top: 12px;" alt="oVirt" src="/images/logo.svg"></a>
      <div>
          <div class="navbar-header page-scroll" style="min-width: 170px">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#menu_id0980fddf">
                  <span class="sr-only">Toggle navigation</span> Menu <i class="fa fa-bars"></i>
              </button>
          </div>

          <!-- Collect the nav links, forms, and other content for toggling -->
          <div class="collapse navbar-collapse" id="menu_id0980fddf">

              <ul class="nav navbar-nav">
                  <li class="hidden active">
                      <a href="#page-top"></a>
                  </li>
<li role='menuitem'>
  <a href='/'>Home</a>
</li>

<li role='menuitem'>
  <a href='/download/'>Download</a>
</li>

<li role='menuitem'>
  <a href='/documentation/'>Documentation</a>
</li>

<li role='menuitem'>
  <a href='/develop/'>Developers</a>
</li>

<li role='menuitem'>
  <a href='/community/'>Community</a>
</li>

<li role='menuitem'>
  <a href='//lists.ovirt.org/archives/'>Forum</a>
</li>

<li role='menuitem'>
  <a href='/blog/'>Blog</a>
</li>

              </ul>
          </div>
          <!-- /.navbar-collapse -->
      </div>
      <!-- /.container-fluid -->
  </nav>

</div>
</header>

<section class='page-wrap' id='page-wrap'>
<section class='page' id='page'>
<ul class='breadcrumb'>
<li><a href="/documentation/">Documentation</a></li>
<li><a href="/documentation/admin-guide/">Admin-guide</a></li>
</ul>

<section class='container content' id='content'>
<!--[if lt IE 7]>
<p class="chromeframe">You are using an outdated browser.
<a href="http://browsehappy.com/">Upgrade your browser today</a> or
<a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
<![endif]-->
<h1 id="chapter-9-pools">Chapter 9: Pools</h1>

<h2 id="introduction-to-virtual-machine-pools">Introduction to Virtual Machine Pools</h2>

<p>A virtual machine pool is a group of virtual machines that are all clones of the same template and that can be used on demand by any user in a given group. Virtual machine pools allow administrators to rapidly configure a set of generalized virtual machines for users.</p>

<p>Users access a virtual machine pool by taking a virtual machine from the pool. When a user takes a virtual machine from a pool, they are provided with any one of the virtual machines in the pool if any are available. That virtual machine will have the same operating system and configuration as that of the template on which the pool was based, but users may not receive the same member of the pool each time they take a virtual machine. Users can also take multiple virtual machines from the same virtual machine pool depending on the configuration of that pool.</p>

<p>Virtual machines in a virtual machine pool are stateless, meaning that data is not persistent across reboots. However, if a user configures console options for a virtual machine taken from a virtual machine pool, those options will be set as the default for that user for that virtual machine pool.</p>

<p><strong>Note:</strong> Virtual machines taken from a pool are not stateless when accessed from the Administration Portal. This is because administrators need to be able to write changes to the disk if necessary.</p>

<p>In principle, virtual machines in a pool are started when taken by a user, and shut down when the user is finished. However, virtual machine pools can also contain pre-started virtual machines. Pre-started virtual machines are kept in an up state, and remain idle until they are taken by a user. This allows users to start using such virtual machines immediately, but these virtual machines will consume system resources even while not in use due to being idle.</p>

<h2 id="creating-a-virtual-machine-pool">Creating a Virtual Machine Pool</h2>

<p>You can create a virtual machine pool that contains multiple virtual machines that have been created based on a common template.</p>

<p><strong><tt>Sysprep</tt> File Configuration Options for Windows Virtual Machines</strong></p>

<p>Several <code>sysprep</code> file configuration options are available, depending on your requirements.</p>

<p>If your pool does not need to join a domain, you can use the default <code>sysprep</code> file, located in <code>/usr/share/ovirt-engine/conf/sysprep/</code>.</p>

<p>If your pool needs to join a domain, you can create a custom <code>sysprep</code> for each Windows operating system:</p>

<ol>
  <li>
    <p>Copy the relevant sections for each operating system from <code>/usr/share/ovirt-engine/conf/osinfo-defaults.properties</code> to a new file and save as <code>99-defaults.properties</code>.</p>
  </li>
  <li>
    <p>In <code>99-defaults.properties</code>, specify the Windows product activation key and the path of your new custom <code>sysprep</code> file:</p>

<div class="highlight"><pre class="highlight plaintext"><code> os.operating_system.productKey.value=Windows_product_activation_key&#x000A; ...&#x000A; os.operating_system.sysprepPath.value = ${ENGINE_USR}/conf/sysprep/sysprep.operating_system&#x000A;</code></pre></div>  </li>
  <li>
    <p>Create a new <code>sysprep</code> file, specifying the domain, domain password, and domain administrator:</p>

<div class="highlight"><pre class="highlight plaintext"><code>     &lt;Credentials&gt;&#x000A;       &lt;Domain&gt;AD_Domain&lt;/Domain&gt;&#x000A;       &lt;Password&gt;Domain_Password&lt;/Password&gt;&#x000A;       &lt;Username&gt;Domain_Administrator&lt;/Username&gt;&#x000A;     &lt;/Credentials&gt;&#x000A;</code></pre></div>  </li>
</ol>

<p>If you need to configure different sysprep settings for different pools of Windows virtual machines, you can create a custom sysprep file in the Administration Portal (see "Creating a Virtual Machine Pool" below).</p>

<p><strong>Creating a Virtual Machine Pool</strong></p>

<ol>
  <li>
    <p>Click <strong>Compute</strong> → <strong>Pools</strong>.</p>
  </li>
  <li>
    <p>Click <strong>New</strong>.</p>
  </li>
  <li>
    <p>Select a <strong>Cluster</strong> from the drop-down list.</p>
  </li>
  <li>
    <p>Select a <strong>Template</strong> and version from the drop-down menu. A template provides standard settings for all the virtual machines in the pool.</p>
  </li>
  <li>
    <p>Select an <strong>Operating System</strong> from the drop-down list.</p>
  </li>
  <li>
    <p>Use the <strong>Optimized for</strong> drop-down list to optimize virtual machines for <strong>Desktop</strong> or <strong>Server</strong>.</p>

    <p><strong>Note:</strong> <strong>High Performance</strong> optimization is not recommended for pools because a high performance virtual machine is pinned to a single host and concrete resources. A pool containing multiple virtual machines with such a configuration would not run well.</p>
  </li>
  <li>
    <p>Enter a <strong>Name</strong> and, optionally, a <strong>Description</strong> and <strong>Comment</strong>.</p>

    <p>The <strong>Name</strong> of the pool is applied to each virtual machine in the pool, with a numeric suffix. You can customize the numbering of the virtual machines with <code>?</code> as a placeholder.</p>

    <p><strong>Pool Name and Virtual Machine Numbering Examples</strong></p>

    <ul>
      <li>
        <p>Pool: <code>MyPool</code></p>

        <p>Virtual machines: <code>MyPool-1</code>, <code>MyPool-2</code>, …​ <code>MyPool-10</code></p>
      </li>
      <li>
        <p>Pool: <code>MyPool-???</code></p>

        <p>Virtual machines: <code>MyPool-001</code>, <code>MyPool-002</code>, …​ <code>MyPool-010</code></p>
      </li>
    </ul>
  </li>
  <li>
    <p>Enter the <strong>Number of VMs</strong> for the pool.</p>
  </li>
  <li>
    <p>Enter the number of virtual machines to be prestarted in the <strong>Prestarted VMs</strong> field.</p>
  </li>
  <li>
    <p>Select the <strong>Maximum number of VMs per user</strong> that a single user is allowed to run in a session. The minimum is <strong>1</strong>.</p>
  </li>
  <li>
    <p>Select the <strong>Delete Protection</strong> check box to enable delete protection.</p>
  </li>
  <li>
    <p>If you are creating a pool of non-Windows virtual machines or if you are using the default <code>sysprep</code>, skip this step. If you are creating a custom <code>sysprep</code> file for a pool of Windows virtual machines:</p>

    <p>i. Click the <strong>Show Advanced Options</strong> button.</p>

    <p>ii. Click the <strong>Initial Run</strong> tab and select the <strong>Use Cloud-Init/Sysprep</strong> check box.</p>

    <p>iii. Click the <strong>Authentication</strong> arrow and enter the <strong>User Name</strong> and <strong>Password</strong> or select <strong>Use already configured password</strong>.</p>

    <p><strong>Note:</strong> This <code>User Name</code> is the name of the local administrator. You can change its value from its default value (<code>user</code>) here in the <strong>Authentication</strong> section or in a custom <code>sysprep</code> file.</p>

    <p>iv. Click the <strong>Custom Script</strong> arrow and paste the contents of the default <code>sysprep</code> file, located in <code>/usr/share/ovirt-engine/conf/sysprep/</code>, into the text box.</p>

    <p>v. You can modify the following values of the <code>sysprep</code> file:</p>

    <ul>
      <li>
        <p><code>Key</code>. If you do not want to use the pre-defined Windows activation product key, replace <code>&lt;![CDATA[$ProductKey$]]&gt;</code> with a valid product key:</p>

<div class="highlight"><pre class="highlight plaintext"><code>&lt;ProductKey&gt;&#x000A;    &lt;Key&gt;&lt;![CDATA[$ProductKey$]]&gt;&lt;/Key&gt;&#x000A;&lt;/ProductKey&gt;&#x000A;</code></pre></div>
        <p><strong>Windows Product Key Example</strong></p>

<div class="highlight"><pre class="highlight plaintext"><code>&lt;ProductKey&gt;&#x000A;    &lt;Key&gt;0000-000-000-000&lt;/Key&gt;&#x000A;&lt;/ProductKey&gt;&#x000A;</code></pre></div>      </li>
      <li>
        <p><code>Domain</code> that the Windows virtual machines will join, the domain’s <code>Password</code>, and the domain administrator’s <code>Username</code>:</p>

<div class="highlight"><pre class="highlight plaintext"><code>&lt;Credentials&gt;&#x000A;    &lt;Domain&gt;AD_Domain&lt;/Domain&gt;&#x000A;    &lt;Password&gt;Domain_Password&lt;/Password&gt;&#x000A;    &lt;Username&gt;Domain_Administrator&lt;/Username&gt;&#x000A;&lt;/Credentials&gt;&#x000A;</code></pre></div>
        <p><strong>Domain Credentials Example</strong></p>

<div class="highlight"><pre class="highlight plaintext"><code>&lt;Credentials&gt;&#x000A;    &lt;Domain&gt;addomain.local&lt;/Domain&gt;&#x000A;    &lt;Password&gt;12345678&lt;/Password&gt;&#x000A;    &lt;Username&gt;Sarah_Smith&lt;/Username&gt;&#x000A;&lt;/Credentials&gt;&#x000A;</code></pre></div>
        <p><strong>Note:</strong> The <code>Domain</code>, <code>Password</code>, and <code>Username</code> are required to join the domain. The <code>Key</code> is for activation. You do not necessarily need both.</p>

        <p>The domain and credentials cannot be modified in the <strong>Initial Run</strong> tab.</p>
      </li>
      <li>
        <p><code>FullName</code> of the local administrator:</p>

<div class="highlight"><pre class="highlight plaintext"><code>&lt;UserData&gt;&#x000A;    ...&#x000A;    &lt;FullName&gt;Local_Administrator&lt;/FullName&gt;&#x000A;    ...&#x000A;&lt;/UserData&gt;&#x000A;</code></pre></div>      </li>
      <li>
        <p><code>DisplayName</code> and <code>Name</code> of the local administrator:</p>

<div class="highlight"><pre class="highlight plaintext"><code>&lt;LocalAccounts&gt;&#x000A;    &lt;LocalAccount wcm:action="add"&gt;&#x000A;        &lt;Password&gt;&#x000A;            &lt;Value&gt;&lt;![CDATA[$AdminPassword$]]&gt;&lt;/Value&gt;&#x000A;            &lt;PlainText&gt;true&lt;/PlainText&gt;&#x000A;        &lt;/Password&gt;&#x000A;        &lt;DisplayName&gt;Local_Administrator&lt;/DisplayName&gt;&#x000A;        &lt;Group&gt;administrators&lt;/Group&gt;&#x000A;        &lt;Name&gt;Local_Administrator&lt;/Name&gt;&#x000A;    &lt;/LocalAccount&gt;&#x000A;&lt;/LocalAccounts&gt;&#x000A;</code></pre></div>      </li>
    </ul>
  </li>
</ol>

<p>The remaining variables in the <code>sysprep</code> file can be filled in on the <strong>Initial Run</strong> tab.</p>

<ol>
  <li>
    <p>Optionally, set a <strong>Pool Type</strong>:</p>

    <p>i. Click the <strong>Type</strong> tab and select a <strong>Pool Type</strong>:</p>

    <ul>
      <li>
        <p><strong>Manual</strong> - The administrator is responsible for explicitly returning the virtual machine to the pool. The virtual machine reverts to the original base image after the administrator returns it to the pool.</p>
      </li>
      <li>
        <p><strong>Automatic</strong> - When the virtual machine is shut down, it automatically reverts to its base image and is returned to the virtual machine pool.</p>
      </li>
    </ul>

    <p>ii. Select the <strong>Stateful Pool</strong> check box to ensure that virtual machines are started in a stateful mode. This ensures that changes made by a previous user will persist on a virtual machine.</p>

    <p>iii. Click <strong>OK</strong>.</p>
  </li>
  <li>
    <p>Optionally, override the SPICE proxy:</p>

    <p>i. In the <strong>Console</strong> tab, select the <strong>Override SPICE Proxy</strong> check box</p>

    <p>ii. In the <strong>Overridden SPICE proxy address</strong> text field, specify the address of a SPICE proxy to override the global SPICE proxy.</p>

    <p>iii. Click <strong>OK</strong>.</p>
  </li>
  <li>
    <p>For a pool of Windows virtual machines, click <strong>Compute</strong> → <strong>Virtual Machines</strong>, select each virtual machine from the pool, and click <strong>Run</strong> → <strong>Run Once</strong>.</p>

    <p><strong>Note:</strong> If the virtual machine does not start and <code>Info [windeploy.exe] Found no unattend file</code> appears in <code>%WINDIR%\panther\UnattendGC\setupact.log</code>, add the <strong>UnattendFile</strong> key to the registry of the Windows virtual machine that was used to create the template for the pool:</p>

    <p>i. Check that the Windows virtual machine has an attached floppy device with the <code>unattend</code> file, for example, <code>A:\Unattend.xml</code>.</p>

    <p>ii. Click <strong>Start</strong>, click <strong>Run</strong>, type <code>regedit</code> in the <strong>Open</strong> text box, and click <strong>OK</strong>.</p>

    <p>iii. In the left pane, go to <strong>HKEY_LOCAL_MACHINE</strong> → <strong>SYSTEM</strong> → <strong>Setup</strong>.</p>

    <p>iv. Right-click the right pane and select <strong>New</strong> → <strong>String Value</strong>.</p>

    <p>v. Enter <strong>UnattendFile</strong> as the key name.</p>

    <p>vi. Double-click the new key and enter the <code>unattend</code> file name and path, for example, <code>A:\Unattend.xml</code>, as the key’s value.</p>

    <p>vii. Save the registry, seal the Windows virtual machine, and create a new template.</p>
  </li>
</ol>

<p>You have created and configured a virtual machine pool with the specified number of identical virtual machines. You can view these virtual machines in the <strong>Virtual Machines</strong> resource tab, or in the details pane of the <strong>Pools</strong> resource tab; a virtual machine in a pool is distinguished from independent virtual machines by its icon.</p>

<h2 id="explanation-of-settings-and-controls-in-the-new-pool-and-edit-pool-windows">Explanation of Settings and Controls in the New Pool and Edit Pool Windows</h2>

<h3 id="new-pool-and-edit-pool-general-settings-explained">New Pool and Edit Pool General Settings Explained</h3>

<p>The following table details the information required on the <strong>General</strong> tab of the <strong>New Pool</strong> and <strong>Edit Pool</strong> windows that are specific to virtual machine pools. All other settings are identical to those in the <strong>New Virtual Machine</strong> window.</p>

<p><strong>General settings</strong></p>

<table>
  <thead>
    <tr>
      <th>Field Name</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Template</strong></td>
      <td>The template on which the virtual machine pool is based.</td>
    </tr>
    <tr>
      <td><strong>Description</strong></td>
      <td>A meaningful description of the virtual machine pool.</td>
    </tr>
    <tr>
      <td><strong>Comment</strong></td>
      <td>A field for adding plain text human-readable comments regarding the virtual machine pool.</td>
    </tr>
    <tr>
      <td><strong>Prestarted VMs</strong></td>
      <td>Allows you to specify the number of virtual machines in the virtual machine pool that will be started before they are taken and kept in that state to be taken by users. The value of this field must be between <code>0</code> and the total number of virtual machines in the virtual machine pool.</td>
    </tr>
    <tr>
      <td><strong>Number of VMs/Increase number of VMs in pool by</strong></td>
      <td>Allows you to specify the number of virtual machines to be created and made available in the virtual machine pool. In the edit window it allows you to increase the number of virtual machines in the virtual machine pool by the specified number. By default, the maximum number of virtual machines you can create in a pool is 1000. This value can be configured using the <code>MaxVmsInPool</code> key of the <code>engine-config</code> command.</td>
    </tr>
    <tr>
      <td><strong>Maximum number of VMs per user</strong></td>
      <td>Allows you to specify the maximum number of virtual machines a single user can take from the virtual machine pool at any one time. The value of this field must be between <code>1</code> and <code>32,767</code>.</td>
    </tr>
    <tr>
      <td><strong>Delete Protection</strong></td>
      <td>Allows you to prevent the virtual machines in the pool from being deleted.</td>
    </tr>
  </tbody>
</table>

<h3 id="new-pool-and-edit-pool-type-settings-explained">New Pool and Edit Pool Type Settings Explained</h3>

<p>The following table details the information required on the <strong>Type</strong> tab of the <strong>New Pool</strong> and <strong>Edit Pool</strong> windows.</p>

<p><strong>Type settings</strong></p>

<table>
  <thead>
    <tr>
      <th>Field Name</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Pool Type</td>
      <td>This drop-down menu allows you to specify the type of the virtual machine pool. The following options are available: <br /><strong>Automatic:</strong> After a user finishes using a virtual machine taken from a virtual machine pool, that virtual machine is automatically returned to the virtual machine pool.<br /><strong>Manual:</strong> After a user finishes using a virtual machine taken from a virtual machine pool, that virtual machine is only returned to the virtual machine pool when an administrator manually returns the virtual machine.</td>
    </tr>
    <tr>
      <td>Stateful Pool</td>
      <td>Specify whether the state of virtual machines in the pool is preserved when a virtual machine is passed to a different user. This means that changes made by a previous user will persist on the virtual machine.</td>
    </tr>
  </tbody>
</table>

<h4 id="new-pool-and-edit-pool-console-settings-explained">New Pool and Edit Pool Console Settings Explained</h4>

<p>The following table details the information required on the <strong>Console</strong> tab of the <strong>New Pool</strong> or <strong>Edit Pool</strong> window that is specific to virtual machine pools. All other settings are identical to those in the <strong>New Virtual Machine</strong> and <strong>Edit Virtual Machine</strong> windows.</p>

<p><strong>Console settings</strong></p>

<table>
 <thead>
  <tr>
   <td>Field Name</td>
   <td>Description</td>
  </tr>
 </thead>
 <tbody>
  <tr>
   <td><b>Override SPICE proxy</b></td>
   <td>Select this check box to enable overriding the SPICE proxy defined in global configuration. This feature is useful in a case where the user (who is, for example, connecting via the User Portal) is outside of the network where the hosts reside.</td>
  </tr>
  <tr>
   <td><b>Overridden SPICE proxy address</b></td>
   <td>
    <p>The proxy by which the SPICE client will connect to virtual machines. This proxy overrides both the global SPICE proxy defined for the oVirt environment and the SPICE proxy defined for the cluster to which the virtual machine pool belongs, if any. The address must be in the following format:</p>
    <pre>protocol://[host]:[port]</pre>
   </td>
  </tr>
 </tbody>
</table>

<h4 id="virtual-machine-pool-host-settings-explained">Virtual Machine Pool Host Settings Explained</h4>

<p>The following table details the options available on the <strong>Host</strong> tab of the <strong>New Pool</strong> and <strong>Edit Pool</strong> windows.</p>

<p><strong>Virtual Machine Pool: Host Settings</strong></p>

<table>
 <thead>
  <tr>
   <td>Field Name</td>
   <td>Sub-element</td>
   <td>Description</td>
  </tr>
 </thead>
 <tbody>
  <tr>
   <td><b>Start Running On</b></td>
   <td> </td>
   <td>
    <p>Defines the preferred host on which the virtual machine is to run. Select either:</p>
    <ul>
     <li><b>Any Host in Cluster</b> - The virtual machine can start and run on any available host in the cluster.</li>
     <li><b>Specific</b> - The virtual machine will start running on a particular host in the cluster. However, the Engine or an administrator can migrate the virtual machine to a different host in the cluster depending on the migration and high-availability settings of the virtual machine. Select the specific host or group of hosts from the list of available hosts.</li>
    </ul>
   </td>
  </tr>
  <tr>
   <td><b>Migration Options</b></td>
   <td><b>Migration mode</b></td>
   <td>
    <p>Defines options to run and migrate the virtual machine. If the options here are not used, the virtual machine will run or migrate according to its cluster's policy.</p>
    <ul>
     <li><b>Allow manual and automatic migration</b> - The virtual machine can be automatically migrated from one host to another in accordance with the status of the environment, or manually by an administrator.</li>
     <li><b>Allow manual migration only</b> - The virtual machine can only be migrated from one host to another manually by an administrator.</li>
     <li><b>Do not allow migration</b> - The virtual machine cannot be migrated, either automatically or manually.</li>
    </ul>
   </td>
  </tr>
  <tr>
   <td> </td>
   <td><b>Use custom migration policy</b></td>
   <td>
    <p>Defines the migration convergence policy. If the check box is left unselected, the host determines the policy.</p>
    <ul>
     <li><b>Legacy</b> - Legacy behavior of 3.6 version. Overrides in <tt>vdsm.conf</tt> are still applied. The guest agent hook mechanism is disabled.</li>
     <li><b>Minimal downtime</b> - Allows the virtual machine to migrate in typical situations. Virtual machines should not experience any significant downtime. The migration will be aborted if virtual machine migration does not converging after a long time (dependent on QEMU iterations, with a maximum of 500 milliseconds). The guest agent hook mechanism is enabled.</li>
     <li><b>Suspend workload if needed</b> - Allows the virtual machine to migrate in most situations, including when the virtual machine is running a heavy workload. Virtual machines may experience a more significant downtime. The migration may still be aborted for extreme workloads. The guest agent hook mechanism is enabled.</li>
    </ul>
   </td>
  </tr>
  <tr>
   <td> </td>
   <td><b>Use custom migration downtime</b></td>
   <td>This check box allows you to specify the maximum number of milliseconds the virtual machine can be down during live migration. Configure different maximum downtimes for each virtual machine according to its workload and SLA requirements. Enter <tt>0</tt> to use the VDSM default value.</td>
  </tr>
  <tr>
   <td> </td>
   <td><b>Auto Converge migrations</b></td>
   <td>
    <p>Only activated with <b>Legacy</b> migration policy. Allows you to set whether auto-convergence is used during live migration of the virtual machine. Large virtual machines with high workloads can dirty memory more quickly than the transfer rate achieved during live migration, and prevent the migration from converging. Auto-convergence capabilities in QEMU allow you to force convergence of virtual machine migrations. QEMU automatically detects a lack of convergence and triggers a throttle-down of the vCPUs on the virtual machine. Auto-convergence is disabled globally by default.</p>
    <ul>
     <li>Select <b>Inherit from cluster setting</b> to use the auto-convergence setting that is set at the cluster level. This option is selected by default.</li>
     <li>Select <b>Auto Converge</b> to override the cluster setting or global setting and allow auto-convergence for the virtual machine.</li>
     <li>Select <b>Don't Auto Converge</b> to override the cluster setting or global setting and prevent auto-convergence for the virtual machine.</li>
    </ul>
   </td>
  </tr>
  <tr>
   <td> </td>
   <td><b>Enable migration compression</b></td>
   <td>
    <p>Only activated with <b>Legacy</b> migration policy. The  option allows you to set whether migration compression is used during live migration of the virtual machine. This feature uses Xor Binary Zero Run-Length-Encoding to reduce virtual machine downtime and total live migration time for virtual machines running memory write-intensive workloads or for any application with a sparse memory update pattern. Migration compression is disabled globally by default.</p>
    <ul>
     <li>Select <b>Inherit from cluster setting</b> to use the compression setting that is set at the cluster level. This option is selected by default.</li>
     <li>Select <b>Compress</b> to override the cluster setting or global setting and allow compression for the virtual machine.</li>
     <li>Select <b>Don't compress</b> to override the cluster setting or global setting and prevent compression for the virtual machine.</li>
    </ul>
   </td>
  </tr>
  <tr>
   <td> </td>
   <td> <b>Pass-Through Host CPU</b></td>
   <td>This check box allows virtual machines to take advantage of the features of the physical CPU of the host on which they are situated. This option can only be enabled when <b>Do not allow migration</b> is selected.</td>
  </tr>
  <tr>
   <td><b>Configure NUMA</b></td>
   <td><b>NUMA Node Count</b></td>
   <td>The number of virtual NUMA nodes to assign to the virtual machine. If the <b>Tune Mode</b> is <b>Preferred</b>, this value must be set to <tt>1</tt>.</td>
  </tr>
  <tr>
   <td> </td>
   <td><b>Tune Mode</b></td>
   <td>
    <p>The method used to allocate memory.</p>
    <ul>
     <li><b>Strict</b>: Memory allocation will fail if the memory cannot be allocated on the target node.</li>
     <li><b>Preferred</b>: Memory is allocated from a single preferred node. If sufficient memory is not available, memory can be allocated from other nodes.</li>
     <li><b>Interleave</b>: Memory is allocated across nodes in a round-robin algorithm.</li>
    </ul>
   </td>
  </tr>
  <tr>
   <td> </td>
   <td><b>NUMA Pinning</b></td>
   <td>Opens the <b>NUMA Topology</b> window. This window shows the host's total CPUs, memory, and NUMA nodes, and the virtual machine's virtual NUMA nodes. Pin virtual NUMA nodes to host NUMA nodes by clicking and dragging each vNUMA from the box on the right to a NUMA node on the left.</td>
  </tr>
 </tbody>
</table>

<h3 id="new-pool-and-edit-pool-resource-allocation-settings-explained">New Pool and Edit Pool Resource Allocation Settings Explained</h3>

<p>The following table details the information required on the <strong>Resource Allocation</strong> tab of the <strong>New Pool</strong> and <strong>Edit Pool</strong> windows that are specific to virtual machine pools. All other settings are identical to those in the <strong>New Virtual Machine</strong> window.</p>

<p><strong>Resource Allocation settings</strong></p>

<table>
 <thead>
  <tr>
   <td>Field Name</td>
   <td>Sub-element</td>
   <td>Description</td>
  </tr>
 </thead>
 <tbody>
  <tr>
   <td><b>Disk Allocation</b></td>
   <td><b>Auto select target</b></td>
   <td>Select this check box to automatically select the storage domain that has the most free space. The <b>Target</b> and <b>Profile</b> fields are disabled.</td>
  </tr>
  <tr>
   <td> </td>
   <td><b>Format</b></td>
   <td>This field is read-only and always displays <b>QCOW2</b> unless the storage domain type is OpenStack Volume (Cinder), in which case the format is <b>Raw</b>.</td>
  </tr>
 </tbody>
</table>

<h2 id="editing-a-virtual-machine-pool">Editing a Virtual Machine Pool</h2>

<p>After a virtual machine pool has been created, its properties can be edited. The properties available when editing a virtual machine pool are identical to those available when creating a new virtual machine pool except that the <strong>Number of VMs</strong> property is replaced by <strong>Increase number of VMs in pool by</strong>.</p>

<p><strong>Note:</strong> When editing a virtual machine pool, the changes introduced affect only new virtual machines. Virtual machines that existed already at the time of the introduced changes remain unaffected.</p>

<p><strong>Editing a Virtual Machine Pool</strong></p>

<ol>
  <li>
    <p>Click <strong>Compute</strong> → <strong>Pools</strong> and select a virtual machine pool.</p>
  </li>
  <li>
    <p>Click <strong>Edit</strong>.</p>
  </li>
  <li>
    <p>Edit the properties of the virtual machine pool.</p>
  </li>
  <li>
    <p>Click <strong>OK</strong>.</p>
  </li>
</ol>

<h2 id="prestarting-virtual-machines-in-a-pool">Prestarting Virtual Machines in a Pool</h2>

<p>The virtual machines in a virtual machine pool are powered down by default. When a user requests a virtual machine from a pool, a machine is powered up and assigned to the user. In contrast, a prestarted virtual machine is already running and waiting to be assigned to a user, decreasing the amount of time a user has to wait before being able to access a machine. When a prestarted virtual machine is shut down it is returned to the pool and restored to its original state. The maximum number of prestarted virtual machines is the number of virtual machines in the pool.</p>

<p>Prestarted virtual machines are suitable for environments in which users require immediate access to virtual machines which are not specifically assigned to them. Only automatic pools can have prestarted virtual machines.</p>

<p><strong>Prestarting Virtual Machines in a Pool</strong></p>

<ol>
  <li>
    <p>Click <strong>Compute</strong> → <strong>Pools</strong> and select a virtual machine pool.</p>
  </li>
  <li>
    <p>Click <strong>Edit</strong>.</p>
  </li>
  <li>
    <p>Enter the number of virtual machines to be prestarted in the <strong>Prestarted VMs</strong> field.</p>
  </li>
  <li>
    <p>Click the <strong>Type</strong> tab. Ensure <strong>Pool Type</strong> is set to <strong>Automatic</strong>.</p>
  </li>
  <li>
    <p>Click <strong>OK</strong>.</p>
  </li>
</ol>

<h2 id="adding-virtual-machines-to-a-virtual-machine-pool">Adding Virtual Machines to a Virtual Machine Pool</h2>

<p>If you require more virtual machines than originally provisioned in a virtual machine pool, add more machines to the pool.</p>

<p><strong>Adding Virtual Machines to a Virtual Machine Pool</strong></p>

<ol>
  <li>
    <p>Click <strong>Compute</strong> → <strong>Pools</strong> and select a virtual machine pool.</p>
  </li>
  <li>
    <p>Click <strong>Edit</strong>.</p>
  </li>
  <li>
    <p>Enter the number of additional virtual machines to add in the <strong>Increase number of VMs in pool by</strong> field.</p>
  </li>
  <li>
    <p>Click <strong>OK</strong>.</p>
  </li>
</ol>

<h2 id="detaching-virtual-machines-from-a-virtual-machine-pool">Detaching Virtual Machines from a Virtual Machine Pool</h2>

<p>You can detach virtual machines from a virtual machine pool. Detaching a virtual machine removes it from the pool to become an independent virtual machine.</p>

<p><strong>Detaching Virtual Machines from a Virtual Machine Pool</strong></p>

<ol>
  <li>
    <p>Click <strong>Compute</strong> → <strong>Pools</strong>.</p>
  </li>
  <li>
    <p>Click the pool’s name to open the details view.</p>
  </li>
  <li>
    <p>Click the <strong>Virtual Machines</strong> tab to list the virtual machines in the pool.</p>
  </li>
  <li>
    <p>Ensure the virtual machine has a status of <code>Down</code>; you cannot detach a running virtual machine.</p>
  </li>
  <li>
    <p>Select one or more virtual machines and click <strong>Detach</strong>.</p>
  </li>
  <li>
    <p>Click <strong>OK</strong>.</p>

    <p><strong>Note:</strong> The virtual machine still exists in the environment and can be viewed and accessed from <strong>Compute</strong> → <strong>Virtual Machines</strong> resource tab. Note that the icon changes to denote that the detached virtual machine is an independent virtual machine.</p>
  </li>
</ol>

<h2 id="removing-a-virtual-machine-pool">Removing a Virtual Machine Pool</h2>

<p>You can remove a virtual machine pool from a data center. You must first either delete or detach all of the virtual machines in the pool. Detaching virtual machines from the pool will preserve them as independent virtual machines.</p>

<p><strong>Removing a Virtual Machine Pool</strong></p>

<ol>
  <li>
    <p>Click <strong>Compute</strong> → <strong>Pools</strong> and select the virtual machine pool.</p>
  </li>
  <li>
    <p>Click <strong>Remove</strong>.</p>
  </li>
  <li>
    <p>Click <strong>OK</strong>.</p>
  </li>
</ol>

<h2 id="trusted-compute-pools">Trusted Compute Pools</h2>

<p>Trusted compute pools are secure clusters based on Intel Trusted Execution Technology (Intel TXT). Trusted clusters only allow hosts that are verified by Intel's OpenAttestation, which measures the integrity of the host's hardware and software against a White List database. Trusted hosts and the virtual machines running on them can be assigned tasks that require higher security. For more information on Intel TXT, trusted systems, and attestation, see <a href="https://software.intel.com/en-us/articles/intel-trusted-execution-technology-intel-txt-enabling-guide">https://software.intel.com/en-us/articles/intel-trusted-execution-technology-intel-txt-enabling-guide</a>.]</p>

<p>Creating a trusted compute pool involves the following steps:</p>

<ul>
  <li>
    <p>Configuring the Engine to communicate with an OpenAttestation server.</p>
  </li>
  <li>
    <p>Creating a trusted cluster that can only run trusted hosts.</p>
  </li>
  <li>
    <p>Adding trusted hosts to the trusted cluster. Hosts must be running the OpenAttestation agent to be verified as trusted by the OpenAttestation sever.</p>
  </li>
</ul>

<p>For information on installing an OpenAttestation server, installing the OpenAttestation agent on hosts, and creating a White List database, see <a href="https://github.com/OpenAttestation/OpenAttestation/wiki">https://github.com/OpenAttestation/OpenAttestation/wiki</a>.]</p>

<h3 id="connecting-an-openattestation-server-to-the-engine">Connecting an OpenAttestation Server to the Engine</h3>

<p>Before you can create a trusted cluster, the oVirt Engine must be configured to recognize the OpenAttestation server. Use <code>engine-config</code> to add the OpenAttestation server's FQDN or IP address:</p>

<div class="highlight"><pre class="highlight plaintext"><code># engine-config -s AttestationServer=attestationserver.example.com&#x000A;</code></pre></div>
<p>The following settings can also be changed if required:</p>

<p><strong>OpenAttestation Settings for engine-config</strong></p>

<table>
 <thead>
  <tr>
   <td>Option</td>
   <td>Default Value</td>
   <td>Description</td>
  </tr>
 </thead>
 <tbody>
  <tr>
   <td>AttestationServer</td>
   <td>oat-server</td>
   <td>The FQDN or IP address of the OpenAttestation server. This must be set for the Engine to communicate with the OpenAttestation server.</td>
  </tr>
  <tr>
   <td>AttestationPort</td>
   <td>8443</td>
   <td>The port used by the OpenAttestation server to communicate with the Engine.</td>
  </tr>
  <tr>
   <td>AttestationTruststore</td>
   <td>TrustStore.jks</td>
   <td>The trust store used for securing communication with the OpenAttestation server.</td>
  </tr>
  <tr>
   <td>AttestationTruststorePass</td>
   <td>password</td>
   <td>The password used to access the trust store.</td>
  </tr>
  <tr>
   <td>AttestationFirstStageSize</td>
   <td>10</td>
   <td>Used for quick initialization. Changing this value without good reason is not recommended.</td>
  </tr>
  <tr>
   <td>SecureConnectionWithOATServers</td>
   <td>true</td>
   <td>Enables or disables secure communication with OpenAttestation servers.</td>
  </tr>
  <tr>
   <td>PollUri</td>
   <td>AttestationService/resources/PollHosts</td>
   <td>The URI used for accessing the OpenAttestation service.</td>
  </tr>
 </tbody>
</table>

<h3 id="creating-a-trusted-cluster">Creating a Trusted Cluster</h3>

<p>Trusted clusters communicate with an OpenAttestation server to assess the security of hosts. When a host is added to a trusted cluster, the OpenAttestation server measures the host's hardware and software against a White List database. Virtual machines can be migrated between trusted hosts in the trusted cluster, allowing for high availability in a secure environment.</p>

<p><strong>Creating a Trusted Cluster</strong></p>

<ol>
  <li>
    <p>Click <strong>Compute</strong> → <strong>Clusters</strong>.</p>
  </li>
  <li>
    <p>Click <strong>New</strong>.</p>
  </li>
  <li>
    <p>Enter a <strong>Name</strong> for the cluster.</p>
  </li>
  <li>
    <p>Select the <strong>Enable Virt Service</strong> check box.</p>
  </li>
  <li>
    <p>Click the <strong>Scheduling Policy</strong> tab and select the <strong>Enable Trusted Service</strong> check box.</p>
  </li>
  <li>
    <p>Click <strong>OK</strong>.</p>
  </li>
</ol>

<h3 id="adding-a-trusted-host">Adding a Trusted Host</h3>

<p>Enterprise Linux hosts can be added to trusted clusters and measured against a White List database by the OpenAttestation server. Hosts must meet the following requirements to be trusted by the OpenAttestation server:</p>

<ul>
  <li>
    <p>Intel TXT is enabled in the BIOS.</p>
  </li>
  <li>
    <p>The OpenAttestation agent is installed and running.</p>
  </li>
  <li>
    <p>Software running on the host matches the OpenAttestation server's White List database.</p>
  </li>
</ul>

<p><strong>Adding a Trusted Host</strong></p>

<ol>
  <li>
    <p>Click <strong>Compute</strong> → <strong>Hosts</strong>.</p>
  </li>
  <li>
    <p>Click <strong>New</strong>.</p>
  </li>
  <li>
    <p>Select a trusted cluster from the <strong>Host Cluster</strong> drop-down list.</p>
  </li>
  <li>
    <p>Enter a <strong>Name</strong> for the host.</p>
  </li>
  <li>
    <p>Enter the <strong>Hostname</strong> of the host.</p>
  </li>
  <li>
    <p>Enter the host's root <strong>Password</strong>.</p>
  </li>
  <li>
    <p>Click <strong>OK</strong>.</p>
  </li>
</ol>

<p>After the host is added to the trusted cluster, it is assessed by the OpenAttestation server. If a host is not trusted by the OpenAttestation server, it will move to a <code>Non Operational</code> state and should be removed from the trusted cluster.</p>

<p><strong>Prev:</strong> <a href="chap-Storage">Chapter 8: Storage</a><br />
<strong>Next:</strong> <a href="chap-Virtual_Machine_Disks">Chapter 10: Virtual Disks</a></p>

<p><a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.2/html/administration_guide/chap-pools">Adapted from RHV 4.2 documentation - CC-BY-SA</a></p>

</section>
</section>
</section>
<footer class='text-center' id='footer'>
<hr class='visible-print'>
<ul class='footer-nav-list'>
<li><a target="_blank" href="../../site/privacy-policy.html">Privacy policy</a></li>
<li><a target="_blank" href="../../community/about.html">About</a></li>
<li><a target="_blank" href="../../site/general-disclaimer.html">Disclaimers</a></li>
</ul>

&copy; 2013&ndash;2019 oVirt
<div class='edit-this-page'>
<a target="_blank" href="https://github.com/oVirt/ovirt-site/issues/new?labels=documentation&amp;title=Issue:%20/source/documentation/admin-guide/chap-Pools.html.md&amp;template=issue_template_documentation.md"><i class="icon fa fa-github"></i>Report an issue with this page</a>
</div>
<div class='edit-this-page'>
<a target="_blank" href="https://github.com/oVirt/ovirt-site/edit/master/source/documentation/admin-guide/chap-Pools.html.md"><i class="icon fa fa-github"></i>Edit this page</a>
</div>
<div class='last-modified'>
Page last modified
Fri 22 Feb 2019 11:36 UTC
</div>
        <script type="text/javascript">
        var _paq = _paq || [];
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
        var u=(("https:" == document.location.protocol) ? "https" : "http") + "://stats.phx.ovirt.org/";
        _paq.push(['setTrackerUrl', u+'piwik.php']);
        _paq.push(['setSiteId', 1]);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0]; g.type='text/javascript';
        g.defer=true; g.async=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
        })();
        </script>
<noscript><p><img src="https://stats.phx.ovirt.org/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
</footer>


<script src="/javascripts/application.js?1560777657" type="text/javascript"></script>

</body>
</html>
