<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie10 lt-ie9 lt-ie8 lt-ie7" lang="en-us"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie10 lt-ie9 lt-ie8" lang="en-us"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie10 lt-ie9" lang="en-us"> <![endif]-->
<!--[if IE 9]> <html class="no-js lt-ie10 lt-ie9" lang="en-us"> <![endif]-->
<!--[if lt IE 10]> <html class="no-js lt-ie10" lang="en-us"> <![endif]-->
<!--[if !IE]> > <![endif]-->
<html class='no-js' lang='en'>
<!-- <![endif] -->
<head>
<title>
oVirt and SSL &mdash;
oVirt
</title>
<meta charset='utf-8'>
<meta content='' name='description'>
<meta content='' name='author'>
<meta content='initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width' name='viewport'>

<link href='/images/favicon.ico' rel='shortcut icon'>
<link href='/images/apple-touch-icon-precomposed.png' rel='apple-touch-icon-precomposed'>
<link href='/images/apple-touch-icon-57x57-precomposed.png' rel='apple-touch-icon-precomposed' sizes='57x57'>
<link href='/images/apple-touch-icon-72x72-precomposed.png' rel='apple-touch-icon-precomposed' sizes='72x72'>
<link href='/images/apple-touch-icon-114x114-precomposed.png' rel='apple-touch-icon-precomposed' sizes='114x114'>
<link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet'>
<link href="/stylesheets/application.css?1560777611" rel="stylesheet" type="text/css" />
<link href="/stylesheets/print.css?1560777612" rel="stylesheet" type="text/css" media="print" />
</head>
<body class=' source-md'>
<header class='masthead hidden-print' id='branding' role='banner'>
<section class='hgroup'></section>
<div id='access'>
<nav id="mainNav" class="navbar-fixed-top affix-top navForMobileHack" style="font-family: 'Open Sans', sans-serif; display: flex; justify-content: center;">
      <a href="/"><img id="logo" style="float: left; margin-right: 70px; height: 40px; padding: 0; margin-top: 12px;" alt="oVirt" src="/images/logo.svg"></a>
      <div>
          <div class="navbar-header page-scroll" style="min-width: 170px">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#menu_id0980fddf">
                  <span class="sr-only">Toggle navigation</span> Menu <i class="fa fa-bars"></i>
              </button>
          </div>

          <!-- Collect the nav links, forms, and other content for toggling -->
          <div class="collapse navbar-collapse" id="menu_id0980fddf">

              <ul class="nav navbar-nav">
                  <li class="hidden active">
                      <a href="#page-top"></a>
                  </li>
<li role='menuitem'>
  <a href='/'>Home</a>
</li>

<li role='menuitem'>
  <a href='/download/'>Download</a>
</li>

<li role='menuitem'>
  <a href='/documentation/'>Documentation</a>
</li>

<li role='menuitem'>
  <a href='/develop/'>Developers</a>
</li>

<li role='menuitem'>
  <a href='/community/'>Community</a>
</li>

<li role='menuitem'>
  <a href='//lists.ovirt.org/archives/'>Forum</a>
</li>

<li role='menuitem'>
  <a href='/blog/'>Blog</a>
</li>

              </ul>
          </div>
          <!-- /.navbar-collapse -->
      </div>
      <!-- /.container-fluid -->
  </nav>

</div>
</header>

<section class='page-wrap' id='page-wrap'>
<section class='page' id='page'>
<ul class='breadcrumb'>
<li><a href="/documentation/">Documentation</a></li>
<li><a href="/documentation/admin-guide/">Admin-guide</a></li>
</ul>

<section class='container content' id='content'>
<!--[if lt IE 7]>
<p class="chromeframe">You are using an outdated browser.
<a href="http://browsehappy.com/">Upgrade your browser today</a> or
<a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
<![endif]-->
<h1 id="appendix-d-ovirt-and-ssl">Appendix D: oVirt and SSL</h1>

<h2 id="replacing-the-ovirt-engine-ssltls-certificate">Replacing the oVirt Engine SSL/TLS Certificate</h2>

<div class="highlight"><pre class="highlight plaintext"><code>**Warning:** Do not change the permissions and ownerships for the **/etc/pki** directory or any subdirectories. The permission for the **/etc/pki** and the **/etc/pki/ovirt-engine** directory must remain as the default 755.&#x000A;</code></pre></div>
<p>Use the following procedure(s) if you want to use your organization’s third-party CA certificate to identify the oVirt Engine to users connecting over HTTPS.</p>

<div class="highlight"><pre class="highlight plaintext"><code>**Note:** Using a third-party CA certificate for HTTPS connections does not affect the certificate used for authentication between the Engine and hosts. They will continue to use the self-signed certificate generated by the Engine.&#x000A;</code></pre></div>
<p><strong>Prerequisites</strong></p>

<ul>
  <li>
    <p>A third-party CA certificate. This is the certificate of the CA (Certificate Authority) that issued the certificate you want to use. It is provided as a <strong>PEM</strong> file. The certificate chain must be complete up to the root certificate. The chain’s order is critical and must be from the last intermediate certificate to the root certificate. This procedure assumes that the third-party CA certificate is provided in <strong>/tmp/3rd-party-ca-cert.pem</strong>.</p>
  </li>
  <li>
    <p>The private key that you want to use for Apache httpd. It must not have a password. This procedure assumes that it is located in <strong>/tmp/apache.key</strong>.</p>
  </li>
  <li>
    <p>The certificate issued by the CA. This procedure assumes that it is located in <strong>/tmp/apache.cer</strong>.</p>
  </li>
</ul>

<p>If you received the private key and certificate from your CA in a P12 file, use the following procedure to extract them. For other file formats, contact your CA. After extracting the private key and certificate, proceed to Replacing the Red Hat Virtualization Manager Apache SSL Certificate.</p>

<p><strong>Extracting the Certificate and Private Key from a P12 Bundle</strong></p>

<p>The internal CA stores the internally generated key and certificate in a <strong>P12</strong> file, in <strong>/etc/pki/ovirt-engine/keys/apache.p12</strong>. The oVirt Project recommends storing your new file in the same location. The following procedure assumes that the new P12 file is in <strong>/tmp/apache.p12</strong>.</p>

<ol>
  <li>
    <p>Back up the current <strong>apache.p12</strong> file:</p>

<div class="highlight"><pre class="highlight plaintext"><code> # cp -p /etc/pki/ovirt-engine/keys/apache.p12 /etc/pki/ovirt-engine/keys/apache.p12.bck&#x000A;</code></pre></div>  </li>
  <li>
    <p>Replace the current file with the new file:</p>

<div class="highlight"><pre class="highlight plaintext"><code> # cp /tmp/apache.p12 /etc/pki/ovirt-engine/keys/apache.p12&#x000A;</code></pre></div>  </li>
  <li>
    <p>Extract the private key and certificate to the required locations. If the file is password protected, you must add <code>-passin pass:_password_</code>, replacing <code>password</code> with the required password.</p>

<div class="highlight"><pre class="highlight plaintext"><code> # openssl pkcs12 -in /etc/pki/ovirt-engine/keys/apache.p12 -nocerts -nodes &gt; /tmp/apache.key&#x000A; # openssl pkcs12 -in /etc/pki/ovirt-engine/keys/apache.p12 -nokeys &gt; /tmp/apache.cer&#x000A;</code></pre></div>  </li>
</ol>

<p><strong>Important:</strong> For new oVirt installations, you must complete all of the steps in this procedure. If you upgraded from a oVirt 3.6 environment with a commercially signed certificate already configured, only steps 1, 8, and 9 are required.</p>

<p><strong>Replacing the oVirt Engine Apache SSL Certificate</strong></p>

<ol>
  <li>
    <p>Add your CA certificate to the host-wide trust store.</p>

<div class="highlight"><pre class="highlight plaintext"><code> # cp YOUR-3RD-PARTY-CERT.pem /etc/pki/ca-trust/source/anchors&#x000A;&#x000A; # update-ca-trust&#x000A;</code></pre></div>  </li>
  <li>
    <p>The Engine has been configured to use <strong>/etc/pki/ovirt-engine/apache-ca.pem</strong>, which is symbolically linked to <strong>/etc/pki/ovirt-engine/ca.pem</strong>. Remove the symbolic link.</p>

<div class="highlight"><pre class="highlight plaintext"><code> # rm /etc/pki/ovirt-engine/apache-ca.pem&#x000A;</code></pre></div>  </li>
  <li>
    <p>Save your CA certificate as <strong>/etc/pki/ovirt-engine/apache-ca.pem</strong>.</p>

<div class="highlight"><pre class="highlight plaintext"><code> # cp /tmp/3rd-party-ca-cert.pem /etc/pki/ovirt-engine/apache-ca.pem&#x000A;</code></pre></div>  </li>
  <li>
    <p>Back up the existing private key and certificate:</p>

<div class="highlight"><pre class="highlight plaintext"><code> # cp /etc/pki/ovirt-engine/keys/apache.key.nopass /etc/pki/ovirt-engine/keys/apache.key.nopass.bck&#x000A; # cp /etc/pki/ovirt-engine/certs/apache.cer /etc/pki/ovirt-engine/certs/apache.cer.bck&#x000A;</code></pre></div>  </li>
  <li>
    <p>Copy the private key to the required location:</p>

<div class="highlight"><pre class="highlight plaintext"><code> # cp /tmp/apache.key /etc/pki/ovirt-engine/keys/apache.key.nopass&#x000A;</code></pre></div>  </li>
  <li>
    <p>Copy the certificate to the required location:</p>

<div class="highlight"><pre class="highlight plaintext"><code> # cp /tmp/apache.cer /etc/pki/ovirt-engine/certs/apache.cer&#x000A;</code></pre></div>  </li>
  <li>
    <p>Restart the Apache server:</p>

<div class="highlight"><pre class="highlight plaintext"><code> # systemctl restart httpd.service&#x000A;</code></pre></div>  </li>
  <li>
    <p>Create a new trust store configuration file:</p>

<div class="highlight"><pre class="highlight plaintext"><code> # vi /etc/ovirt-engine/engine.conf.d/99-custom-truststore.conf&#x000A;</code></pre></div>
    <p>Add the following content and save the file:</p>

<div class="highlight"><pre class="highlight plaintext"><code> ENGINE_HTTPS_PKI_TRUST_STORE="/etc/pki/java/cacerts"&#x000A; ENGINE_HTTPS_PKI_TRUST_STORE_PASSWORD=""&#x000A;</code></pre></div>  </li>
  <li>
    <p>Edit the <strong>/etc/ovirt-engine/ovirt-websocket-proxy.conf.d/10-setup.conf</strong> file:</p>

<div class="highlight"><pre class="highlight plaintext"><code> # vi /etc/ovirt-engine/ovirt-websocket-proxy.conf.d/10-setup.conf&#x000A;</code></pre></div>
    <p>Make the following changes and save the file:</p>

<div class="highlight"><pre class="highlight plaintext"><code> SSL_CERTIFICATE=/etc/pki/ovirt-engine/certs/apache.cer&#x000A; SSL_KEY=/etc/pki/ovirt-engine/keys/apache.key.nopass&#x000A;</code></pre></div>  </li>
  <li>
    <p>Edit the <strong>/etc/ovirt-imageio-proxy/ovirt-imageio-proxy.conf</strong> file:</p>

<div class="highlight"><pre class="highlight plaintext"><code># vi /etc/ovirt-imageio-proxy/ovirt-imageio-proxy.conf&#x000A;</code></pre></div>
    <p>Make the following changes and save the file:</p>

<div class="highlight"><pre class="highlight plaintext"><code># Key file for SSL connections&#x000A;ssl_key_file = /etc/pki/ovirt-engine/keys/apache.key.nopass&#x000A;# Certificate file for SSL connections&#x000A;ssl_cert_file = /etc/pki/ovirt-engine/certs/apache.cer&#x000A;</code></pre></div>  </li>
  <li>
    <p>Restart the <code>ovirt-provider-ovn</code> service:</p>

<div class="highlight"><pre class="highlight plaintext"><code># systemctl restart ovirt-provider-ovn.service&#x000A;</code></pre></div>  </li>
  <li>
    <p>Restart the <code>ovirt-imageio-proxy</code> service:</p>

<div class="highlight"><pre class="highlight plaintext"><code># systemctl restart ovirt-imageio-proxy&#x000A;</code></pre></div>  </li>
  <li>
    <p>Restart the <code>ovirt-websocket-proxy</code> service:</p>

<div class="highlight"><pre class="highlight plaintext"><code># systemctl restart ovirt-websocket-proxy&#x000A;</code></pre></div>  </li>
  <li>
    <p>Restart the ovirt-engine service:</p>

<div class="highlight"><pre class="highlight plaintext"><code># systemctl restart ovirt-engine.service&#x000A;</code></pre></div>  </li>
</ol>

<p>Your users can now connect to the Administration Portal and VM Portal without being warned about the authenticity of the certificate used to encrypt HTTPS traffic.</p>

<h2 id="setting-up-ssl-or-tls-connections-between-the-engine-and-an-ldap-server">Setting Up SSL or TLS Connections between the Engine and an LDAP Server</h2>

<p>To set up a secure connection between the oVirt Engine and an LDAP server, obtain the root CA certificate of the LDAP server, copy the root CA certificate to the Engine, and create a PEM-encoded CA certificate. The keystore type can be any Java-supported type. The following procedure uses the Java KeyStore (JKS) format.</p>

<div class="highlight"><pre class="highlight plaintext"><code>**Note:** For more information on creating a PEM-encoded CA certificate and importing certificates, see the `X.509 CERTIFICATE TRUST STORE` section of the README file at `/usr/share/doc/ovirt-engine-extension-aaa-ldap-version`.&#x000A;</code></pre></div>
<p><strong>Creating a PEM-encoded CA certificate</strong></p>

<ol>
  <li>
    <p>On the oVirt Engine, copy the root CA certificate of the LDAP server to the <strong>/tmp</strong> directory and import the root CA certificate using <code>keytool</code> to create a PEM-encoded CA certificate. The following command imports the root CA certificate at <code>/tmp/myrootca.pem</code> and creates a PEM-encoded CA certificate <code>myrootca.jks</code> under <code>/etc/ovirt-engine/aaa/</code>. Note down the certificate's location and password. If you are using the interactive setup tool, this is all the information you need. If you are configuring the LDAP server manually, follow the rest of the procedure to update the configuration files.</p>

<div class="highlight"><pre class="highlight plaintext"><code> $ keytool -importcert -noprompt -trustcacerts -alias myrootca -file /tmp/myrootca.pem -keystore /etc/ovirt-engine/aaa/myrootca.jks -storepass password&#x000A;</code></pre></div>  </li>
  <li>
    <p>Update the <strong>/etc/ovirt-engine/aaa/profile1.properties</strong> file with the certificate information:</p>

    <p><strong>Note:</strong> <code>${local:_basedir}</code> is the directory where the LDAP property configuration file resides and points to the <code>/etc/ovirt-engine/aaa</code> directory. If you created the PEM-encoded CA certificate in a different directory, replace <code>${local:_basedir}</code> with the full path to the certificate.</p>

    <ul>
      <li>
        <p>To use startTLS (recommended):</p>

<div class="highlight"><pre class="highlight plaintext"><code>  # Create keystore, import certificate chain and uncomment&#x000A;  pool.default.ssl.startTLS = true&#x000A;  pool.default.ssl.truststore.file = ${local:\_basedir}/myrootca.jks&#x000A;  pool.default.ssl.truststore.password = password&#x000A;</code></pre></div>      </li>
      <li>
        <p>To use SSL:</p>

<div class="highlight"><pre class="highlight plaintext"><code>  # Create keystore, import certificate chain and uncomment&#x000A;  pool.default.serverset.single.port = 636&#x000A;  pool.default.ssl.enable = true&#x000A;  pool.default.ssl.truststore.file = ${local:\_basedir}/myrootca.jks&#x000A;  pool.default.ssl.truststore.password = password&#x000A;</code></pre></div>      </li>
    </ul>
  </li>
</ol>

<p>To continue configuring an external LDAP provider, see <a href="Configuring_an_External_LDAP_Provider">Configuring an External LDAP Provider</a>. To continue configuring LDAP and Kerberos for Single Sign-on, see <a href="Configuring_LDAP_and_Kerberos_for_Single_Sign-on">Configuring LDAP and Kerberos for Single Sign-on</a>.</p>

<p><strong>Prev:</strong> <a href="appe-oVirt_User_Interface_Plugins">Appendix C: oVirt User Interface Plugins</a><br />
<strong>Next:</strong> <a href="appe-Branding">Appendix E: Branding</a></p>

<p><a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.2/html/administration_guide/appe-red_hat_enterprise_virtualization_and_ssl">Adapted from RHV 4.2 documentation - CC-BY-SA</a></p>

</section>
</section>
</section>
<footer class='text-center' id='footer'>
<hr class='visible-print'>
<ul class='footer-nav-list'>
<li><a target="_blank" href="../../site/privacy-policy.html">Privacy policy</a></li>
<li><a target="_blank" href="../../community/about.html">About</a></li>
<li><a target="_blank" href="../../site/general-disclaimer.html">Disclaimers</a></li>
</ul>

&copy; 2013&ndash;2019 oVirt
<div class='edit-this-page'>
<a target="_blank" href="https://github.com/oVirt/ovirt-site/issues/new?labels=documentation&amp;title=Issue:%20/source/documentation/admin-guide/appe-oVirt_and_SSL.html.md&amp;template=issue_template_documentation.md"><i class="icon fa fa-github"></i>Report an issue with this page</a>
</div>
<div class='edit-this-page'>
<a target="_blank" href="https://github.com/oVirt/ovirt-site/edit/master/source/documentation/admin-guide/appe-oVirt_and_SSL.html.md"><i class="icon fa fa-github"></i>Edit this page</a>
</div>
<div class='last-modified'>
Page last modified
Sun 2 Jun 2019 13:49 UTC
</div>
        <script type="text/javascript">
        var _paq = _paq || [];
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
        var u=(("https:" == document.location.protocol) ? "https" : "http") + "://stats.phx.ovirt.org/";
        _paq.push(['setTrackerUrl', u+'piwik.php']);
        _paq.push(['setSiteId', 1]);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0]; g.type='text/javascript';
        g.defer=true; g.async=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
        })();
        </script>
<noscript><p><img src="https://stats.phx.ovirt.org/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
</footer>


<script src="/javascripts/application.js?1560777657" type="text/javascript"></script>

</body>
</html>
