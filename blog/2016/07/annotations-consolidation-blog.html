<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie10 lt-ie9 lt-ie8 lt-ie7" lang="en-us"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie10 lt-ie9 lt-ie8" lang="en-us"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie10 lt-ie9" lang="en-us"> <![endif]-->
<!--[if IE 9]> <html class="no-js lt-ie10 lt-ie9" lang="en-us"> <![endif]-->
<!--[if lt IE 10]> <html class="no-js lt-ie10" lang="en-us"> <![endif]-->
<!--[if !IE]> > <![endif]-->
<html class='no-js' lang='en'>
<!-- <![endif] -->
<head>
<title>
Editable Field Annotations Consolidation &mdash;
oVirt
</title>
<meta charset='utf-8'>
<meta content='' name='description'>
<meta content='Phillip Bailey' name='author'>
<meta content='initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width' name='viewport'>
<link href='/blog/feed.xml' rel='alternate' title='Atom feed' type='application/atom+xml'>
<!-- Open Graph (FB / G+) -->
<meta content='article' property='og:type'>
<meta content='Editable Field Annotations Consolidation' property='og:title'>
<meta content='Robust functionality with minimum verbosity and complexity is a goal for which developers often strive.

To that end, we have refactored the annotations used to indicate which fields are editable for hosts and virtual machines.' property='og:description'>
<meta content='http://ovirt.org/blog/2016/07/annotations-consolidation-blog.html' property='og:url'>
<meta content='2016-07-18T16:00:00Z' property='article:published_time'>
<meta content='phbailey' property='article:author:username'>
<meta content='community' property='article:tag'>
<link href='/blog/tag/community.xml' rel='alternate' title='Atom feed' type='application/atom+xml'>
<meta content='documentation' property='article:tag'>
<link href='/blog/tag/documentation.xml' rel='alternate' title='Atom feed' type='application/atom+xml'>
<meta content='infrastructure' property='article:tag'>
<link href='/blog/tag/infrastructure.xml' rel='alternate' title='Atom feed' type='application/atom+xml'>
<!-- Twitter card -->
<meta content='summary' name='twitter:card'>
<meta content='Editable Field Annotations Consolidation' name='twitter:title'>
<meta content='Robust functionality with minimum verbosity and complexity is a goal for which developers often strive.

To that end, we have refactored the annotations used to indicate which fields are editable for hosts and virtual machines.' name='twitter:description'>

<link href='/images/favicon.ico' rel='shortcut icon'>
<link href='/images/apple-touch-icon-precomposed.png' rel='apple-touch-icon-precomposed'>
<link href='/images/apple-touch-icon-57x57-precomposed.png' rel='apple-touch-icon-precomposed' sizes='57x57'>
<link href='/images/apple-touch-icon-72x72-precomposed.png' rel='apple-touch-icon-precomposed' sizes='72x72'>
<link href='/images/apple-touch-icon-114x114-precomposed.png' rel='apple-touch-icon-precomposed' sizes='114x114'>
<link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet'>
<link href="/stylesheets/application.css?1560777611" rel="stylesheet" type="text/css" />
<link href="/stylesheets/print.css?1560777612" rel="stylesheet" type="text/css" media="print" />
</head>
<body class=' source-md'>
<header class='masthead hidden-print' id='branding' role='banner'>
<section class='hgroup'></section>
<div id='access'>
<nav id="mainNav" class="navbar-fixed-top affix-top navForMobileHack" style="font-family: 'Open Sans', sans-serif; display: flex; justify-content: center;">
      <a href="/"><img id="logo" style="float: left; margin-right: 70px; height: 40px; padding: 0; margin-top: 12px;" alt="oVirt" src="/images/logo.svg"></a>
      <div>
          <div class="navbar-header page-scroll" style="min-width: 170px">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#menu_id0980fddf">
                  <span class="sr-only">Toggle navigation</span> Menu <i class="fa fa-bars"></i>
              </button>
          </div>

          <!-- Collect the nav links, forms, and other content for toggling -->
          <div class="collapse navbar-collapse" id="menu_id0980fddf">

              <ul class="nav navbar-nav">
                  <li class="hidden active">
                      <a href="#page-top"></a>
                  </li>
<li role='menuitem'>
  <a href='/'>Home</a>
</li>

<li role='menuitem'>
  <a href='/download/'>Download</a>
</li>

<li role='menuitem'>
  <a href='/documentation/'>Documentation</a>
</li>

<li role='menuitem'>
  <a href='/develop/'>Developers</a>
</li>

<li role='menuitem'>
  <a href='/community/'>Community</a>
</li>

<li role='menuitem'>
  <a href='//lists.ovirt.org/archives/'>Forum</a>
</li>

<li role='menuitem'>
  <a href='/blog/'>Blog</a>
</li>

              </ul>
          </div>
          <!-- /.navbar-collapse -->
      </div>
      <!-- /.container-fluid -->
  </nav>

</div>
</header>

<section class='page-wrap' id='page-wrap'>
<section class='page' id='page'>
<ul class='breadcrumb'>
<li class='active'>Blog</li>
<li class='active'>2016</li>
<li class='active'>07</li>
</ul>

<section class='container content' id='content'>
<!--[if lt IE 7]>
<p class="chromeframe">You are using an outdated browser.
<a href="http://browsehappy.com/">Upgrade your browser today</a> or
<a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
<![endif]-->
<section class='blog-post-page row'>
<div class='col-md-10 col-md-offset-1'>
<article class='post hentry'>
<header class='post-header'>
<h2 class='post-title entry-title'>
Editable Field Annotations Consolidation
</h2>
<header class='post-meta'>
<div class='blogger_avatar'>
<img src='/blogger_avatars/phbailey.png'>
</div>
<span class='byline'>
by
<span class='author vcard'>
<a href="/blog/author/phbailey/">Phillip Bailey</a>
</span>
&ndash;
</span>
<time class='published' datetime='2016-07-18T16:00:00Z'>
Monday 18 July 2016
</time>
</header>
</header>
<section class='post-content entry-content'>
<p>Robust functionality with minimum verbosity and complexity is a goal for which developers often strive.</p>

<p>To that end, we have refactored the annotations used to indicate which fields are editable for hosts and virtual machines.</p>

<p></p>

<h2 id="the-problem">The Problem</h2>

<p>Prior to the change, the following annotations were used:</p>

<p>For VMs:</p>

<ul>
  <li><code>EditableField</code></li>
  <li><code>EditableHostedEngineField</code></li>
  <li><code>EditableOnVmStatusField</code></li>
</ul>

<p>For VM Templates:</p>

<ul>
  <li><code>EditableField</code></li>
  <li><code>EditableOnTemplate</code></li>
</ul>

<p>For Hosts:</p>

<ul>
  <li><code>EditableField</code></li>
  <li><code>EditableOnVdsStatus</code></li>
</ul>

<p>This lead to fields with an overabundance of individual annotations. For example, take the <code>memSizeMb</code> field in the <code>VmBase</code> class:</p>

<div class="highlight"><pre class="highlight plaintext"><code>@CopyOnNewVersion&#x000A;@EditableOnVmStatusField(isHotsetAllowed = true)&#x000A;@EditableOnTemplate&#x000A;@EditableHostedEngineField&#x000A;private int memSizeMb;&#x000A;</code></pre></div>
<p>Logically, each of the Editable* annotations are communicating the same information: the circumstances under which a given field is editable. However, <code>EditableOnVmStatusField</code> and <code>EditableOnHostedEngineField</code> indicate conditions under which a VM entity can be edited, whereas <code>EditableOnTemplate</code> indicates the entity type for which the field is editable (<code>VmTemplate</code>). It is easy to see how this can be a bit confusing for someone reading through this code, especially if they are unfamiliar with it.</p>

<h2 id="the-solution">The Solution</h2>

<p>In the first step of the refactor, new annotation names were created that indicate the entity type for which the annotated field is editable:</p>

<ul>
  <li><code>EditableVmField</code></li>
  <li><code>EditableVdsField</code></li>
  <li><code>EditableVmTemplateField</code></li>
</ul>

<p>In the second step, each of the conditions described by the old annotation names were turned into fields in the applicable annotation. For example, the <code>EditableVmField</code> annotation was given three fields: <code>onHostedEngine</code>, <code>hotsetAllowed</code>, and <code>onStatuses</code>.</p>

<p>The third and final step was to address the way entity statuses were handled, as the previous implementation was problematic. <code>EditableOnVmStatus</code> and <code>EditableOnVdsStatus</code> both required each status for which a field is editable to be listed in its <code>onStatus</code> field. Initially, this makes sense, but consider a field that is editable under any status. The obvious long list of statuses aside, this approach requires that the status list for such a field be updated any time a new status is added to the entity. If the individual adding the status isn't aware of this requirement, a silent regression would be introduced.</p>

<p>In addition to this potentially serious problem, the implementation of each annotation provided a default list of statuses to be used if no status list was provided in the annotation declaration. In order to be aware of the existence of these default lists, an individual would have to either be familiar with the implementation code or have been informed by a third party.</p>

<p>In the consolidated version, if no explicit list is provided in the <code>onStatuses</code> field of the <code>EditableVmField</code> and <code>EditableVdsField</code> annotations, it is assumed that the field is editable under all statuses. However, if a list is provided within the annotation declaration, the field will be considered editable only if it is in a status provided in that list. This implementation is clearer, as the <code>onStatuses</code> field will only be used if the statuses list is being restricted, and the restricted list will be displayed alongside the field to which it applies. It also avoids the entity status update problem.</p>

<h2 id="the-end-state">The End State</h2>

<p>If we employ the new annotations using our previous <code>memSizeMb</code> example, we get the following:</p>

<div class="highlight"><pre class="highlight plaintext"><code>@CopyOnNewVersion&#x000A;@EditableVmField(&#x000A;        onHostedEngine = true,&#x000A;        hotsetAllowed = true,&#x000A;        onStatuses = { VMStatus.Down })&#x000A;@EditableVmTemplateField&#x000A;private int memSizeMb;&#x000A;</code></pre></div>
<p>While the line count increased, the conceptual weight of the code has been reduced. The entities for which this field is editable are obvious, and the conditions under which the field is editable for a VM entity are immediately clear.</p>

<p><strong>Note</strong>: The line count has only increased due to the styling convention being employed. The same code could be written as:</p>

<div class="highlight"><pre class="highlight plaintext"><code>@CopyOnNewVersion&#x000A;@EditableVmField(onHostedEngine = true, hotsetAllowed = true, onStatuses = { VMStatus.Down })&#x000A;@EditableVmTemplateField&#x000A;private int memSizeMb;&#x000A;</code></pre></div>
<p>Overall, we feel that this change will provide a cleaner way of representing this information for both the readers and writers of this code.</p>

</section>
<footer class='post-meta'>
<div class='tags'>
Tags:
<ul class='taglist'></ul>
<li><a href="../../tag/community.html">community</a></li>
<li><a href="../../tag/documentation.html">documentation</a></li>
<li><a href="../../tag/infrastructure.html">infrastructure</a></li>
</div>
</footer>
</article>

<section id='blog-comments'></section>
</div>
</section>

</section>
</section>
</section>
<footer class='text-center' id='footer'>
<hr class='visible-print'>
<ul class='footer-nav-list'>
<li><a target="_blank" href="../../../site/privacy-policy.html">Privacy policy</a></li>
<li><a target="_blank" href="../../../community/about.html">About</a></li>
<li><a target="_blank" href="../../../site/general-disclaimer.html">Disclaimers</a></li>
</ul>

&copy; 2013&ndash;2019 oVirt
<div class='edit-this-page'>
<a target="_blank" href="https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/source/blog/2016-07-18-annotations-consolidation-blog.html.md&amp;template="><i class="icon fa fa-github"></i>Report an issue with this page</a>
</div>
<div class='edit-this-page'>
<a target="_blank" href="https://github.com/oVirt/ovirt-site/edit/master/source/blog/2016-07-18-annotations-consolidation-blog.html.md"><i class="icon fa fa-github"></i>Edit this page</a>
</div>
<div class='last-modified'>
Page last modified
Mon 18 Jul 2016 15:04 UTC
</div>
        <script type="text/javascript">
        var _paq = _paq || [];
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
        var u=(("https:" == document.location.protocol) ? "https" : "http") + "://stats.phx.ovirt.org/";
        _paq.push(['setTrackerUrl', u+'piwik.php']);
        _paq.push(['setSiteId', 1]);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0]; g.type='text/javascript';
        g.defer=true; g.async=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
        })();
        </script>
<noscript><p><img src="https://stats.phx.ovirt.org/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
</footer>


<script src="/javascripts/application.js?1560777657" type="text/javascript"></script>

</body>
</html>
