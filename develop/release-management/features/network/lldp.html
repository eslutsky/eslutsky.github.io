<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie10 lt-ie9 lt-ie8 lt-ie7" lang="en-us"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie10 lt-ie9 lt-ie8" lang="en-us"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie10 lt-ie9" lang="en-us"> <![endif]-->
<!--[if IE 9]> <html class="no-js lt-ie10 lt-ie9" lang="en-us"> <![endif]-->
<!--[if lt IE 10]> <html class="no-js lt-ie10" lang="en-us"> <![endif]-->
<!--[if !IE]> > <![endif]-->
<html class='no-js' lang='en'>
<!-- <![endif] -->
<head>
<title>
Link Layer Discovery Protocol (LLDP) Support &mdash;
oVirt
</title>
<meta charset='utf-8'>
<meta content='' name='description'>
<meta content='' name='author'>
<meta content='initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width' name='viewport'>

<link href='/images/favicon.ico' rel='shortcut icon'>
<link href='/images/apple-touch-icon-precomposed.png' rel='apple-touch-icon-precomposed'>
<link href='/images/apple-touch-icon-57x57-precomposed.png' rel='apple-touch-icon-precomposed' sizes='57x57'>
<link href='/images/apple-touch-icon-72x72-precomposed.png' rel='apple-touch-icon-precomposed' sizes='72x72'>
<link href='/images/apple-touch-icon-114x114-precomposed.png' rel='apple-touch-icon-precomposed' sizes='114x114'>
<link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet'>
<link href="/stylesheets/application.css?1560777611" rel="stylesheet" type="text/css" />
<link href="/stylesheets/print.css?1560777612" rel="stylesheet" type="text/css" media="print" />
</head>
<body class=' source-md'>
<header class='masthead hidden-print' id='branding' role='banner'>
<section class='hgroup'></section>
<div id='access'>
<nav id="mainNav" class="navbar-fixed-top affix-top navForMobileHack" style="font-family: 'Open Sans', sans-serif; display: flex; justify-content: center;">
      <a href="/"><img id="logo" style="float: left; margin-right: 70px; height: 40px; padding: 0; margin-top: 12px;" alt="oVirt" src="/images/logo.svg"></a>
      <div>
          <div class="navbar-header page-scroll" style="min-width: 170px">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#menu_id0980fddf">
                  <span class="sr-only">Toggle navigation</span> Menu <i class="fa fa-bars"></i>
              </button>
          </div>

          <!-- Collect the nav links, forms, and other content for toggling -->
          <div class="collapse navbar-collapse" id="menu_id0980fddf">

              <ul class="nav navbar-nav">
                  <li class="hidden active">
                      <a href="#page-top"></a>
                  </li>
<li role='menuitem'>
  <a href='/'>Home</a>
</li>

<li role='menuitem'>
  <a href='/download/'>Download</a>
</li>

<li role='menuitem'>
  <a href='/documentation/'>Documentation</a>
</li>

<li role='menuitem'>
  <a href='/develop/'>Developers</a>
</li>

<li role='menuitem'>
  <a href='/community/'>Community</a>
</li>

<li role='menuitem'>
  <a href='//lists.ovirt.org/archives/'>Forum</a>
</li>

<li role='menuitem'>
  <a href='/blog/'>Blog</a>
</li>

              </ul>
          </div>
          <!-- /.navbar-collapse -->
      </div>
      <!-- /.container-fluid -->
  </nav>

</div>
</header>

<section class='page-wrap' id='page-wrap'>
<section class='page' id='page'>
<ul class='breadcrumb'>
<li><a href="/develop/">Develop</a></li>
<li><a href="/develop/release-management/">Release-management</a></li>
<li><a href="/develop/release-management/features/">Features</a></li>
<li><a href="/develop/release-management/features/network/">Network</a></li>
</ul>

<section class='container content' id='content'>
<div class='alert alert-warning'>
Feature pages are design documents that developers have created while collaborating on oVirt.
<br>
<br>
Most of them are
<strong>
outdated
</strong>
, but provide historical design context.
<br>
<br>
They are
<strong>
not
</strong>
user documentation and should not be treated as such.
<br>
<br>
<a href='/documentation/'>Documentation is available here.</a>
</div>
<h1 id="link-layer-discovery-protocol-lldp-support">Link Layer Discovery Protocol (LLDP) Support</h1>

<h2 id="summary">Summary</h2>

<p>The <a href="http://standards.ieee.org/getieee802/download/802.1AB-2016.zip">Link Layer Discovery Protocol (LLDP)</a> is a vendor-neutral networking
protocol, used by network devices, especially switches, for advertising their
identity, capabilities and management addresses on an IEEE 802 local area
network (LAN).</p>

<p>The feature will enable oVirt hosts to gather information from their networking
interfaces and let oVirt Engine use this information in a beneficial way.</p>

<h2 id="owner">Owner</h2>

<ul>
  <li>
    <p>Name: <a href="https://github.com/dominikholler">Dominik Holler</a></p>
  </li>
  <li>
    <p>Email: <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#100;&#104;&#111;&#108;&#108;&#101;&#114;&#064;&#114;&#101;&#100;&#104;&#097;&#116;&#046;&#099;&#111;&#109;">&#100;&#104;&#111;&#108;&#108;&#101;&#114;&#064;&#114;&#101;&#100;&#104;&#097;&#116;&#046;&#099;&#111;&#109;</a></p>
  </li>
</ul>

<h2 id="detailed-description">Detailed Description</h2>

<p>To support the integration of oVirt with other software, the information gathered
by LLDP on each host will be provided by oVirt Engine's REST-API.</p>

<p>Some of the information, like the number of the switch port a network interface
of the host is connected to, might be helpful for the user and will be shown in
the graphical user interface.</p>

<p>At this point in time we do not intend to expose information by LLDP to the
switch.</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>LLDP has to be enabled on the switch connected to the relevant oVirt hosts.</p>

<h2 id="limitations">Limitations</h2>

<ul>
  <li>
    <p>There is a delay from receiving the LLDP data on the oVirt host, propagating
the data to the oVirt Engine and presenting the data to the user.
Whatever value we present over REST may be out of date.</p>
  </li>
  <li>
    <p>This feature is only about LLDP, Cisco Discovery Protocol (CDP) is not
addressed.</p>
  </li>
  <li>
    <p>Receiving LLDP on hot plugged network interfaces requires restarting of VDSM,
because receiving LLDP on the network interfaces is enabled during the startup
of VDSM.</p>
  </li>
  <li>
    <p>LLDP is only received on network interfaces with state UP.</p>
  </li>
</ul>

<h2 id="benefit-to-ovirt">Benefit to oVirt</h2>

<p>Information from LLDP provided by oVirt engine's REST-API will support the
integration of oVirt in other software.</p>

<h2 id="requirements">Requirements</h2>

<ul>
  <li>The following TLVs have to be available in oVirt Engine's REST API:
    <ul>
      <li>Chassis ID TLV (Type = 1)</li>
      <li>Port ID TLV (Type = 2)</li>
      <li>Port Description TLV (Type = 4), with a value of up to 512 chars</li>
      <li>System Name TLV (Type = 5)</li>
      <li>System Description TLV (Type = 6)</li>
      <li>Management Address TLV (Type = 8)</li>
      <li>Port VLAN Id ( Type = 127, Oui = 0x0080c2 (802.1), Subtype = 1)</li>
      <li>VLAN name (Type = 127, Oui = 0x0080c2 (802.1), Subtype = 3)</li>
      <li>Link Aggregation TLV (Type = 127, Oui = 0x0080c2 (802.1), Subtype = 7)</li>
      <li>Maximum Frame Size TLV (Type = 127,  Oui = 0x00120F (802.3), Subtype = 4)</li>
    </ul>
  </li>
  <li>oVirt should keep track of the hosts and their neighbors which are active
and report only those when queried.</li>
</ul>

<h2 id="approach">Approach</h2>

<p>Steps to present the LLDP information:</p>

<ol>
  <li><a href="#vdsm-implementation-options">Receive LLDP information on the Ethernet cable on the host</a></li>
  <li><a href="#vdsm-implementation-options">Cache the LLDP information on the host</a></li>
  <li><a href="#communication-of-vdsm-and-ovirt-engine">Transport the LLDP information to oVirt Engine</a></li>
  <li>Present LLDP information:
    <ul>
      <li><a href="#rest-api">On REST-API</a></li>
      <li><a href="#follow-up-features">On Web-UI</a></li>
      <li><a href="#follow-up-features">For oVirt Engine internal use</a></li>
    </ul>
  </li>
</ol>

<p>If the LLDP information is used internally in oVirt Engine or in Web-UI, it
would be useful to cache the information in the data base.</p>

<p>To meet the requirements of this feature, there is no need to store the
information in the data base, because the information could be queried when a
REST request is processed processed. This way the age of the information is
kept as minimal as possible.</p>

<p>Thus we opt to avoid the DB completely. When Engine is asked about LLDP data of
a host, it would contact the specific host synchronously in order to provide an
answer.</p>

<h2 id="gathering-the-lldp-data-from-the-hosts">Gathering the LLDP data from the hosts</h2>

<p>There are multiple alternatives for oVirt Engine to gather the LLDP data from
the hosts:</p>

<ul>
  <li>
    <p>Extend VDSM to provide the LLDP data</p>
  </li>
  <li>
    <p>Use <a href="http://docs.ansible.com/ansible/lldp_module.html">Ansible's lldp module</a></p>
  </li>
</ul>

<p>Because the Ansible module is flagged as preview and requires lldpd, which is
in only in EPEL repository for RHEL, VDSM has to be extended.</p>

<h2 id="vdsm-implementation-options">VDSM implementation options</h2>

<p>VDSM is planned to collect LLDP information through lldpad or NetworkManager
services.</p>

<ul>
  <li>lldpad is as immediate solution to the data collection as it can be used by
VDSM as a driver without any special work dependency.</li>
  <li>In order to use NetworkManager, a preliminary work is required in VDSM to
fully integrate it as an active configuration driver, replacing the existing
ifcfg usage.</li>
</ul>

<p>The proposal is to start with lldpad as an immediate solution and continue with
NetworkManager when it will be integrated into VDSM to replace the ifcfg usage.
Then NetworkManager will become the default driver that collects LLDP information.</p>

<h4 id="code-module-structure">Code Module structure</h4>

<p>These are the modules involved in the LLDP driver &amp; interface:</p>

<ul>
  <li>vdsm.network.lldpad : lldpad driver, using the lldptool as the cli client.</li>
  <li>vdsm.network.lldp : LLDP API interface, containing the lldpad driver interface
(which implements the LLDP API interface using the lldpad driver).</li>
</ul>

<h3 id="vdsm---lldpad">VDSM - lldpad</h3>

<p>lldpad is a service which is able to send and receive LLDP on network interfaces.
lldpad caches LLDP received information and lldptool can query this information.</p>

<p>The vdsmd service wants the lldpad service to be started as a weak dependency.
The interfaces on which lldap provides LLDP has to be configured explicitly by
VDSM.</p>

<p>VDSM, running in SELinux context <code>virtd_t</code>, uses the command line client
lldptool to communicate with the lldpad service,
running in SELinux context <code>lldpad_t</code>. This communication has to be <a href="https://bugzilla.redhat.com/1472722">explicitly
allowed</a>.</p>

<h3 id="lldp-report-formats">LLDP report formats</h3>

<p>lldptool and NetworkManager report in LLDP information in different formats.
Even different TLVs are formatted in a different way in the same tool.
For this reason there is a dedicated parsing required for nearly each TLV.</p>

<p>There are two alternatives to handle TLVs without a dedicated parsing function.
They could be discarded, or presented in a format depending on the underlying
tool.
To ensure at least implementation-independent names in the output, TLVs without
a dedicated parsing function are discarded. If an additional TLV is required,
an additional parsing function has to be added to the LLDP driver in VDSM.</p>

<p>lldptool report example:</p>

<div class="highlight"><pre class="highlight plaintext"><code>Chassis ID TLV&#x000A;	MAC: 30:7c:5e:84:e1:a0&#x000A;Port ID TLV&#x000A;	Local: 510&#x000A;Time to Live TLV&#x000A;	120&#x000A;System Name TLV&#x000A;	rack11-sw02-lab4.tlv&#x000A;System Description TLV&#x000A;	Juniper Networks, Inc. ...&#x000A;System Capabilities TLV&#x000A;	System capabilities:  Bridge, Router&#x000A;	Enabled capabilities: Bridge, Router&#x000A;Port Description TLV&#x000A;	ge-0/0/2&#x000A;MAC/PHY Configuration Status TLV&#x000A;	Auto-negotiation supported and enabled&#x000A;	PMD auto-negotiation capabilities: 0x0001&#x000A;	MAU type: Unknown [0x0000]&#x000A;Link Aggregation TLV&#x000A;	Aggregation capable&#x000A;	Currently not aggregated&#x000A;	Aggregated Port ID: 0&#x000A;Maximum Frame Size TLV&#x000A;	9216&#x000A;Port VLAN ID TLV&#x000A;	PVID: 2000&#x000A;VLAN Name TLV&#x000A;	VID 2000: Name foo&#x000A;VLAN Name TLV&#x000A;	VID 2001: Name bar&#x000A;VLAN Name TLV&#x000A;	VID 2002: Name foobar&#x000A;Unidentified Org Specific TLV&#x000A;	OUI: 0x009069, Subtype: 1, Info: 504533373135323130333833&#x000A;LLDP-MED Capabilities TLV&#x000A;	Device Type:  netcon&#x000A;	Capabilities: LLDP-MED, Network Policy, Location Identification, Extended Power via MDI-PSE&#x000A;End of LLDPDU TLV&#x000A;</code></pre></div>
<p>NetworkManager report example:</p>

<div class="highlight"><pre class="highlight plaintext"><code>NEIGHBOR[0].DEVICE:                     enp5s0f0&#x000A;NEIGHBOR[0].CHASSIS-ID:                 18:EF:63:A1:66:AD&#x000A;NEIGHBOR[0].PORT-ID:                    Gi0/45&#x000A;NEIGHBOR[0].PORT-DESCRIPTION:           GigabitEthernet0/45&#x000A;NEIGHBOR[0].SYSTEM-NAME:                rack11-sw01-lab4.tlv.redhat.com&#x000A;NEIGHBOR[0].SYSTEM-DESCRIPTION:         Cisco ...&#x000A;NEIGHBOR[0].SYSTEM-CAPABILITIES:        20 (mac-bridge,router)&#x000A;NEIGHBOR[0].IEEE-802-1-PVID:            150&#x000A;NEIGHBOR[0].IEEE-802-1-PPVID:           --&#x000A;NEIGHBOR[0].IEEE-802-1-PPVID-FLAGS:     --&#x000A;NEIGHBOR[0].IEEE-802-1-VID:             --&#x000A;NEIGHBOR[0].IEEE-802-1-VLAN-NAME:       --&#x000A;NEIGHBOR[0].DESTINATION:                nearest-bridge&#x000A;NEIGHBOR[0].CHASSIS-ID-TYPE:            4&#x000A;NEIGHBOR[0].PORT-ID-TYPE:               7&#x000A;</code></pre></div>
<h2 id="communication-of-vdsm-and-ovirt-engine">Communication of VDSM and oVirt Engine</h2>
<p>If the LLDP information is cached in the data base, it would be useful
to update the LLDP information together with the other information about the
network cards on the host by <code>Host.getCapabilities</code>.</p>

<p>However, at the moment, LLDP information is only required, if requested via the
REST-API. To avoid triggering the extensive <code>Host.getCapabilities</code>, if only the
LLDP information are needed, the new verb <code>Host.getLldp</code> is introduced.</p>

<div class="highlight"><pre class="highlight yaml"><code><span class="na">types</span><span class="pi">:</span>&#x000A;    <span class="na">Tlv</span><span class="pi">:</span> <span class="nl">&amp;Tlv</span>&#x000A;        <span class="na">added</span><span class="pi">:</span> <span class="s1">'</span><span class="s">4.2'</span>&#x000A;        <span class="na">description</span><span class="pi">:</span> <span class="s">LLDP Information</span>&#x000A;        <span class="na">name</span><span class="pi">:</span> <span class="s">Tlv</span>&#x000A;        <span class="na">properties</span><span class="pi">:</span>&#x000A;        <span class="pi">-</span> <span class="na">description</span><span class="pi">:</span> <span class="s">Human readable string to describe what the value is</span>&#x000A;              <span class="s">about.</span>&#x000A;          <span class="na">name</span><span class="pi">:</span> <span class="s">name</span>&#x000A;          <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>&#x000A;&#x000A;        <span class="pi">-</span> <span class="na">description</span><span class="pi">:</span> <span class="s">Structured information of the TLV</span>&#x000A;          <span class="na">name</span><span class="pi">:</span> <span class="s">properties</span>&#x000A;          <span class="na">type</span><span class="pi">:</span> <span class="nv">*StringMap</span>&#x000A;&#x000A;        <span class="pi">-</span> <span class="na">description</span><span class="pi">:</span> <span class="s">TLV type of IEEE 802.1AB.</span>&#x000A;          <span class="na">name</span><span class="pi">:</span> <span class="s">type</span>&#x000A;          <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>&#x000A;          <span class="na">datatype</span><span class="pi">:</span> <span class="s">uint</span>&#x000A;&#x000A;        <span class="pi">-</span> <span class="na">description</span><span class="pi">:</span> <span class="s">organizationally unique identifier</span>&#x000A;          <span class="na">name</span><span class="pi">:</span> <span class="s">oui</span>&#x000A;          <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>&#x000A;          <span class="na">datatype</span><span class="pi">:</span> <span class="s">uint</span>&#x000A;&#x000A;        <span class="pi">-</span> <span class="na">description</span><span class="pi">:</span> <span class="s">organizationally defined subtype</span>&#x000A;          <span class="na">name</span><span class="pi">:</span> <span class="s">subtype</span>&#x000A;          <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>&#x000A;          <span class="na">datatype</span><span class="pi">:</span> <span class="s">uint</span>&#x000A;&#x000A;    <span class="na">Lldp</span><span class="pi">:</span> <span class="nl">&amp;Lldp</span>&#x000A;        <span class="na">added</span><span class="pi">:</span> <span class="s1">'</span><span class="s">4.2'</span>&#x000A;        <span class="na">description</span><span class="pi">:</span> <span class="s">LLDP Information</span>&#x000A;        <span class="na">name</span><span class="pi">:</span> <span class="s">Lldp</span>&#x000A;        <span class="na">properties</span><span class="pi">:</span>&#x000A;        <span class="pi">-</span> <span class="na">description</span><span class="pi">:</span> <span class="s">Gathering LLDP information is enabled on the NIC</span>&#x000A;          <span class="na">name</span><span class="pi">:</span> <span class="s">enabled</span>&#x000A;          <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>&#x000A;          <span class="na">datatype</span><span class="pi">:</span> <span class="s">boolean</span>&#x000A;        <span class="pi">-</span> <span class="na">description</span><span class="pi">:</span> <span class="s">List of structured information of the TLVs</span>&#x000A;          <span class="na">name</span><span class="pi">:</span> <span class="s">tlvs</span>&#x000A;          <span class="na">type</span><span class="pi">:</span>&#x000A;          <span class="pi">-</span> <span class="nv">*Tlv</span>&#x000A;&#x000A;    <span class="na">LldpMap</span><span class="pi">:</span> <span class="nl">&amp;LldpMap</span>&#x000A;        <span class="na">added</span><span class="pi">:</span> <span class="s1">'</span><span class="s">4.2'</span>&#x000A;        <span class="na">description</span><span class="pi">:</span> <span class="s">A mapping from interface name to LLDP information</span>&#x000A;        <span class="na">key-type</span><span class="pi">:</span> <span class="s">string</span>&#x000A;        <span class="na">name</span><span class="pi">:</span> <span class="nv">*LldpMap</span>&#x000A;        <span class="na">type</span><span class="pi">:</span> <span class="s">map</span>&#x000A;        <span class="na">value-type</span><span class="pi">:</span> <span class="nv">*Lldp</span>&#x000A;&#x000A;&#x000A;<span class="s">Host.getLldp</span><span class="pi">:</span>&#x000A;    <span class="na">added</span><span class="pi">:</span> <span class="s1">'</span><span class="s">4.2'</span>&#x000A;    <span class="na">description</span><span class="pi">:</span> <span class="s">Get lldp information of a NIC</span>&#x000A;    <span class="na">params</span><span class="pi">:</span>&#x000A;    <span class="pi">-</span>   <span class="na">description</span><span class="pi">:</span> <span class="s">Restrict the reported lldp information. Empty restriction</span>&#x000A;            <span class="s">means to report all lldp information from all NICs.</span>&#x000A;        <span class="na">name</span><span class="pi">:</span> <span class="s">filter</span>&#x000A;        <span class="na">type</span><span class="pi">:</span> <span class="nv">*StringListMap</span>&#x000A;    <span class="na">return</span><span class="pi">:</span>&#x000A;        <span class="na">description</span><span class="pi">:</span> <span class="s">Lldp information of a NIC</span>&#x000A;        <span class="na">type</span><span class="pi">:</span> <span class="nv">*LldpMap</span>&#x000A;&#x000A;</code></pre></div>
<h2 id="entity-description">Entity Description</h2>

<p>The initial LLDP information is encoded as a list of type, length, value (TLV) tuples.
To express multiple values, e.g. to list the allowed VLANs on a switch port,
the TLV is sent multiple times.
The value may contain structured data.
This way the LLDP data is non-uniform.
This non-uniform LLDP data will be mapped to the following uniform entities.</p>

<p>The entity <code>Tlv</code> represents the TLV received physically by the oVirt host's NIC.
A <code>Tlv</code> is associated to a <code>VdsNetworkInterface</code>, called
<a href="http://ovirt.github.io/ovirt-engine-api-model/4.2/#types/host_nic"><code>HostNic</code> in REST-API</a>,
has a <code>name</code>, a <code>type</code>, a list of <code>properties</code> and optional an <code>oui</code> and a
<code>subtype</code>.</p>

<p><img alt="Class diagramm of Tlv" title="Class diagramm of Tlv" src="/images/../../../../images/wiki/EntityTlv.png" /></p>

<p>The <code>name</code> is a human readable string to describe what the value is about and
may not be unique. The name is redundant, because it could be created from
<code>type</code> and the optional <code>oui</code> and <code>subtype</code>. The purpose of <code>name</code> is
to simplify the reading of the TLV.
The <code>name</code> of a property is exactly the same string which is used in
<a href="http://standards.ieee.org/getieee802/download/802.1AB-2016.zip">IEEE 802.1AB</a> chapter 8.</p>

<p>The <code>type</code> is the TLV type of <a href="http://standards.ieee.org/getieee802/download/802.1AB-2016.zip">IEEE 802.1AB</a>.</p>

<p>Organizationally Specific <code>Tlv</code>s have the <code>type</code> of <code>127</code> and the attributes
<code>oui</code> and <code>subtype</code>.
The <code>oui</code> holds the organizationally unique identifier, and the <code>subtype</code> the
organizationally defined subtype.</p>

<p>The <code>properties</code> are used to represent structured information transported by the
TLV.</p>

<p>The entity <code>LldpInfo</code> has a list of all <code>Tlv</code>s of an interface and shows if the
gathering of the LLDP information is <code>enabled</code> on the interface. If it is
not <code>enabled</code>, there is a problem gathering the LLDP information on the interface.
Problems on gathering LLDP information might be that the interface is down or
LLDP is not enabled on the interface.</p>

<h2 id="crud">CRUD</h2>

<p>The CRUD operations are not needed, because the implementation does not use the
data base.</p>

<h2 id="user-experience">User Experience</h2>

<h3 id="rest-api">REST-API</h3>

<p>The LLDP information are read-only. They could be read by a request like</p>

<div class="highlight"><pre class="highlight plaintext"><code>GET https://ovirtexampleengine/ovirt-engine/api/hosts/123/nics/321/linklayerdiscoveryprotocolelements&#x000A;</code></pre></div>
<p>Depending on the HTTP <code>Accept</code> header used in this request, oVirt Engine will
respond in JSON or XML.
A problem in gathering the LLDP information would result in an empty list of
<code>link_layer_discovery_protocol_elements</code> on the REST-API.
The response in XML for the <a href="https://wiki.wireshark.org/SampleCaptures?action=AttachFile&amp;do=view&amp;target=lldp.detailed.pcap">SampleCaptures from Wireshark's wiki</a> will look like this</p>

<div class="highlight"><pre class="highlight xml"><code><span class="nt">&lt;link_layer_discovery_protocol_elements&gt;</span>&#x000A;  <span class="nt">&lt;link_layer_discovery_protocol_element&gt;</span>&#x000A;    <span class="nt">&lt;name&gt;</span>Chassis ID<span class="nt">&lt;/name&gt;</span>&#x000A;    <span class="nt">&lt;properties&gt;</span>&#x000A;      <span class="nt">&lt;property&gt;</span>&#x000A;        <span class="nt">&lt;name&gt;</span>chassis ID subtype<span class="nt">&lt;/name&gt;</span>&#x000A;        <span class="nt">&lt;value&gt;</span>MAC address<span class="nt">&lt;/value&gt;</span>&#x000A;      <span class="nt">&lt;/property&gt;</span>&#x000A;      <span class="nt">&lt;property&gt;</span>&#x000A;        <span class="nt">&lt;name&gt;</span>chassis ID<span class="nt">&lt;/name&gt;</span>&#x000A;        <span class="nt">&lt;value&gt;</span>00:01:30:f9:ad:a0<span class="nt">&lt;/value&gt;</span>&#x000A;      <span class="nt">&lt;/property&gt;</span>&#x000A;    <span class="nt">&lt;/properties&gt;</span>&#x000A;    <span class="nt">&lt;type&gt;</span>1<span class="nt">&lt;/type&gt;</span>&#x000A;  <span class="nt">&lt;/link_layer_discovery_protocol_element&gt;</span>&#x000A;  <span class="nt">&lt;link_layer_discovery_protocol_element&gt;</span>&#x000A;    <span class="nt">&lt;name&gt;</span>Port ID<span class="nt">&lt;/name&gt;</span>&#x000A;    <span class="nt">&lt;properties&gt;</span>&#x000A;      <span class="nt">&lt;property&gt;</span>&#x000A;        <span class="nt">&lt;name&gt;</span>port ID subtype<span class="nt">&lt;/name&gt;</span>&#x000A;        <span class="nt">&lt;value&gt;</span>Interface Name<span class="nt">&lt;/value&gt;</span>&#x000A;      <span class="nt">&lt;/property&gt;</span>&#x000A;      <span class="nt">&lt;property&gt;</span>&#x000A;        <span class="nt">&lt;name&gt;</span>port ID<span class="nt">&lt;/name&gt;</span>&#x000A;        <span class="nt">&lt;value&gt;</span>1/1<span class="nt">&lt;/value&gt;</span>&#x000A;      <span class="nt">&lt;/property&gt;</span>&#x000A;    <span class="nt">&lt;/properties&gt;</span>&#x000A;    <span class="nt">&lt;type&gt;</span>2<span class="nt">&lt;/type&gt;</span>&#x000A;  <span class="nt">&lt;/link_layer_discovery_protocol_element&gt;</span>&#x000A;  <span class="nt">&lt;link_layer_discovery_protocol_element&gt;</span>&#x000A;    <span class="nt">&lt;name&gt;</span>Time to Live<span class="nt">&lt;/name&gt;</span>&#x000A;    <span class="nt">&lt;properties&gt;</span>&#x000A;      <span class="nt">&lt;property&gt;</span>&#x000A;        <span class="nt">&lt;name&gt;</span>TTL<span class="nt">&lt;/name&gt;</span>&#x000A;        <span class="nt">&lt;value&gt;</span>120<span class="nt">&lt;/value&gt;</span>&#x000A;      <span class="nt">&lt;/property&gt;</span>&#x000A;    <span class="nt">&lt;/properties&gt;</span>&#x000A;    <span class="nt">&lt;type&gt;</span>3<span class="nt">&lt;/type&gt;</span>&#x000A;  <span class="nt">&lt;/link_layer_discovery_protocol_element&gt;</span>&#x000A;  <span class="nt">&lt;link_layer_discovery_protocol_element&gt;</span>&#x000A;    <span class="nt">&lt;name&gt;</span>Port Description<span class="nt">&lt;/name&gt;</span>&#x000A;    <span class="nt">&lt;properties&gt;</span>&#x000A;      <span class="nt">&lt;property&gt;</span>&#x000A;        <span class="nt">&lt;name&gt;</span>port description<span class="nt">&lt;/name&gt;</span>&#x000A;        <span class="nt">&lt;value&gt;</span>Summit300-48-Port 1001<span class="nt">&lt;/value&gt;</span>&#x000A;      <span class="nt">&lt;/property&gt;</span>&#x000A;    <span class="nt">&lt;/properties&gt;</span>&#x000A;    <span class="nt">&lt;type&gt;</span>4<span class="nt">&lt;/type&gt;</span>&#x000A;  <span class="nt">&lt;/link_layer_discovery_protocol_element&gt;</span>&#x000A;  <span class="nt">&lt;link_layer_discovery_protocol_element&gt;</span>&#x000A;    <span class="nt">&lt;name&gt;</span>System Name<span class="nt">&lt;/name&gt;</span>&#x000A;    <span class="nt">&lt;properties&gt;</span>&#x000A;      <span class="nt">&lt;property&gt;</span>&#x000A;        <span class="nt">&lt;name&gt;</span>system name<span class="nt">&lt;/name&gt;</span>&#x000A;        <span class="nt">&lt;value&gt;</span>Summit300-48<span class="nt">&lt;/value&gt;</span>&#x000A;      <span class="nt">&lt;/property&gt;</span>&#x000A;    <span class="nt">&lt;/properties&gt;</span>&#x000A;    <span class="nt">&lt;type&gt;</span>5<span class="nt">&lt;/type&gt;</span>&#x000A;  <span class="nt">&lt;/link_layer_discovery_protocol_element&gt;</span>&#x000A;  <span class="nt">&lt;link_layer_discovery_protocol_element&gt;</span>&#x000A;    <span class="nt">&lt;name&gt;</span>System Description<span class="nt">&lt;/name&gt;</span>&#x000A;    <span class="nt">&lt;properties&gt;</span>&#x000A;      <span class="nt">&lt;property&gt;</span>&#x000A;        <span class="nt">&lt;name&gt;</span>system description<span class="nt">&lt;/name&gt;</span>&#x000A;        <span class="nt">&lt;value&gt;</span>Summit300-48 - Version 7.4e.1 (Build 5) by Release_Master 05/27/05 04:53:11<span class="nt">&lt;/value&gt;</span>&#x000A;      <span class="nt">&lt;/property&gt;</span>&#x000A;    <span class="nt">&lt;/properties&gt;</span>&#x000A;    <span class="nt">&lt;type&gt;</span>6<span class="nt">&lt;/type&gt;</span>&#x000A;  <span class="nt">&lt;/link_layer_discovery_protocol_element&gt;</span>&#x000A;  <span class="nt">&lt;link_layer_discovery_protocol_element&gt;</span>&#x000A;    <span class="nt">&lt;name&gt;</span>System Capabilities<span class="nt">&lt;/name&gt;</span>&#x000A;    <span class="nt">&lt;properties&gt;</span>&#x000A;      <span class="nt">&lt;property&gt;</span>&#x000A;        <span class="nt">&lt;name&gt;</span>system capabilities<span class="nt">&lt;/name&gt;</span>&#x000A;        <span class="nt">&lt;value&gt;</span>Bridge, Router<span class="nt">&lt;/value&gt;</span>&#x000A;      <span class="nt">&lt;/property&gt;</span>&#x000A;      <span class="nt">&lt;property&gt;</span>&#x000A;        <span class="nt">&lt;name&gt;</span>enabled capabilities<span class="nt">&lt;/name&gt;</span>&#x000A;        <span class="nt">&lt;value&gt;</span>Bridge, Router<span class="nt">&lt;/value&gt;</span>&#x000A;      <span class="nt">&lt;/property&gt;</span>&#x000A;    <span class="nt">&lt;/properties&gt;</span>&#x000A;    <span class="nt">&lt;type&gt;</span>7<span class="nt">&lt;/type&gt;</span>&#x000A;  <span class="nt">&lt;/link_layer_discovery_protocol_element&gt;</span>&#x000A;  <span class="nt">&lt;link_layer_discovery_protocol_element&gt;</span>&#x000A;    <span class="nt">&lt;name&gt;</span>Management Address<span class="nt">&lt;/name&gt;</span>&#x000A;    <span class="nt">&lt;properties&gt;</span>&#x000A;      <span class="nt">&lt;property&gt;</span>&#x000A;        <span class="nt">&lt;name&gt;</span>management address subtype<span class="nt">&lt;/name&gt;</span>&#x000A;        <span class="nt">&lt;value&gt;</span>AFI 802<span class="nt">&lt;/value&gt;</span>&#x000A;      <span class="nt">&lt;/property&gt;</span>&#x000A;      <span class="nt">&lt;property&gt;</span>&#x000A;        <span class="nt">&lt;name&gt;</span>management address<span class="nt">&lt;/name&gt;</span>&#x000A;        <span class="nt">&lt;value&gt;</span>00:01:30:f9:ad:a0<span class="nt">&lt;/value&gt;</span>&#x000A;      <span class="nt">&lt;/property&gt;</span>&#x000A;    <span class="nt">&lt;/properties&gt;</span>&#x000A;    <span class="nt">&lt;type&gt;</span>8<span class="nt">&lt;/type&gt;</span>&#x000A;  <span class="nt">&lt;/link_layer_discovery_protocol_element&gt;</span>&#x000A;  <span class="nt">&lt;link_layer_discovery_protocol_element&gt;</span>&#x000A;    <span class="nt">&lt;name&gt;</span>Port VLAN Id<span class="nt">&lt;/name&gt;</span>&#x000A;    <span class="nt">&lt;oui&gt;</span>32962<span class="nt">&lt;/oui&gt;</span>&#x000A;    <span class="nt">&lt;properties&gt;</span>&#x000A;      <span class="nt">&lt;property&gt;</span>&#x000A;        <span class="nt">&lt;name&gt;</span>port vlan id<span class="nt">&lt;/name&gt;</span>&#x000A;        <span class="nt">&lt;value&gt;</span>488<span class="nt">&lt;/value&gt;</span>&#x000A;      <span class="nt">&lt;/property&gt;</span>&#x000A;    <span class="nt">&lt;/properties&gt;</span>&#x000A;    <span class="nt">&lt;subtype&gt;</span>1<span class="nt">&lt;/subtype&gt;</span>&#x000A;    <span class="nt">&lt;type&gt;</span>127<span class="nt">&lt;/type&gt;</span>&#x000A;  <span class="nt">&lt;/link_layer_discovery_protocol_element&gt;</span>&#x000A;  <span class="nt">&lt;link_layer_discovery_protocol_element&gt;</span>&#x000A;    <span class="nt">&lt;name&gt;</span>Port VLAN Id<span class="nt">&lt;/name&gt;</span>&#x000A;    <span class="nt">&lt;oui&gt;</span>32962<span class="nt">&lt;/oui&gt;</span>&#x000A;    <span class="nt">&lt;properties&gt;</span>&#x000A;      <span class="nt">&lt;property&gt;</span>&#x000A;        <span class="nt">&lt;name&gt;</span>vlan id<span class="nt">&lt;/name&gt;</span>&#x000A;        <span class="nt">&lt;value&gt;</span>488<span class="nt">&lt;/value&gt;</span>&#x000A;      <span class="nt">&lt;/property&gt;</span>&#x000A;      <span class="nt">&lt;property&gt;</span>&#x000A;        <span class="nt">&lt;name&gt;</span>vlan name<span class="nt">&lt;/name&gt;</span>&#x000A;        <span class="nt">&lt;value&gt;</span>v2-0488-03-0505<span class="nt">&lt;/value&gt;</span>&#x000A;      <span class="nt">&lt;/property&gt;</span>&#x000A;    <span class="nt">&lt;/properties&gt;</span>&#x000A;    <span class="nt">&lt;subtype&gt;</span>3<span class="nt">&lt;/subtype&gt;</span>&#x000A;    <span class="nt">&lt;type&gt;</span>127<span class="nt">&lt;/type&gt;</span>&#x000A;  <span class="nt">&lt;/link_layer_discovery_protocol_element&gt;</span>&#x000A;  <span class="nt">&lt;link_layer_discovery_protocol_element&gt;</span>&#x000A;    <span class="nt">&lt;name&gt;</span>Link Aggregation<span class="nt">&lt;/name&gt;</span>&#x000A;    <span class="nt">&lt;oui&gt;</span>32962<span class="nt">&lt;/oui&gt;</span>&#x000A;    <span class="nt">&lt;properties&gt;</span>&#x000A;      <span class="nt">&lt;property&gt;</span>&#x000A;        <span class="nt">&lt;name&gt;</span>Aggregation capable<span class="nt">&lt;/name&gt;</span>&#x000A;        <span class="nt">&lt;value&gt;</span>True<span class="nt">&lt;/value&gt;</span>&#x000A;      <span class="nt">&lt;/property&gt;</span>&#x000A;      <span class="nt">&lt;property&gt;</span>&#x000A;        <span class="nt">&lt;name&gt;</span>Currently aggregated<span class="nt">&lt;/name&gt;</span>&#x000A;        <span class="nt">&lt;value&gt;</span>True<span class="nt">&lt;/value&gt;</span>&#x000A;      <span class="nt">&lt;/property&gt;</span>&#x000A;      <span class="nt">&lt;property&gt;</span>&#x000A;        <span class="nt">&lt;name&gt;</span>Aggregated Port ID<span class="nt">&lt;/name&gt;</span>&#x000A;        <span class="nt">&lt;value&gt;</span>600<span class="nt">&lt;/value&gt;</span>&#x000A;      <span class="nt">&lt;/property&gt;</span>&#x000A;    <span class="nt">&lt;/properties&gt;</span>&#x000A;    <span class="nt">&lt;subtype&gt;</span>7<span class="nt">&lt;/subtype&gt;</span>&#x000A;    <span class="nt">&lt;type&gt;</span>127<span class="nt">&lt;/type&gt;</span>&#x000A;  <span class="nt">&lt;/link_layer_discovery_protocol_element&gt;</span>&#x000A;  <span class="nt">&lt;link_layer_discovery_protocol_element&gt;</span>&#x000A;    <span class="nt">&lt;name&gt;</span>MTU<span class="nt">&lt;/name&gt;</span>&#x000A;    <span class="nt">&lt;oui&gt;</span>4623<span class="nt">&lt;/oui&gt;</span>&#x000A;    <span class="nt">&lt;properties&gt;</span>&#x000A;      <span class="nt">&lt;property&gt;</span>&#x000A;        <span class="nt">&lt;name&gt;</span>mtu<span class="nt">&lt;/name&gt;</span>&#x000A;        <span class="nt">&lt;value&gt;</span>9018<span class="nt">&lt;/value&gt;</span>&#x000A;      <span class="nt">&lt;/property&gt;</span>&#x000A;    <span class="nt">&lt;/properties&gt;</span>&#x000A;    <span class="nt">&lt;subtype&gt;</span>4<span class="nt">&lt;/subtype&gt;</span>&#x000A;    <span class="nt">&lt;type&gt;</span>127<span class="nt">&lt;/type&gt;</span>&#x000A;  <span class="nt">&lt;/link_layer_discovery_protocol_element&gt;</span>&#x000A;<span class="nt">&lt;/link_layer_discovery_protocol_elements&gt;</span>&#x000A;</code></pre></div>
<h3 id="graphical-user-interface">Graphical User Interface</h3>

<p>LLDP information can be found in <strong>Hosts</strong> &gt; <strong>Network Interfaces</strong> &gt; 
<strong>Setup Host Networks</strong>. The interface tooltip will show the relevant 
information.</p>

<p><img alt="UI LDDP tooltip" title="UI LLDP tooltip" src="/images/../../../../images/wiki/lldp_ui.png" /></p>

<h2 id="installationupgrade">Installation/Upgrade</h2>

<p>The VDSM package would require the package lldpad and ask the service lldpad to
start.</p>

<p>Describe how the feature will affect new or existing installations.</p>

<h2 id="user-work-flows">User work-flows</h2>

<p>The user gets the information about the networking neighbor via REST-API.</p>

<h2 id="dependencies">Dependencies</h2>

<h3 id="ovirt-engine-side">oVirt Engine Side</h3>

<p>No additional dependencies on oVirt Engine side.</p>

<h3 id="vdsm-host-side">VDSM Host Side</h3>

<p>The package lldpad has to be installed and the demon lldpad has to be running.</p>

<h2 id="documentation--external-references">Documentation &amp; External references</h2>

<p><a href="http://standards.ieee.org/getieee802/download/802.1AB-2016.zip">IEEE Std 802.1AB™-2016, IEEE Standard for Local and metropolitan area networks—Station and Media Access Control Connectivity Discovery</a></p>

<p><a href="https://www.kernel.org/doc/Documentation/networking/bonding.txt">Linux Ethernet Bonding Driver HOWTO</a></p>

<p><a href="http://docs.ansible.com/ansible/lldp_module.html">Ansible Docs » lldp - get details reported by lldp</a></p>

<p><a href="https://specs.openstack.org/openstack/ironic-inspector-specs/specs/lldp-reporting.html">OpenStack: Introspection LLDP reporting</a></p>

<p><a href="https://wiki.wireshark.org/SampleCaptures?action=AttachFile&amp;do=view&amp;target=lldp.detailed.pcap">SampleCaptures from Wireshark's wiki</a></p>

<p><a href="https://bugzilla.redhat.com/1472722">Bug 1472722 - SELinux is preventing /usr/sbin/lldpad from sendto access on the unix_dgram_socket</a></p>

<h2 id="testing">Testing</h2>

<p>Ensure <a href="#prerequisites">prerequisites</a> and use REST-API like in
<a href="#rest-api">example</a> above.</p>

<h2 id="follow-up-features">Follow-Up Features</h2>

<p>Another benefit of this feature is, that the information can be used by oVirt
Engine to configure the hosts in a smarter way. oVirt Engine could detect and
avoid host networking configurations, which do not match the configuration of
the switch port the relevant host's network interface is connected to.
Example of relevant configuration options are:</p>

<ul>
  <li>The VLAN configuration of the host has to match the VLAN configuration of the
switch port. This could be used by oVirt Engine like following:
    <ul>
      <li>Assuming that interfaces are correctly patched to the correct ports,
which have VLAN and such already assigned, it may be able to already
configure automatically the networks on the host when adding the host.</li>
      <li>Once a network is defined with a specific VLAN-ID, oVirt Engine could
automatically attach it to the proper NIC on all hosts in the cluster.
This would be an even simpler user experience than using labels.</li>
      <li>If a host should be connected to a given VLAN, there might be only a
single network interface of the host which is connected to a switch port
which allows the usage of this VLAN.</li>
    </ul>
  </li>
  <li>
    <p>According to section "5. Switch Configuration" in
<a href="https://www.kernel.org/doc/Documentation/networking/bonding.txt">Linux Ethernet Bonding Driver HOWTO</a>, the bonding modes
balance-rr (0), balance-xor (2), broadcast (3), 802.3ad (4) may require
configuration on switch side.</p>
  </li>
  <li>The switch port might have constraints about the MTU.</li>
</ul>

<p>Information from LLDP provided by the UI might help the user to avoid and
locate manual host network configuration errors caused by a mismatch of switch
port configuration.</p>

<h2 id="release-notes">Release Notes</h2>

<div class="highlight"><pre class="highlight plaintext"><code>  == Link Layer Discovery Protocol (LLDP) Support  ==&#x000A;  oVirt Engine provides access via REST-API to values gathered on the hosts by LLDP.&#x000A;</code></pre></div>

</section>
</section>
</section>
<footer class='text-center' id='footer'>
<hr class='visible-print'>
<ul class='footer-nav-list'>
<li><a target="_blank" href="../../../../site/privacy-policy.html">Privacy policy</a></li>
<li><a target="_blank" href="../../../../community/about.html">About</a></li>
<li><a target="_blank" href="../../../../site/general-disclaimer.html">Disclaimers</a></li>
</ul>

&copy; 2013&ndash;2019 oVirt
<div class='edit-this-page'>
<a target="_blank" href="https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/source/develop/release-management/features/network/lldp.html.md&amp;template="><i class="icon fa fa-github"></i>Report an issue with this page</a>
</div>
<div class='edit-this-page'>
<a target="_blank" href="https://github.com/oVirt/ovirt-site/edit/master/source/develop/release-management/features/network/lldp.html.md"><i class="icon fa fa-github"></i>Edit this page</a>
</div>
<div class='last-modified'>
Page last modified
Wed 15 Nov 2017 12:53 UTC
</div>
        <script type="text/javascript">
        var _paq = _paq || [];
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
        var u=(("https:" == document.location.protocol) ? "https" : "http") + "://stats.phx.ovirt.org/";
        _paq.push(['setTrackerUrl', u+'piwik.php']);
        _paq.push(['setSiteId', 1]);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0]; g.type='text/javascript';
        g.defer=true; g.async=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
        })();
        </script>
<noscript><p><img src="https://stats.phx.ovirt.org/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
</footer>


<script src="/javascripts/application.js?1560777657" type="text/javascript"></script>

</body>
</html>
