<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie10 lt-ie9 lt-ie8 lt-ie7" lang="en-us"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie10 lt-ie9 lt-ie8" lang="en-us"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie10 lt-ie9" lang="en-us"> <![endif]-->
<!--[if IE 9]> <html class="no-js lt-ie10 lt-ie9" lang="en-us"> <![endif]-->
<!--[if lt IE 10]> <html class="no-js lt-ie10" lang="en-us"> <![endif]-->
<!--[if !IE]> > <![endif]-->
<html class='no-js' lang='en'>
<!-- <![endif] -->
<head>
<title>
SPM Priority &mdash;
oVirt
</title>
<meta charset='utf-8'>
<meta content='' name='description'>
<meta content='' name='author'>
<meta content='initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width' name='viewport'>

<link href='/images/favicon.ico' rel='shortcut icon'>
<link href='/images/apple-touch-icon-precomposed.png' rel='apple-touch-icon-precomposed'>
<link href='/images/apple-touch-icon-57x57-precomposed.png' rel='apple-touch-icon-precomposed' sizes='57x57'>
<link href='/images/apple-touch-icon-72x72-precomposed.png' rel='apple-touch-icon-precomposed' sizes='72x72'>
<link href='/images/apple-touch-icon-114x114-precomposed.png' rel='apple-touch-icon-precomposed' sizes='114x114'>
<link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet'>
<link href="/stylesheets/application.css?1560777611" rel="stylesheet" type="text/css" />
<link href="/stylesheets/print.css?1560777612" rel="stylesheet" type="text/css" media="print" />
</head>
<body class=' source-md'>
<header class='masthead hidden-print' id='branding' role='banner'>
<section class='hgroup'></section>
<div id='access'>
<nav id="mainNav" class="navbar-fixed-top affix-top navForMobileHack" style="font-family: 'Open Sans', sans-serif; display: flex; justify-content: center;">
      <a href="/"><img id="logo" style="float: left; margin-right: 70px; height: 40px; padding: 0; margin-top: 12px;" alt="oVirt" src="/images/logo.svg"></a>
      <div>
          <div class="navbar-header page-scroll" style="min-width: 170px">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#menu_id0980fddf">
                  <span class="sr-only">Toggle navigation</span> Menu <i class="fa fa-bars"></i>
              </button>
          </div>

          <!-- Collect the nav links, forms, and other content for toggling -->
          <div class="collapse navbar-collapse" id="menu_id0980fddf">

              <ul class="nav navbar-nav">
                  <li class="hidden active">
                      <a href="#page-top"></a>
                  </li>
<li role='menuitem'>
  <a href='/'>Home</a>
</li>

<li role='menuitem'>
  <a href='/download/'>Download</a>
</li>

<li role='menuitem'>
  <a href='/documentation/'>Documentation</a>
</li>

<li role='menuitem'>
  <a href='/develop/'>Developers</a>
</li>

<li role='menuitem'>
  <a href='/community/'>Community</a>
</li>

<li role='menuitem'>
  <a href='//lists.ovirt.org/archives/'>Forum</a>
</li>

<li role='menuitem'>
  <a href='/blog/'>Blog</a>
</li>

              </ul>
          </div>
          <!-- /.navbar-collapse -->
      </div>
      <!-- /.container-fluid -->
  </nav>

</div>
</header>

<section class='page-wrap' id='page-wrap'>
<section class='page' id='page'>
<ul class='breadcrumb'>
<li><a href="/develop/">Develop</a></li>
<li><a href="/develop/release-management/">Release-management</a></li>
<li><a href="/develop/release-management/features/">Features</a></li>
<li><a href="/develop/release-management/features/storage/">Storage</a></li>
</ul>

<section class='container content' id='content'>
<div class='alert alert-warning'>
Feature pages are design documents that developers have created while collaborating on oVirt.
<br>
<br>
Most of them are
<strong>
outdated
</strong>
, but provide historical design context.
<br>
<br>
They are
<strong>
not
</strong>
user documentation and should not be treated as such.
<br>
<br>
<a href='/documentation/'>Documentation is available here.</a>
</div>
<h1 id="spm-priority">SPM Priority</h1>

<h2 id="summary">Summary</h2>

<p>The SPM Priority feature allows the admin to define priorities between hosts regarding the SPM selection process. A host can be given priority <code>-1</code> which means this host can not be selected to be the SPM.</p>

<h2 id="owner">Owner</h2>

<ul>
  <li>Feature owner: Muli Salem (<a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#109;&#115;&#097;&#108;&#101;&#109;&#064;&#114;&#101;&#100;&#104;&#097;&#116;&#046;&#099;&#111;&#109;">&#109;&#115;&#097;&#108;&#101;&#109;&#064;&#114;&#101;&#100;&#104;&#097;&#116;&#046;&#099;&#111;&#109;</a>)</li>
  <li>QA Owner: Leonid Natapov (<a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#108;&#110;&#097;&#112;&#097;&#116;&#111;&#118;&#064;&#114;&#101;&#100;&#104;&#097;&#116;&#046;&#099;&#111;&#109;">&#108;&#110;&#097;&#112;&#097;&#116;&#111;&#118;&#064;&#114;&#101;&#100;&#104;&#097;&#116;&#046;&#099;&#111;&#109;</a>)</li>
</ul>

<h2 id="current-status">Current status</h2>

<ul>
  <li>Status: Released in oVirt 3.1</li>
</ul>

<h2 id="description">Description</h2>

<p>Currently, the SPM selection process is random, meaning a host is chosen randomly out of the hosts that are currently UP. The SPM Priority feature will allow admins to define the hosts that they prefer to be chosen as SPM.</p>

<h2 id="prd">PRD</h2>

<p>The requirements are the following:</p>

<ol>
  <li>Enable setting a priority between <code>-1</code> and <code>10</code> for a host (<code>10</code> is the highest, <code>-1</code> means never to choose this host).</li>
  <li>When SPM selection process takes place, use the SPM priority to select an SPM.</li>
  <li>Default for upgrading ovirt will be 5.</li>
</ol>

<h2 id="design">Design</h2>

<h3 id="current-flow">Current flow:</h3>

<ol>
  <li>All hosts that are "UP", and that have not been attempted to be chosen as SPMs in the Data Center are fetched.</li>
  <li>One is chosen randomly, and the SPM Selection algorithm begins.</li>
  <li>Every host that fails to become the SPM, is added to the <code>mTriedVdssList</code> of forbidden hosts.</li>
</ol>

<h3 id="new-design">New Design:</h3>

<ol>
  <li>Adding a <code>vds_spm_priority</code> field to <code>vds_static</code> (validated to be between <code>-1</code> and <code>10</code>). This field is configurable upon host creation and host editing by the admin.</li>
  <li>Replacing the list that is fetched in stage one of the current flow, with a list of prioritized hosts (detailed algorithm below).</li>
</ol>

<h3 id="algorithm-for-selecting-a-host-according-to-priorities">Algorithm for selecting a host according to priorities</h3>

<ol>
  <li>Fetch all hosts that are "UP" in Data Center, and that have not been attempted to be chosen as SPMs in the Data Center. The selection will return the list ordered both by SPM Priority (desc), and secondly by RANDOM().</li>
  <li>The top host is chosen, and the SPM Selection algorithm begins.</li>
  <li>Every host that fails to become the SPM, is added to a the mTriedVdssList of forbidden hosts.</li>
</ol>

<ul>
  <li>Ordering the hosts according to the SPM Priority will make sure that the priorities set by the admin will be taken under consideration.</li>
  <li>Secondly, ordering them with <code>RANDOM()</code>, randomly sorts each sub group of hosts that have the same priority. This will prevent the same host from being chosen every time, in case there are several hosts with the same priority.</li>
</ul>

<h2 id="affected-commands">Affected Commands</h2>

<ol>
  <li><code>AddVdsCommand</code> - no change since the parameter held is of type <code>VdsStatic</code>.</li>
  <li><code>UpdateVdsCommand</code> - no change since the parameter held is of type <code>VdsStatic</code>.</li>
</ol>

<h2 id="rest-api-changes">REST API changes</h2>

<p>The <code>Host</code> resource schema was changed, and now the <code>storage_manager</code> element is of type <code>StorageManager</code> instead of <code>boolean</code>.</p>

<p>The schema for the <code>StorageManager</code> type is as follows:</p>

<div class="highlight"><pre class="highlight xml"><code><span class="nt">&lt;xs:element</span><span class="err"> </span><span class="na">name=</span><span class="s">"storage_manager"</span><span class="err"> </span><span class="na">type=</span><span class="s">"StorageManager"</span><span class="nt">/&gt;</span>&#x000A;<span class="nt">&lt;xs:complexType</span><span class="err"> </span><span class="na">name=</span><span class="s">"StorageManager"</span><span class="nt">&gt;</span>&#x000A;    <span class="nt">&lt;xs:simpleContent&gt;</span>&#x000A;        <span class="nt">&lt;xs:extension</span><span class="err"> </span><span class="na">base=</span><span class="s">"xs:boolean"</span><span class="nt">&gt;</span>&#x000A;            <span class="nt">&lt;xs:attribute</span><span class="err"> </span><span class="na">name=</span><span class="s">"priority"</span><span class="err"> </span><span class="na">type=</span><span class="s">"xs:int"</span><span class="nt">&gt;&lt;/xs:attribute&gt;</span>&#x000A;        <span class="nt">&lt;/xs:extension&gt;</span>&#x000A;    <span class="nt">&lt;/xs:simpleContent&gt;</span>&#x000A;<span class="nt">&lt;/xs:complexType&gt;</span>&#x000A;</code></pre></div>
</section>
</section>
</section>
<footer class='text-center' id='footer'>
<hr class='visible-print'>
<ul class='footer-nav-list'>
<li><a target="_blank" href="../../../../site/privacy-policy.html">Privacy policy</a></li>
<li><a target="_blank" href="../../../../community/about.html">About</a></li>
<li><a target="_blank" href="../../../../site/general-disclaimer.html">Disclaimers</a></li>
</ul>

&copy; 2013&ndash;2019 oVirt
<div class='edit-this-page'>
<a target="_blank" href="https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/source/develop/release-management/features/storage/spmpriority.html.md&amp;template="><i class="icon fa fa-github"></i>Report an issue with this page</a>
</div>
<div class='edit-this-page'>
<a target="_blank" href="https://github.com/oVirt/ovirt-site/edit/master/source/develop/release-management/features/storage/spmpriority.html.md"><i class="icon fa fa-github"></i>Edit this page</a>
</div>
<div class='last-modified'>
Page last modified
Wed 12 Jul 2017 17:57 UTC
</div>
        <script type="text/javascript">
        var _paq = _paq || [];
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
        var u=(("https:" == document.location.protocol) ? "https" : "http") + "://stats.phx.ovirt.org/";
        _paq.push(['setTrackerUrl', u+'piwik.php']);
        _paq.push(['setSiteId', 1]);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0]; g.type='text/javascript';
        g.defer=true; g.async=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
        })();
        </script>
<noscript><p><img src="https://stats.phx.ovirt.org/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
</footer>


<script src="/javascripts/application.js?1560777657" type="text/javascript"></script>

</body>
</html>
