<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie10 lt-ie9 lt-ie8 lt-ie7" lang="en-us"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie10 lt-ie9 lt-ie8" lang="en-us"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie10 lt-ie9" lang="en-us"> <![endif]-->
<!--[if IE 9]> <html class="no-js lt-ie10 lt-ie9" lang="en-us"> <![endif]-->
<!--[if lt IE 10]> <html class="no-js lt-ie10" lang="en-us"> <![endif]-->
<!--[if !IE]> > <![endif]-->
<html class='no-js' lang='en'>
<!-- <![endif] -->
<head>
<title>
Cinder Integration &mdash;
oVirt
</title>
<meta charset='utf-8'>
<meta content='' name='description'>
<meta content='' name='author'>
<meta content='initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width' name='viewport'>

<link href='/images/favicon.ico' rel='shortcut icon'>
<link href='/images/apple-touch-icon-precomposed.png' rel='apple-touch-icon-precomposed'>
<link href='/images/apple-touch-icon-57x57-precomposed.png' rel='apple-touch-icon-precomposed' sizes='57x57'>
<link href='/images/apple-touch-icon-72x72-precomposed.png' rel='apple-touch-icon-precomposed' sizes='72x72'>
<link href='/images/apple-touch-icon-114x114-precomposed.png' rel='apple-touch-icon-precomposed' sizes='114x114'>
<link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet'>
<link href="/stylesheets/application.css?1560777611" rel="stylesheet" type="text/css" />
<link href="/stylesheets/print.css?1560777612" rel="stylesheet" type="text/css" media="print" />
</head>
<body class=' source-md'>
<header class='masthead hidden-print' id='branding' role='banner'>
<section class='hgroup'></section>
<div id='access'>
<nav id="mainNav" class="navbar-fixed-top affix-top navForMobileHack" style="font-family: 'Open Sans', sans-serif; display: flex; justify-content: center;">
      <a href="/"><img id="logo" style="float: left; margin-right: 70px; height: 40px; padding: 0; margin-top: 12px;" alt="oVirt" src="/images/logo.svg"></a>
      <div>
          <div class="navbar-header page-scroll" style="min-width: 170px">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#menu_id0980fddf">
                  <span class="sr-only">Toggle navigation</span> Menu <i class="fa fa-bars"></i>
              </button>
          </div>

          <!-- Collect the nav links, forms, and other content for toggling -->
          <div class="collapse navbar-collapse" id="menu_id0980fddf">

              <ul class="nav navbar-nav">
                  <li class="hidden active">
                      <a href="#page-top"></a>
                  </li>
<li role='menuitem'>
  <a href='/'>Home</a>
</li>

<li role='menuitem'>
  <a href='/download/'>Download</a>
</li>

<li role='menuitem'>
  <a href='/documentation/'>Documentation</a>
</li>

<li role='menuitem'>
  <a href='/develop/'>Developers</a>
</li>

<li role='menuitem'>
  <a href='/community/'>Community</a>
</li>

<li role='menuitem'>
  <a href='//lists.ovirt.org/archives/'>Forum</a>
</li>

<li role='menuitem'>
  <a href='/blog/'>Blog</a>
</li>

              </ul>
          </div>
          <!-- /.navbar-collapse -->
      </div>
      <!-- /.container-fluid -->
  </nav>

</div>
</header>

<section class='page-wrap' id='page-wrap'>
<section class='page' id='page'>
<ul class='breadcrumb'>
<li><a href="/develop/">Develop</a></li>
<li><a href="/develop/release-management/">Release-management</a></li>
<li><a href="/develop/release-management/features/">Features</a></li>
<li><a href="/develop/release-management/features/storage/">Storage</a></li>
</ul>

<section class='container content' id='content'>
<div class='alert alert-warning'>
Feature pages are design documents that developers have created while collaborating on oVirt.
<br>
<br>
Most of them are
<strong>
outdated
</strong>
, but provide historical design context.
<br>
<br>
They are
<strong>
not
</strong>
user documentation and should not be treated as such.
<br>
<br>
<a href='/documentation/'>Documentation is available here.</a>
</div>
<h1 id="cinder-integration">Cinder Integration</h1>

<h2 id="summary">Summary</h2>

<p>OpenStack Cinder(/ceph) Integration</p>

<h2 id="owner">Owner</h2>

<ul>
  <li>Daniel Erez (DanielErez) (<a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#100;&#101;&#114;&#101;&#122;&#064;&#114;&#101;&#100;&#104;&#097;&#116;&#046;&#099;&#111;&#109;">&#100;&#101;&#114;&#101;&#122;&#064;&#114;&#101;&#100;&#104;&#097;&#116;&#046;&#099;&#111;&#109;</a>)</li>
  <li>Maor Lipchuk (MaorLipchuk) (<a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#109;&#108;&#105;&#112;&#099;&#104;&#117;&#107;&#064;&#114;&#101;&#100;&#104;&#097;&#116;&#046;&#099;&#111;&#109;">&#109;&#108;&#105;&#112;&#099;&#104;&#117;&#107;&#064;&#114;&#101;&#100;&#104;&#097;&#116;&#046;&#099;&#111;&#109;</a>)</li>
  <li>Nir Soffer (NirSoffer) (<a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#110;&#115;&#111;&#102;&#102;&#101;&#114;&#064;&#114;&#101;&#100;&#104;&#097;&#116;&#046;&#099;&#111;&#109;">&#110;&#115;&#111;&#102;&#102;&#101;&#114;&#064;&#114;&#101;&#100;&#104;&#097;&#116;&#046;&#099;&#111;&#109;</a>)</li>
  <li>Federico Simoncelli (FedericoSimoncelli) (<a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#102;&#115;&#105;&#109;&#111;&#110;&#099;&#101;&#064;&#114;&#101;&#100;&#104;&#097;&#116;&#046;&#099;&#111;&#109;">&#102;&#115;&#105;&#109;&#111;&#110;&#099;&#101;&#064;&#114;&#101;&#100;&#104;&#097;&#116;&#046;&#099;&#111;&#109;</a>)</li>
</ul>

<h2 id="detailed-description">Detailed Description</h2>

<p>Managing OpenStack Cinder volumes provisioned by ceph storage through oVirt engine. For initial phase, the integration should ensure support for creating/deleting volumes from a Cinder storage domain, while monitoring relevant statuses using <a href="CommandCoordinator">CoCo</a> mechanism. The engine/vdsm should allow running VMs with attached ceph volumes via librbd library using libvirt support (<a href="http://ceph.com/docs/master/rbd/libvirt/">using libvirt with ceph rbd</a>). As for security, when required, running VMs can authenticate using <a href="http://ceph.com/docs/v0.69/rados/operations/auth-intro/">CEPHX</a> protocol (secret management will be handled in engine/vdsm).
There is a known issue with OpenStack when deleting a snapshot which has dependent volumes based on it. to avoid this bug the OpenStack Cinder should configure the ceph backend with this attribute rbd_flatten_volume_from_snapshot as True.</p>

<h2 id="dependencies--related-features">Dependencies / Related Features</h2>

<ul>
  <li><a href="https://github.com/woorea/openstack-java-sdk woorea">https://github.com/woorea/openstack-java-sdk woorea</a> openstack-java-sdk should be updated and expanded to include cinder-model/cinder-client modules (needed for having an interface to interact with cinder rest-api commands.</li>
</ul>

<h2 id="documentation--external-references">Documentation / External references</h2>

<ul>
  <li>Ceph documentation: <a href="http://ceph.com/docs/master/">http://ceph.com/docs/master/</a></li>
  <li>Ceph for Cinder: <a href="http://techs.enovance.com/6572/brace-yourself-devstack-ceph-is-here">http://techs.enovance.com/6572/brace-yourself-devstack-ceph-is-here</a></li>
  <li>Libvirt with Ceph: <a href="http://ceph.com/docs/master/rbd/libvirt/">http://ceph.com/docs/master/rbd/libvirt/</a></li>
  <li>Cinder REST API: <a href="http://developer.openstack.org/api-ref-blockstorage-v2.html">http://developer.openstack.org/api-ref-blockstorage-v2.html</a></li>
  <li>OpenStack Java SDK: <a href="https://github.com/woorea/openstack-java-sdk">https://github.com/woorea/openstack-java-sdk</a></li>
  <li>Introducing Ceph to OpenStack: <a href="http://www.sebastien-han.fr/blog/2012/06/10/introducing-ceph-to-openstack/">http://www.sebastien-han.fr/blog/2012/06/10/introducing-ceph-to-openstack/</a></li>
  <li>Configure OpenStack Ceph Client: <a href="http://ceph.com/docs/master/rbd/rbd-openstack/#configure-openstack-ceph-clients">http://ceph.com/docs/master/rbd/rbd-openstack/#configure-openstack-ceph-clients</a></li>
</ul>

<h2 id="phases">Phases</h2>

<ul>
  <li>CRUD for OpenStack Volume (Cinder) provider.</li>
  <li>CRUD for adding/deleting Cinder disks (including monitoring).</li>
  <li>CRUD for snapshots with Cinder disks.</li>
  <li>Fetching Volume Types - ceph/lvm/etc.</li>
  <li>Running VMs with Cinder disks attached.</li>
  <li>CEPHX integration for using volumes securely.</li>
  <li>Import (from Cinder to engine DB).</li>
  <li>Permissions (MLA).</li>
  <li>Templates
    <ul>
      <li>Add template - clone volume/create volume from snapshot - use <a href="http://blueprints.launchpad.net/cinder/+spec/add-cloning-support-to-cinder">clone volume</a> and <a href="https://blueprints.launchpad.net/cinder/+spec/add-flat-volume-api">flat volume</a> (if available).</li>
      <li>Add VM from template - create volume from source volume (thin).</li>
    </ul>
  </li>
</ul>

<h2 id="future-work">Future Work?</h2>

<ul>
  <li>Move VM disk/Copy Template disk (cinder-to-cinder?/cinder-to-vdsm?/vdsm-to-cinder?).</li>
  <li>Retype volume <a href="https://blueprints.launchpad.net/cinder/+spec/volume-retype">volume-retype</a> (not supported for rbd yet).</li>
  <li>Upload to Image (glance).</li>
  <li>CRUD for volume types.</li>
  <li>Quota (Cinder/Engine).</li>
  <li>Import/Export (VMs/Templates).</li>
  <li>Disk profiles.</li>
  <li>Live snapshots.</li>
  <li>Live storage migration.</li>
  <li>Sync Cinder data with engine DB.</li>
  <li>Cinder storage domain monitoring.</li>
  <li>Support multiple backends (lvm/etc).</li>
  <li>OVF disk / disaster recovery support</li>
</ul>

<h2 id="relevant-flows">Relevant Flows</h2>

<ul>
  <li>Add/Remove/Edit OpenStack volume provider</li>
  <li>Add/Remove/Update/Extend Cinder Disk</li>
  <li>Attach/Detach Storage Domain</li>
  <li>Activate/Deactivate Storage Domain</li>
  <li>Remove VM</li>
  <li>Add Template</li>
  <li>Remove Template</li>
  <li>Add VM from Template</li>
  <li>Add VM Pool</li>
  <li>Attach Cinder Disks</li>
  <li>Plug/Unplug (Cold/Hot)</li>
  <li>List Cinder Disks</li>
  <li>Register Cinder Disks</li>
  <li>Run VM - [multiple ceph monitors support / Cephx auth (secrets)]</li>
  <li>Add/Remove Snapshot</li>
  <li>Preview/Undo/Commit Snapshot</li>
  <li>Custom Preview Snapshot</li>
  <li>Clone VM from Snapshot</li>
  <li>Clone VM</li>
  <li>Remove Disk Snapshots</li>
</ul>

<h2 id="open-issues">Open Issues</h2>

<ul>
  <li>Verify limits/quota against Cinder on Disk creation.</li>
  <li>VM removal - deleted disks remain in 'locked' status (as opposed to images which are deleted immediately). I.e. failure would caused to disks in status 'illegal'.</li>
  <li>There is a known issue with OpenStack when deleting a snapshot which has dependent volumes based on it. to avoid this bug the OpenStack Cinder should configure the ceph backend with this attribute rbd_flatten_volume_from_snapshot as True.</li>
</ul>

<h2 id="patches">Patches</h2>

<p><a href="http://gerrit.ovirt.org/#/q/status:open+project:ovirt-engine+branch:master+topic:cinder,n,z">Topic Branch: Cinder</a></p>

<h2 id="implementation">Implementation</h2>

<h3 id="flow-illustration">Flow Illustration</h3>

<p><img alt="" width="1632" height="432" src="/images/wiki/Cinder_flow_illustration.png?1560777613" /></p>

<h3 id="engine">Engine</h3>

<h3 id="rest-api">REST-API</h3>

<h4 id="add-provider-post-apiopenstackvolumeproviders">Add Provider: <code>POST /api/openstackvolumeproviders</code></h4>

<div class="highlight"><pre class="highlight xml"><code><span class="nt">&lt;openstack_volume_provider&gt;</span>&#x000A;    <span class="nt">&lt;name&gt;&lt;/name&gt;</span>&#x000A;    <span class="nt">&lt;url&gt;</span>[fqdn]:8776<span class="nt">&lt;/url&gt;</span>&#x000A;    <span class="nt">&lt;data_center&gt;</span>&#x000A;        <span class="nt">&lt;name&gt;&lt;/name&gt;</span>&#x000A;    <span class="nt">&lt;/data_center&gt;</span>&#x000A;    <span class="nt">&lt;requires_authentication&gt;</span>true|false<span class="nt">&lt;/requires_authentication&gt;</span>&#x000A;    <span class="nt">&lt;username&gt;&lt;/username&gt;</span>&#x000A;    <span class="nt">&lt;password&gt;&lt;/password&gt;</span>&#x000A;    <span class="nt">&lt;tenant_name&gt;&lt;/tenant_name&gt;</span>&#x000A;<span class="nt">&lt;/openstack_volume_provider&gt;</span>&#x000A;</code></pre></div>
<h4 id="get-volume-provider-get-apiopenstackvolumeprovidersprovider_id-all-content-true">Get Volume Provider: <code>GET /api/openstackvolumeproviders/{provider_id} (All-Content: true)</code></h4>

<div class="highlight"><pre class="highlight xml"><code><span class="nt">&lt;openstack_volume_providers&gt;</span>&#x000A;    <span class="nt">&lt;openstack_volume_provider</span> <span class="na">href=</span><span class="s">"/api/openstackvolumeproviders/{id}"</span> <span class="na">id=</span><span class="s">"{id}"</span><span class="nt">&gt;</span>&#x000A;        <span class="nt">&lt;name&gt;</span>cinder2<span class="nt">&lt;/name&gt;</span>&#x000A;        <span class="nt">&lt;requires_authentication&gt;</span>true<span class="nt">&lt;/requires_authentication&gt;</span>&#x000A;        <span class="nt">&lt;username&gt;</span>cinder<span class="nt">&lt;/username&gt;</span>&#x000A;        <span class="nt">&lt;data_center</span> <span class="na">href=</span><span class="s">"/api/datacenters/{id}"</span> <span class="na">id=</span><span class="s">"{id}"</span><span class="nt">&gt;</span>&#x000A;            ...&#x000A;        <span class="nt">&lt;/data_center&gt;</span>&#x000A;    <span class="nt">&lt;/openstack_volume_provider&gt;</span>&#x000A;<span class="nt">&lt;/openstack_volume_providers&gt;</span>&#x000A;</code></pre></div>
<h4 id="get-volume-type-get-apiopenstackvolumeprovidersprovider_idvolumetypes">Get Volume Type: <code>GET /api/openstackvolumeproviders/{provider_id}/volumetypes</code></h4>

<div class="highlight"><pre class="highlight xml"><code><span class="nt">&lt;openstack_volume_types&gt;</span>&#x000A;    <span class="nt">&lt;openstack_volume_type</span> <span class="na">href=</span><span class="s">"/api/openstackvolumeproviders/{id}/volumetypes/{volume_type_id}"</span> <span class="na">id=</span><span class="s">"{id}"</span><span class="nt">&gt;</span>&#x000A;        <span class="nt">&lt;name&gt;</span>ceph<span class="nt">&lt;/name&gt;</span>&#x000A;        <span class="nt">&lt;properties&gt;</span>&#x000A;            <span class="nt">&lt;property&gt;</span>&#x000A;            <span class="nt">&lt;name&gt;</span>volume_backend_name<span class="nt">&lt;/name&gt;</span>&#x000A;            <span class="nt">&lt;value&gt;</span>ceph<span class="nt">&lt;/value&gt;</span>&#x000A;            <span class="nt">&lt;/property&gt;</span>&#x000A;        <span class="nt">&lt;/properties&gt;</span>&#x000A;        <span class="nt">&lt;openstack_volume_provider</span> <span class="na">href=</span><span class="s">"/api/openstackvolumeproviders/{provider_id}"</span> <span class="na">id=</span><span class="s">"{id}"</span><span class="nt">/&gt;</span>&#x000A;    <span class="nt">&lt;/openstack_volume_type&gt;</span>&#x000A;<span class="nt">&lt;/openstack_volume_types&gt;</span>&#x000A;</code></pre></div>
<h4 id="get-authentication-keys-get-apiopenstackvolumeprovidersprovider_idauthenticationkeys">Get Authentication Keys: <code>GET /api/openstackvolumeproviders/{provider_id}/authenticationkeys</code></h4>

<div class="highlight"><pre class="highlight xml"><code><span class="nt">&lt;openstack_volume_authentication_keys&gt;</span>&#x000A;    <span class="nt">&lt;openstack_volume_authentication_key&gt;</span>&#x000A;    <span class="nt">&lt;description&gt;</span>my ceph secret<span class="nt">&lt;/description&gt;</span>&#x000A;    <span class="nt">&lt;uuid&gt;</span>c50352a3-0700-48e9-9189-ed359c09bcf8<span class="nt">&lt;/uuid&gt;</span>&#x000A;    <span class="nt">&lt;usage_type&gt;</span>ceph<span class="nt">&lt;/usage_type&gt;</span>&#x000A;    <span class="nt">&lt;creation_date&gt;</span>2015-05-31T15:28:25.525+03:00<span class="nt">&lt;/creation_date&gt;</span>&#x000A;   <span class="nt">&lt;/openstack_volume_authentication_key&gt;</span>&#x000A;<span class="nt">&lt;/openstack_volume_authentication_keys&gt;</span>&#x000A;</code></pre></div>
<h4 id="create-an-authentication-key-post-apiopenstackvolumeprovidersprovider_idauthenticationkeys">Create an Authentication Key: <code>POST /api/openstackvolumeproviders/{provider_id}/authenticationkeys</code></h4>

<div class="highlight"><pre class="highlight xml"><code><span class="nt">&lt;openstack_volume_authentication_key&gt;</span>&#x000A;    <span class="nt">&lt;uuid&gt;</span>0e6fff8d-8af9-49e2-b04f-1a5dbbe883a2<span class="nt">&lt;/uuid&gt;</span>&#x000A;    <span class="nt">&lt;description&gt;</span>my ceph secret<span class="nt">&lt;/description&gt;</span>&#x000A;    <span class="nt">&lt;usage_type&gt;</span>ceph<span class="nt">&lt;/usage_type&gt;</span>&#x000A;    <span class="nt">&lt;value&gt;</span>YQo=<span class="nt">&lt;/value&gt;</span>&#x000A;<span class="nt">&lt;/openstack_volume_authentication_key&gt;</span>&#x000A;</code></pre></div>
<h4 id="create-a-cinder-disk-on-a-specific-volume-type-post-apivmsvm_iddisks">Create a Cinder disk on a specific Volume Type: <code>POST /api/vms/{vm_id}/disks</code></h4>

<div class="highlight"><pre class="highlight xml"><code><span class="nt">&lt;disk&gt;</span>&#x000A;    <span class="nt">&lt;openstack_volume_type&gt;</span>&#x000A;        <span class="nt">&lt;name&gt;</span>my_ceph<span class="nt">&lt;/name&gt;</span>&#x000A;    <span class="nt">&lt;/openstack_volume_type&gt;</span>&#x000A;    <span class="nt">&lt;storage_domains&gt;</span>&#x000A;        <span class="nt">&lt;storage_domain&gt;</span>&#x000A;            <span class="nt">&lt;name&gt;</span>cinder<span class="nt">&lt;/name&gt;</span>&#x000A;        <span class="nt">&lt;/storage_domain&gt;</span>&#x000A;    <span class="nt">&lt;/storage_domains&gt;</span> &#x000A;    <span class="nt">&lt;provisioned_size&gt;</span>1073741824<span class="nt">&lt;/provisioned_size&gt;</span>&#x000A;    <span class="nt">&lt;interface&gt;</span>virtio<span class="nt">&lt;/interface&gt;</span>&#x000A;    <span class="nt">&lt;format&gt;</span>raw<span class="nt">&lt;/format&gt;</span>&#x000A;<span class="nt">&lt;/disk&gt;</span>&#x000A;</code></pre></div>
<h4 id="get-unregistered-disks-get-apistoragedomainsstorage_domain_iddisksunregistered">Get Unregistered Disks: <code>GET /api/storagedomains/{storage_domain_id}/disks;unregistered</code></h4>

<div class="highlight"><pre class="highlight xml"><code><span class="nt">&lt;disks&gt;</span>&#x000A;      ...&#x000A;<span class="nt">&lt;/disks&gt;</span>&#x000A;</code></pre></div>
<h4 id="register-disk-post-apistoragedomainsstorage_domain_iddisksunregistered">Register Disk: <code>POST /api/storagedomains/{storage_domain_id}/disks;unregistered</code></h4>

<div class="highlight"><pre class="highlight xml"><code><span class="nt">&lt;disk</span> <span class="na">id=</span><span class="s">"{disk_id}"</span><span class="nt">&gt;&lt;/disk&gt;</span>&#x000A;</code></pre></div>
<h4 id="delete-entity-diskvmtemplate">Delete Entity (DIsk/VM/Template)</h4>

<p>Cinder disks are deleted asynchronously, hence ';async' flag could be passed as part of the URL for getting 202-Accepted return status.</p>

<p>E.g. 
    <code>DELETE /api/disks/{disk_id};async</code></p>

<div class="highlight"><pre class="highlight xml"><code><span class="nt">&lt;action&gt;&lt;/action&gt;</span>&#x000A;</code></pre></div>
<h3 id="vdsm">VDSM</h3>

<ul>
  <li>Add <a href="https://apps.fedoraproject.org/packages/librbd1">librbd1 package</a> as dependency to vdsm.spec file.</li>
  <li>Refactor <code>Drive -&gt; getXML()</code> to support multiple hosts (represents Ceph monitors) in disk's source element:</li>
</ul>

<div class="highlight"><pre class="highlight xml"><code><span class="nt">&lt;disk</span> <span class="na">type=</span><span class="s">"network"</span> <span class="na">device=</span><span class="s">"disk"</span><span class="nt">&gt;</span>&#x000A;    <span class="nt">&lt;host</span> <span class="na">name=</span><span class="s">"{monitor-host}"</span> <span class="na">port=</span><span class="s">"6789"</span><span class="nt">/&gt;</span>&#x000A;                     ...&#x000A;&#x000A;    <span class="nt">&lt;/source&gt;</span>&#x000A;    <span class="nt">&lt;target</span> <span class="na">dev=</span><span class="s">"vda"</span> <span class="na">bus=</span><span class="s">"virtio"</span><span class="nt">/&gt;</span>&#x000A;<span class="nt">&lt;/disk&gt;</span>&#x000A;</code></pre></div>
<ul>
  <li>[TBD] <a href="http://ceph.com/docs/v0.69/rados/operations/auth-intro/">CEPHX</a> secret handling - <a href="http://ceph.com/docs/master/rbd/libvirt/#configuring-the-vm">Libvirt with CEPH (Configuring the VM section)</a>.</li>
</ul>

<h3 id="ui">UI</h3>

<h4 id="openstack-volume-providers">OpenStack Volume Providers</h4>

<p><img alt="" width="1028" height="768" src="/images/wiki/Cinder_providers.png?1560777613" /></p>

<h4 id="openstack-volume-provider-dialog">OpenStack Volume Provider Dialog</h4>

<p><img alt="" width="1013" height="719" src="/images/wiki/Cinder_new_provider.png?1560777613" /></p>

<h4 id="cinder-storage-domains">Cinder Storage Domains</h4>

<p><img alt="" width="1028" height="768" src="/images/wiki/Cinder_domains.png?1560777613" /></p>

<h4 id="cinder-disk-dialog">Cinder Disk Dialog</h4>

<p><img alt="" width="1013" height="716" src="/images/wiki/Cinder_new_disk.png?1560777613" /></p>

<h4 id="cinder-disks-attached-to-a-vm">Cinder Disks attached to a VM</h4>

<p><img alt="" width="1015" height="747" src="/images/wiki/Cinder_vms_disks.png?1560777613" /></p>

<h4 id="cinder-disks-list-under-storage">Cinder Disks List (under Storage)</h4>

<p><img alt="" width="1015" height="747" src="/images/wiki/Cinder_storage_disks.png?1560777613" /></p>

<h4 id="register-cinder-disks-under-storage">Register Cinder Disks (under Storage)</h4>

<p><img alt="" width="1014" height="716" src="/images/wiki/Cinder_storage_register_disks.png?1560777613" /></p>

<h4 id="cinder-disks-list">Cinder Disks List</h4>

<p><img alt="" width="1024" height="769" src="/images/wiki/Cinder_disks_storage.png?1560777613" /></p>

<h4 id="cinder-authentication-keys">Cinder Authentication Keys</h4>

<p><img alt="" width="1013" height="718" src="/images/wiki/Cinder_auth_keys.png?1560777613" /></p>

<h4 id="authentication-key-dialog">Authentication Key Dialog</h4>

<p><img alt="" width="1013" height="713" src="/images/wiki/Cinder_new_auth_key.png?1560777613" /></p>

<h2 id="authentication-keys">Authentication Keys</h2>

<p>When client Ceph authentication <a href="http://docs.ceph.com/docs/v0.69/rados/operations/auth-intro/#ceph-authentication-cephx">(Cephx)</a> is enabled, authentication keys should be configured as follows:</p>

<ul>
  <li>(1) Create a new secret key on ceph using 'ceph auth get-or-create' - see example in <a href="http://docs.ceph.com/docs/master/rbd/libvirt/#configuring-the-vm">Configuring client for Nova/Cinder</a>
    <ul>
      <li>
        <table>
          <tbody>
            <tr>
              <td>E.g.1. ceph auth get-or-create client.cinder</td>
              <td>ssh {your-nova-compute-server} sudo tee /etc/ceph/ceph.client.cinder.keyring</td>
            </tr>
          </tbody>
        </table>
      </li>
      <li>
        <table>
          <tbody>
            <tr>
              <td>E.g.2. ceph auth get-or-create client.vdsm</td>
              <td>tee 'my_pass'</td>
            </tr>
          </tbody>
        </table>
      </li>
    </ul>
  </li>
  <li>(2) Navigate to 'Authentication Keys' sub-tab (under 'Providers' main-tab): <img alt="Authentication Keys" width="1209" height="630" src="/images/wiki/Cinder_Authentication_Keys.png?1560777613" /></li>
  <li>(3) Click 'New' to open the create dialog: <img alt="Screenshot" width="447" height="245" src="/images/wiki/Authentication_Key_Dialog.png?1560777613" /></li>
  <li>(4) In 'Value' text-box, enter the value of the secret key created on step (1).
    <ul>
      <li>Can be retrieved by 'ceph auth get client.cinder'</li>
    </ul>
  </li>
  <li>
    <p>(5) From 'UUID' text-box, copy the automatically generated UUID (or create a new one), and add to cinder.conf.</p>

    <p>   E.g. '/etc/cinder/cinder.conf':
     rbd_secret_uuid = 148eb4bc-c47c-4ffe-b14e-3a0fb6c76833
     rbd_user = cinder</p>
  </li>
</ul>

<p>Note: client authentication keys are only used upon running a VM; i.e. authentication for ceph volume manipulation should be configured solely on Cinder side.</p>


</section>
</section>
</section>
<footer class='text-center' id='footer'>
<hr class='visible-print'>
<ul class='footer-nav-list'>
<li><a target="_blank" href="../../../../site/privacy-policy.html">Privacy policy</a></li>
<li><a target="_blank" href="../../../../community/about.html">About</a></li>
<li><a target="_blank" href="../../../../site/general-disclaimer.html">Disclaimers</a></li>
</ul>

&copy; 2013&ndash;2019 oVirt
<div class='edit-this-page'>
<a target="_blank" href="https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/source/develop/release-management/features/storage/cinder-integration.html.md&amp;template="><i class="icon fa fa-github"></i>Report an issue with this page</a>
</div>
<div class='edit-this-page'>
<a target="_blank" href="https://github.com/oVirt/ovirt-site/edit/master/source/develop/release-management/features/storage/cinder-integration.html.md"><i class="icon fa fa-github"></i>Edit this page</a>
</div>
<div class='last-modified'>
Page last modified
Wed 12 Jul 2017 17:57 UTC
</div>
        <script type="text/javascript">
        var _paq = _paq || [];
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
        var u=(("https:" == document.location.protocol) ? "https" : "http") + "://stats.phx.ovirt.org/";
        _paq.push(['setTrackerUrl', u+'piwik.php']);
        _paq.push(['setSiteId', 1]);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0]; g.type='text/javascript';
        g.defer=true; g.async=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
        })();
        </script>
<noscript><p><img src="https://stats.phx.ovirt.org/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
</footer>


<script src="/javascripts/application.js?1560777657" type="text/javascript"></script>

</body>
</html>
