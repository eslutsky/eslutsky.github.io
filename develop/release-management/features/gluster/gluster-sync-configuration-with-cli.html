<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie10 lt-ie9 lt-ie8 lt-ie7" lang="en-us"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie10 lt-ie9 lt-ie8" lang="en-us"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie10 lt-ie9" lang="en-us"> <![endif]-->
<!--[if IE 9]> <html class="no-js lt-ie10 lt-ie9" lang="en-us"> <![endif]-->
<!--[if lt IE 10]> <html class="no-js lt-ie10" lang="en-us"> <![endif]-->
<!--[if !IE]> > <![endif]-->
<html class='no-js' lang='en'>
<!-- <![endif] -->
<head>
<title>
Gluster Sync Configuration With CLI &mdash;
oVirt
</title>
<meta charset='utf-8'>
<meta content='' name='description'>
<meta content='' name='author'>
<meta content='initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width' name='viewport'>

<link href='/images/favicon.ico' rel='shortcut icon'>
<link href='/images/apple-touch-icon-precomposed.png' rel='apple-touch-icon-precomposed'>
<link href='/images/apple-touch-icon-57x57-precomposed.png' rel='apple-touch-icon-precomposed' sizes='57x57'>
<link href='/images/apple-touch-icon-72x72-precomposed.png' rel='apple-touch-icon-precomposed' sizes='72x72'>
<link href='/images/apple-touch-icon-114x114-precomposed.png' rel='apple-touch-icon-precomposed' sizes='114x114'>
<link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet'>
<link href="/stylesheets/application.css?1560777611" rel="stylesheet" type="text/css" />
<link href="/stylesheets/print.css?1560777612" rel="stylesheet" type="text/css" media="print" />
</head>
<body class=' source-md'>
<header class='masthead hidden-print' id='branding' role='banner'>
<section class='hgroup'></section>
<div id='access'>
<nav id="mainNav" class="navbar-fixed-top affix-top navForMobileHack" style="font-family: 'Open Sans', sans-serif; display: flex; justify-content: center;">
      <a href="/"><img id="logo" style="float: left; margin-right: 70px; height: 40px; padding: 0; margin-top: 12px;" alt="oVirt" src="/images/logo.svg"></a>
      <div>
          <div class="navbar-header page-scroll" style="min-width: 170px">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#menu_id0980fddf">
                  <span class="sr-only">Toggle navigation</span> Menu <i class="fa fa-bars"></i>
              </button>
          </div>

          <!-- Collect the nav links, forms, and other content for toggling -->
          <div class="collapse navbar-collapse" id="menu_id0980fddf">

              <ul class="nav navbar-nav">
                  <li class="hidden active">
                      <a href="#page-top"></a>
                  </li>
<li role='menuitem'>
  <a href='/'>Home</a>
</li>

<li role='menuitem'>
  <a href='/download/'>Download</a>
</li>

<li role='menuitem'>
  <a href='/documentation/'>Documentation</a>
</li>

<li role='menuitem'>
  <a href='/develop/'>Developers</a>
</li>

<li role='menuitem'>
  <a href='/community/'>Community</a>
</li>

<li role='menuitem'>
  <a href='//lists.ovirt.org/archives/'>Forum</a>
</li>

<li role='menuitem'>
  <a href='/blog/'>Blog</a>
</li>

              </ul>
          </div>
          <!-- /.navbar-collapse -->
      </div>
      <!-- /.container-fluid -->
  </nav>

</div>
</header>

<section class='page-wrap' id='page-wrap'>
<section class='page' id='page'>
<ul class='breadcrumb'>
<li><a href="/develop/">Develop</a></li>
<li><a href="/develop/release-management/">Release-management</a></li>
<li><a href="/develop/release-management/features/">Features</a></li>
<li><a href="/develop/release-management/features/gluster/">Gluster</a></li>
</ul>

<section class='container content' id='content'>
<div class='alert alert-warning'>
Feature pages are design documents that developers have created while collaborating on oVirt.
<br>
<br>
Most of them are
<strong>
outdated
</strong>
, but provide historical design context.
<br>
<br>
They are
<strong>
not
</strong>
user documentation and should not be treated as such.
<br>
<br>
<a href='/documentation/'>Documentation is available here.</a>
</div>
<h1 id="gluster-sync-configuration-with-cli">Gluster Sync Configuration With CLI</h1>

<h2 id="summary">Summary</h2>

<p>Providing support for automatically sync the changes made through Gluster CLI in oVirt.</p>

<h2 id="owner">Owner</h2>

<ul>
  <li>Feature owner: Shireesh Anjal <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#115;&#097;&#110;&#106;&#097;&#108;&#064;&#114;&#101;&#100;&#104;&#097;&#116;&#046;&#099;&#111;&#109;">&#115;&#097;&#110;&#106;&#097;&#108;&#064;&#114;&#101;&#100;&#104;&#097;&#116;&#046;&#099;&#111;&#109;</a>
    <ul>
      <li>GUI Component owner: Kanagaraj Mayilsamy <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#107;&#109;&#097;&#121;&#105;&#108;&#115;&#097;&#064;&#114;&#101;&#100;&#104;&#097;&#116;&#046;&#099;&#111;&#109;">&#107;&#109;&#097;&#121;&#105;&#108;&#115;&#097;&#064;&#114;&#101;&#100;&#104;&#097;&#116;&#046;&#099;&#111;&#109;</a></li>
      <li>Engine Component owner: Shireesh Anjal <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#115;&#097;&#110;&#106;&#097;&#108;&#064;&#114;&#101;&#100;&#104;&#097;&#116;&#046;&#099;&#111;&#109;">&#115;&#097;&#110;&#106;&#097;&#108;&#064;&#114;&#101;&#100;&#104;&#097;&#116;&#046;&#099;&#111;&#109;</a></li>
      <li>QA Owner: Sudhir Dharanendraiah <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#115;&#100;&#104;&#097;&#114;&#097;&#110;&#101;&#064;&#114;&#101;&#100;&#104;&#097;&#116;&#046;&#099;&#111;&#109;">&#115;&#100;&#104;&#097;&#114;&#097;&#110;&#101;&#064;&#114;&#101;&#100;&#104;&#097;&#116;&#046;&#099;&#111;&#109;</a></li>
    </ul>
  </li>
</ul>

<h2 id="current-status">Current Status</h2>

<ul>
  <li>Status: Completed</li>
  <li>Last updated date: Tue Jan 29 2013</li>
</ul>

<h2 id="detailed-description">Detailed Description</h2>

<h3 id="automatic">Automatic</h3>

<p>Introduce background job(s) in oVirt engine that will periodically fetch latest cluster configuration from GlusterFS and sync the same with the engine DB. Following changes done from gluster CLI should get reflected in the GUI:</p>

<ul>
  <li>volume created</li>
  <li>volume deleted</li>
  <li>volume started/stopped</li>
  <li>brick(s) added</li>
  <li>brick(s) removed</li>
  <li>brick(s) replaced</li>
  <li>new option set</li>
  <li>value of existing option changed</li>
  <li>option reset</li>
  <li>Server removed (peer detach)</li>
  <li>brick process went down / came up</li>
</ul>

<h4 id="key-considerations">Key considerations</h4>

<ul>
  <li>The background job(s) that perform(s) the syncing should be scheduled only if the Application is running in a mode that supports Gluster (vdc option ApplicationMode)</li>
  <li>Most of the data, except brick status is fetched using 'gluster volume info' command, which doesn't add much overhead on the gluster processes, and hence can be executed more frequently. Brick status however, is fetched using 'gluster volume status' which adds a significant</li>
</ul>

<p>overhead, and hence must be executed less frequently. For this reason, there should be two separate jobs executed at two different frequencies, for fetching the 'lightweight' and 'heavyweight' data respectively.</p>

<ul>
  <li>The refresh rates for these two jobs should be configurable as VDC options, with names GlusterRefreshRateLight and GlusterRefreshRateHeavy, with default values of 5 seconds and 5 minutes respectively.</li>
  <li>Server removed from gluster CLI should be removed in engine DB only if it belongs to a 'gluster-only' cluster.</li>
  <li>Whenever a change is detected in the configuration and synced in the engine DB, an audit log should be generated with severity of "alert", containing details of the change.</li>
</ul>

<h3 id="through-notifications">Through Notifications</h3>

<p>Handling of servers added (peer probed) from gluster CLI needs to be done in a different way, as addition of any server in engine requires user's approval after verifying the SSH fingerprint. To achieve this, - Whenever a cluster is selected in the 'clusters' tab, asynchronously send a request to the server to identify if any servers have been added to it from gluster CLI - If yes, provide two links on the cluster general tab - one for adding the missing servers, another for selectively removing the unwanted ones.</p>

<h4 id="import">Import</h4>

<ul>
  <li>When User clicks on 'import' link, display a screen containing all newly added servers, along with their SSH fingerprints</li>
  <li>User should be able to edit the server names (not hostname/ip) and provide root password for all these servers</li>
  <li>After user accepts the servers, providing root passwords for all of them, add all of them to the cluster</li>
</ul>

<h4 id="detach">Detach</h4>

<ul>
  <li>When user clicks on the 'detach' link, display a screen containing all the additional servers</li>
  <li>User should be able to select one or more of these servers, and click on the 'Ok' button</li>
  <li>This should trigger a 'gluster peer detach' command to remove the selected servers from the gluster cluster</li>
</ul>

<h2 id="design">Design</h2>

<h3 id="glustermanager">GlusterManager</h3>

<p>This class will have methods that run periodically to sync information with GlusterFS.</p>

<p>refreshLightWeightData() : Runs more frequently and syncs information that can be fetched without much of an overhead on GlusterFS. This refresh rate is controlled by configuration "GlusterRefreshRateLight" , with default value of 5 seconds</p>

<p>getGlusterRefreshRateHeavy(): Runs less frequently and syncs information that adds a significant overhead on GlusterFS. This refresh rate is controlled by configuration "GlusterRefreshRateHeavy" , with default value of 5 minutes</p>

<h3 id="import-1">Import</h3>

<p><img alt="" width="1400" height="837" src="/images/wiki/Gluster-Sync-import.png?1560777613" /></p>

<h3 id="detach-1">Detach</h3>

<p><img alt="" width="1402" height="837" src="/images/wiki/Gluster-Sync-detach.png?1560777613" /></p>


</section>
</section>
</section>
<footer class='text-center' id='footer'>
<hr class='visible-print'>
<ul class='footer-nav-list'>
<li><a target="_blank" href="../../../../site/privacy-policy.html">Privacy policy</a></li>
<li><a target="_blank" href="../../../../community/about.html">About</a></li>
<li><a target="_blank" href="../../../../site/general-disclaimer.html">Disclaimers</a></li>
</ul>

&copy; 2013&ndash;2019 oVirt
<div class='edit-this-page'>
<a target="_blank" href="https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/source/develop/release-management/features/gluster/gluster-sync-configuration-with-cli.html.md&amp;template="><i class="icon fa fa-github"></i>Report an issue with this page</a>
</div>
<div class='edit-this-page'>
<a target="_blank" href="https://github.com/oVirt/ovirt-site/edit/master/source/develop/release-management/features/gluster/gluster-sync-configuration-with-cli.html.md"><i class="icon fa fa-github"></i>Edit this page</a>
</div>
<div class='last-modified'>
Page last modified
Wed 12 Jul 2017 17:57 UTC
</div>
        <script type="text/javascript">
        var _paq = _paq || [];
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
        var u=(("https:" == document.location.protocol) ? "https" : "http") + "://stats.phx.ovirt.org/";
        _paq.push(['setTrackerUrl', u+'piwik.php']);
        _paq.push(['setSiteId', 1]);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0]; g.type='text/javascript';
        g.defer=true; g.async=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
        })();
        </script>
<noscript><p><img src="https://stats.phx.ovirt.org/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
</footer>


<script src="/javascripts/application.js?1560777657" type="text/javascript"></script>

</body>
</html>
