<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie10 lt-ie9 lt-ie8 lt-ie7" lang="en-us"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie10 lt-ie9 lt-ie8" lang="en-us"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie10 lt-ie9" lang="en-us"> <![endif]-->
<!--[if IE 9]> <html class="no-js lt-ie10 lt-ie9" lang="en-us"> <![endif]-->
<!--[if lt IE 10]> <html class="no-js lt-ie10" lang="en-us"> <![endif]-->
<!--[if !IE]> > <![endif]-->
<html class='no-js' lang='en'>
<!-- <![endif] -->
<head>
<title>
Separate-DWH-Host &mdash;
oVirt
</title>
<meta charset='utf-8'>
<meta content='' name='description'>
<meta content='' name='author'>
<meta content='initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width' name='viewport'>

<link href='/images/favicon.ico' rel='shortcut icon'>
<link href='/images/apple-touch-icon-precomposed.png' rel='apple-touch-icon-precomposed'>
<link href='/images/apple-touch-icon-57x57-precomposed.png' rel='apple-touch-icon-precomposed' sizes='57x57'>
<link href='/images/apple-touch-icon-72x72-precomposed.png' rel='apple-touch-icon-precomposed' sizes='72x72'>
<link href='/images/apple-touch-icon-114x114-precomposed.png' rel='apple-touch-icon-precomposed' sizes='114x114'>
<link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet'>
<link href="/stylesheets/application.css?1560777611" rel="stylesheet" type="text/css" />
<link href="/stylesheets/print.css?1560777612" rel="stylesheet" type="text/css" media="print" />
</head>
<body class=' source-md'>
<header class='masthead hidden-print' id='branding' role='banner'>
<section class='hgroup'></section>
<div id='access'>
<nav id="mainNav" class="navbar-fixed-top affix-top navForMobileHack" style="font-family: 'Open Sans', sans-serif; display: flex; justify-content: center;">
      <a href="/"><img id="logo" style="float: left; margin-right: 70px; height: 40px; padding: 0; margin-top: 12px;" alt="oVirt" src="/images/logo.svg"></a>
      <div>
          <div class="navbar-header page-scroll" style="min-width: 170px">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#menu_id0980fddf">
                  <span class="sr-only">Toggle navigation</span> Menu <i class="fa fa-bars"></i>
              </button>
          </div>

          <!-- Collect the nav links, forms, and other content for toggling -->
          <div class="collapse navbar-collapse" id="menu_id0980fddf">

              <ul class="nav navbar-nav">
                  <li class="hidden active">
                      <a href="#page-top"></a>
                  </li>
<li role='menuitem'>
  <a href='/'>Home</a>
</li>

<li role='menuitem'>
  <a href='/download/'>Download</a>
</li>

<li role='menuitem'>
  <a href='/documentation/'>Documentation</a>
</li>

<li role='menuitem'>
  <a href='/develop/'>Developers</a>
</li>

<li role='menuitem'>
  <a href='/community/'>Community</a>
</li>

<li role='menuitem'>
  <a href='//lists.ovirt.org/archives/'>Forum</a>
</li>

<li role='menuitem'>
  <a href='/blog/'>Blog</a>
</li>

              </ul>
          </div>
          <!-- /.navbar-collapse -->
      </div>
      <!-- /.container-fluid -->
  </nav>

</div>
</header>

<section class='page-wrap' id='page-wrap'>
<section class='page' id='page'>
<ul class='breadcrumb'>
<li><a href="/develop/">Develop</a></li>
<li><a href="/develop/release-management/">Release-management</a></li>
<li><a href="/develop/release-management/features/">Features</a></li>
<li><a href="/develop/release-management/features/integration/">Integration</a></li>
</ul>

<section class='container content' id='content'>
<div class='alert alert-warning'>
Feature pages are design documents that developers have created while collaborating on oVirt.
<br>
<br>
Most of them are
<strong>
outdated
</strong>
, but provide historical design context.
<br>
<br>
They are
<strong>
not
</strong>
user documentation and should not be treated as such.
<br>
<br>
<a href='/documentation/'>Documentation is available here.</a>
</div>
<h1 id="separate-dwh-host">Separate DWH Host</h1>

<h2 id="summary">Summary</h2>

<p>Allow ovirt-engine-dwh to be installed and configured by engine-setup on a separate machine, without requiring ovirt-engine to be on the same host.</p>

<h2 id="owner">Owner</h2>

<ul>
  <li>Name: Didi (Didi)</li>
</ul>

<!-- -->

<ul>
  <li>Email: <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#100;&#105;&#100;&#105;&#064;&#114;&#101;&#100;&#104;&#097;&#116;&#046;&#099;&#111;&#109;">&#100;&#105;&#100;&#105;&#064;&#114;&#101;&#100;&#104;&#097;&#116;&#046;&#099;&#111;&#109;</a></li>
</ul>

<h2 id="current-status">Current status</h2>

<p>Implemented, should be available in 3.5.</p>

<h2 id="detailed-description">Detailed Description</h2>

<p>We assume that engine is already setup and running on machine A. We assume that user wants to install dwh on machine B.</p>

<p>We need access to the engine's database. If on separate host, user will be prompted for them.</p>

<p>We need to also fix bug <a href="https://bugzilla.redhat.com/1059283">https://bugzilla.redhat.com/1059283</a> - check minimal ETL version, as we'll not be able to rely on package dependencies anymore.</p>

<h2 id="migrating-an-existing-dwh-and-reports-installation">Migrating an existing DWH and Reports installation</h2>

<p>For migration of an existing local installation of DWH and Report to a different server please refer to <a href="/develop/release-management/features/engine/migration-of-local-dwh-reports-to-remote/">Migration_of_local_DWH_Reports_to_remote</a>.</p>

<h2 id="benefit-to-ovirt">Benefit to oVirt</h2>

<p>DWH sometimes causes a significant load on the engine machine. Installing it on a separate machine will allow distributing the load.</p>

<h2 id="dependencies--related-features">Dependencies / Related Features</h2>

<h2 id="documentation--external-references">Documentation / External references</h2>

<p><a href="https://bugzilla.redhat.com/1080997">https://bugzilla.redhat.com/1080997</a></p>

<p>An annotated <a href="/develop/release-management/features/engine/separate-reports-host/#example-setup">example setup</a> on three machines is part of the related feature page <a href="/develop/release-management/features/engine/separate-reports-host/">Separate-Reports-Host</a>.</p>

<h2 id="testing">Testing</h2>

<p>Install and setup ovirt-engine on machine A, ovirt-engine-dwh on machine B, see that dwhd on B collects data from the engine on A.</p>

<p>On A:</p>

<div class="highlight"><pre class="highlight plaintext"><code>  yum install ovirt-engine-setup&#x000A;  engine-setup&#x000A;</code></pre></div>
<p>On B:</p>

<div class="highlight"><pre class="highlight plaintext"><code>  yum install ovirt-engine-dwh-setup&#x000A;  engine-setup&#x000A;</code></pre></div>
<h3 id="dwhd-is-currently-running">dwhd is currently running</h3>

<p>You might get en error from engine-setup 'dwhd is currently running'.</p>

<p>To fix this, you can try one of the following:</p>

<ul>
  <li>
    <p>Restart dwhd:</p>

    <p>service ovirt-engine-dwhd restart</p>
  </li>
</ul>

<p>and make sure that it stopped and started cleanly (without errors in the log)</p>

<ul>
  <li>Clear DwhCurrentlyRunning</li>
</ul>

<p>Make sure that dwhd is stopped, and then, in the engine's database,</p>

<div class="highlight"><pre class="highlight plaintext"><code>  UPDATE dwh_history_timekeeping SET var_value = 0 WHERE var_name = 'DwhCurrentlyRunning';&#x000A;</code></pre></div>
<p>Details:</p>

<p>When upgrading the engine, dwhd must be first stopped, then upgraded, then started. Otherwise it might try to collect inconsistent data, from a database in the middle of an upgrade, or from an upgraded database. In previous versions this was forced by engine-setup. Now that might be impossible, if they are on separate machines. To enforce that, a new flag was added to the database, marking that dwhd is up. It's set by dwhd on start, cleared on stop, and tested by engine-setup. Another flag was added to mark that dwhd should stop. If engine-setup sees that dwhd is up, it asks it to stop by marking that flag, then waits some time, and eventually times out and aborts if dwhd didn't mark that it is stopped. The most likely cause of this is an uncontrolled exit of dwhd, e.g. killing it with SIGKILL or unplugging the power of its host.</p>

<p><a href="/develop/release-management/features/">Separate DWH Host</a> <a href="/develop/release-management/releases/3.5/feature/">Separate DWH Host</a> <a href="category:Integration">Separate DWH Host</a></p>

</section>
</section>
</section>
<footer class='text-center' id='footer'>
<hr class='visible-print'>
<ul class='footer-nav-list'>
<li><a target="_blank" href="../../../../site/privacy-policy.html">Privacy policy</a></li>
<li><a target="_blank" href="../../../../community/about.html">About</a></li>
<li><a target="_blank" href="../../../../site/general-disclaimer.html">Disclaimers</a></li>
</ul>

&copy; 2013&ndash;2019 oVirt
<div class='edit-this-page'>
<a target="_blank" href="https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/source/develop/release-management/features/integration/separate-dwh-host.html.md&amp;template="><i class="icon fa fa-github"></i>Report an issue with this page</a>
</div>
<div class='edit-this-page'>
<a target="_blank" href="https://github.com/oVirt/ovirt-site/edit/master/source/develop/release-management/features/integration/separate-dwh-host.html.md"><i class="icon fa fa-github"></i>Edit this page</a>
</div>
<div class='last-modified'>
Page last modified
Sun 13 Aug 2017 15:05 UTC
</div>
        <script type="text/javascript">
        var _paq = _paq || [];
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
        var u=(("https:" == document.location.protocol) ? "https" : "http") + "://stats.phx.ovirt.org/";
        _paq.push(['setTrackerUrl', u+'piwik.php']);
        _paq.push(['setSiteId', 1]);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0]; g.type='text/javascript';
        g.defer=true; g.async=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
        })();
        </script>
<noscript><p><img src="https://stats.phx.ovirt.org/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
</footer>


<script src="/javascripts/application.js?1560777657" type="text/javascript"></script>

</body>
</html>
