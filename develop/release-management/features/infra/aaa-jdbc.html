<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie10 lt-ie9 lt-ie8 lt-ie7" lang="en-us"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie10 lt-ie9 lt-ie8" lang="en-us"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie10 lt-ie9" lang="en-us"> <![endif]-->
<!--[if IE 9]> <html class="no-js lt-ie10 lt-ie9" lang="en-us"> <![endif]-->
<!--[if lt IE 10]> <html class="no-js lt-ie10" lang="en-us"> <![endif]-->
<!--[if !IE]> > <![endif]-->
<html class='no-js' lang='en'>
<!-- <![endif] -->
<head>
<title>
AAA JDBC &mdash;
oVirt
</title>
<meta charset='utf-8'>
<meta content='' name='description'>
<meta content='' name='author'>
<meta content='initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width' name='viewport'>

<link href='/images/favicon.ico' rel='shortcut icon'>
<link href='/images/apple-touch-icon-precomposed.png' rel='apple-touch-icon-precomposed'>
<link href='/images/apple-touch-icon-57x57-precomposed.png' rel='apple-touch-icon-precomposed' sizes='57x57'>
<link href='/images/apple-touch-icon-72x72-precomposed.png' rel='apple-touch-icon-precomposed' sizes='72x72'>
<link href='/images/apple-touch-icon-114x114-precomposed.png' rel='apple-touch-icon-precomposed' sizes='114x114'>
<link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet'>
<link href="/stylesheets/application.css?1560777611" rel="stylesheet" type="text/css" />
<link href="/stylesheets/print.css?1560777612" rel="stylesheet" type="text/css" media="print" />
</head>
<body class=' source-md'>
<header class='masthead hidden-print' id='branding' role='banner'>
<section class='hgroup'></section>
<div id='access'>
<nav id="mainNav" class="navbar-fixed-top affix-top navForMobileHack" style="font-family: 'Open Sans', sans-serif; display: flex; justify-content: center;">
      <a href="/"><img id="logo" style="float: left; margin-right: 70px; height: 40px; padding: 0; margin-top: 12px;" alt="oVirt" src="/images/logo.svg"></a>
      <div>
          <div class="navbar-header page-scroll" style="min-width: 170px">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#menu_id0980fddf">
                  <span class="sr-only">Toggle navigation</span> Menu <i class="fa fa-bars"></i>
              </button>
          </div>

          <!-- Collect the nav links, forms, and other content for toggling -->
          <div class="collapse navbar-collapse" id="menu_id0980fddf">

              <ul class="nav navbar-nav">
                  <li class="hidden active">
                      <a href="#page-top"></a>
                  </li>
<li role='menuitem'>
  <a href='/'>Home</a>
</li>

<li role='menuitem'>
  <a href='/download/'>Download</a>
</li>

<li role='menuitem'>
  <a href='/documentation/'>Documentation</a>
</li>

<li role='menuitem'>
  <a href='/develop/'>Developers</a>
</li>

<li role='menuitem'>
  <a href='/community/'>Community</a>
</li>

<li role='menuitem'>
  <a href='//lists.ovirt.org/archives/'>Forum</a>
</li>

<li role='menuitem'>
  <a href='/blog/'>Blog</a>
</li>

              </ul>
          </div>
          <!-- /.navbar-collapse -->
      </div>
      <!-- /.container-fluid -->
  </nav>

</div>
</header>

<section class='page-wrap' id='page-wrap'>
<section class='page' id='page'>
<ul class='breadcrumb'>
<li><a href="/develop/">Develop</a></li>
<li><a href="/develop/release-management/">Release-management</a></li>
<li><a href="/develop/release-management/features/">Features</a></li>
<li><a href="/develop/release-management/features/infra/">Infra</a></li>
</ul>

<section class='container content' id='content'>
<div class='alert alert-warning'>
Feature pages are design documents that developers have created while collaborating on oVirt.
<br>
<br>
Most of them are
<strong>
outdated
</strong>
, but provide historical design context.
<br>
<br>
They are
<strong>
not
</strong>
user documentation and should not be treated as such.
<br>
<br>
<a href='/documentation/'>Documentation is available here.</a>
</div>
<h1 id="aaa-jdbc">AAA JDBC</h1>

<h2 id="summary">Summary</h2>

<p>AAA-JDBC is an extension which allows to store authentication and authorization data in relational database and provides these data using standardized oVirt AAA API similarly to already existing AAA-LDAP extension.</p>

<h2 id="owner">Owner</h2>

<ul>
  <li>Martin Peřina <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#109;&#112;&#101;&#114;&#105;&#110;&#097;&#064;&#114;&#101;&#100;&#104;&#097;&#116;&#046;&#099;&#111;&#109;">&#109;&#112;&#101;&#114;&#105;&#110;&#097;&#064;&#114;&#101;&#100;&#104;&#097;&#116;&#046;&#099;&#111;&#109;</a></li>
  <li>Alon Bar Lev <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#097;&#108;&#111;&#110;&#098;&#108;&#064;&#114;&#101;&#100;&#104;&#097;&#116;&#046;&#099;&#111;&#109;">&#097;&#108;&#111;&#110;&#098;&#108;&#064;&#114;&#101;&#100;&#104;&#097;&#116;&#046;&#099;&#111;&#109;</a></li>
  <li>Mooli Tayer <a href="&#109;&#097;&#105;&#108;&#116;&#111;:&#109;&#116;&#097;&#121;&#101;&#114;&#064;&#114;&#101;&#100;&#104;&#097;&#116;&#046;&#099;&#111;&#109;">&#109;&#116;&#097;&#121;&#101;&#114;&#064;&#114;&#101;&#100;&#104;&#097;&#116;&#046;&#099;&#111;&#109;</a></li>
</ul>

<h2 id="detailed-description">Detailed Description</h2>

<ul>
  <li>Provides complete users/groups/passwords management</li>
  <li>Stores users/groups/passwords in PostgreSQL database</li>
  <li>Provides management command line tool ovirt-aaa-jdbc-tool</li>
  <li>Provides thous users/groups/passwords data in oVirt using standard AAA Extension API</li>
  <li>Updated users/groups/passwords are immediately visible in oVirt withtout the need to restart engine service</li>
  <li>Allows to provided multiple domains stored in local or remote database</li>
  <li>By default in oVirt 3.6 <strong>internal</strong> domain is provided using AAA-JDBC extension</li>
</ul>

<h2 id="installation">Installation</h2>

<p>The extension resides in the <strong>ovirt-engine-extension-aaa-jdbc</strong> package. All you have to do is to install the package and run <strong>engine-setup</strong> again:</p>

<div class="highlight"><pre class="highlight plaintext"><code># dnf install ovirt-engine-extension-aaa-jdbc&#x000A;# engine-setup&#x000A;</code></pre></div>
<p>The engine-setup command will create the required database schema, migrate the existing admin user there and will finally populate the configuration for the main configuration tool <strong>ovirt-aaa-jdbc-tool</strong>.</p>

<h2 id="user-management">User management</h2>

<h3 id="creating-a-user">Creating a user</h3>

<div class="highlight"><pre class="highlight plaintext"><code>ovirt-aaa-jdbc-tool user add jdoe \&#x000A;    --attribute=firstName=John \&#x000A;    --attribute=lastName=Doe \&#x000A;    --attribute=email=jdoe@unknown.com&#x000A;</code></pre></div>
<p>Only username is mandatory, other attributes are optional. Following attributes can be specified for user:</p>

<ul>
  <li>department</li>
  <li>description</li>
  <li>displayName</li>
  <li>email</li>
  <li>firstName</li>
  <li>lastName</li>
  <li>title</li>
</ul>

<p><strong>ATTENTION:</strong> Newly created users are unable to login until <a href="#Password_management"> password-reset</a> command is executed on them.</p>

<h3 id="showing-details-about-existing-user">Showing details about existing user</h3>

<div class="highlight"><pre class="highlight plaintext"><code>ovirt-aaa-jdbc-tool user show jdoe&#x000A;</code></pre></div>
<p>Here are details of specified user:</p>

<div class="highlight"><pre class="highlight plaintext"><code>-- User jdoe(fc5b1c8b-d668-4a2c-98c8-a176c093a242) --&#x000A;namespace: *&#x000A;name: jdoe&#x000A;id: fc5b1c8b-d668-4a2c-98c8-a176c093a242&#x000A;display name: &#x000A;email: jdoe@unknown.com&#x000A;first name: John&#x000A;last name: Doe&#x000A;department: &#x000A;title: &#x000A;description:&#x000A;</code></pre></div>
<h3 id="updating-existing-user">Updating existing user</h3>

<p>Following command updates display name:</p>

<div class="highlight"><pre class="highlight plaintext"><code>ovirt-aaa-jdbc-tool user edit jdoe \&#x000A;    --attribute="displayName=John Doe"&#x000A;</code></pre></div>
<h3 id="removing-existing-user">Removing existing user</h3>

<div class="highlight"><pre class="highlight plaintext"><code>ovirt-aaa-jdbc-tool user delete jdoe&#x000A;</code></pre></div>
<h3 id="enablingdisabling-user">Enabling/Disabling user</h3>

<p>User can be disabled to prevent login by:</p>

<div class="highlight"><pre class="highlight plaintext"><code>ovirt-aaa-jdbc-tool user edit jdoe --flag=+disabled&#x000A;</code></pre></div>
<p>And following command enables the user again:</p>

<div class="highlight"><pre class="highlight plaintext"><code>ovirt-aaa-jdbc-tool user edit jdoe --flag=-disabled&#x000A;</code></pre></div>
<h3 id="unlocking-locked-user">Unlocking locked user</h3>

<p>User can be locked for example if there are too many unsuccessful logins. Following command unlocks user:</p>

<div class="highlight"><pre class="highlight plaintext"><code>ovirt-aaa-jdbc-tool user unlock jdoe&#x000A;</code></pre></div>
<h2 id="password-management">Password management</h2>

<p>Following command sets new password for user jdoe interactively:</p>

<div class="highlight"><pre class="highlight plaintext"><code>ovirt-aaa-jdbc-tool user password-reset jdoe&#x000A;</code></pre></div>
<p>Following types of entering password are supported using <strong>–password</strong> option:</p>

<ul>
  <li><strong>interactive</strong> - tool prompts to enter password</li>
  <li><strong>pass:STRING</strong> - password is specified on command line</li>
  <li><strong>env:KEY</strong> - password is specified in <strong>ENV</strong> environment variable</li>
  <li>**<file:FILE>** - password is read from specified file</file:FILE></li>
  <li><strong>none:</strong> - sets empty password</li>
</ul>

<p><strong>ATTENTION</strong>: By default password expires at the same moment as it's specified. Following command sets new password and password expiration date to August 15th 2025 10:30:00 UTC:</p>

<div class="highlight"><pre class="highlight plaintext"><code>ovirt-aaa-jdbc-tool user password-reset jdoe --password-valid-to="2025-08-15 10:30:00Z"&#x000A;</code></pre></div>
<h2 id="group-management">Group management</h2>

<h3 id="creating-a-group">Creating a group</h3>

<div class="highlight"><pre class="highlight plaintext"><code>ovirt-aaa-jdbc-tool group add group1 \&#x000A;    --attribute="description=First group"&#x000A;</code></pre></div>
<p>Only groupname is mandatory, other attributes are optional. Following attributes can be specified for group:</p>

<ul>
  <li>description</li>
  <li>displayName</li>
</ul>

<h3 id="showing-details-about-existing-group">Showing details about existing group</h3>

<div class="highlight"><pre class="highlight plaintext"><code>ovirt-aaa-jdbc-tool group show group1&#x000A;</code></pre></div>
<p>Here are details of specified group:</p>

<div class="highlight"><pre class="highlight plaintext"><code>-- Group group1(061a2ec0-9204-43a1-affe-ba717004c0f5) --&#x000A;namespace: *&#x000A;name: group1&#x000A;id: 061a2ec0-9204-43a1-affe-ba717004c0f5&#x000A;display name: &#x000A;description: First group&#x000A;</code></pre></div>
<h3 id="updating-existing-group">Updating existing group</h3>

<p>Following command updates display name:</p>

<div class="highlight"><pre class="highlight plaintext"><code>ovirt-aaa-jdbc-tool group edit group1 \&#x000A;    --attribute="displayName=Group 1"&#x000A;</code></pre></div>
<h3 id="removing-existing-group">Removing existing group</h3>

<div class="highlight"><pre class="highlight plaintext"><code>ovirt-aaa-jdbc-tool group delete group1&#x000A;</code></pre></div>
<h2 id="group-membership-management">Group membership management</h2>

<h3 id="adding-user-to-group">Adding user to group</h3>

<p>Following command add user <strong>jdoe</strong> into group <strong>group1</strong>:</p>

<div class="highlight"><pre class="highlight plaintext"><code>ovirt-aaa-jdbc-tool group-manage useradd group1 --user=jdoe&#x000A;</code></pre></div>
<h3 id="showing-members-of-group">Showing members of group</h3>

<div class="highlight"><pre class="highlight plaintext"><code>ovirt-aaa-jdbc-tool group-manage show group1&#x000A;</code></pre></div>
<h3 id="removing-user-from-group">Removing user from group</h3>

<p>Following command removes user <strong>jdoe</strong> from group <strong>group1</strong>:</p>

<div class="highlight"><pre class="highlight plaintext"><code>ovirt-aaa-jdbc-tool group-manage userdel group1 --user=jdoe&#x000A;</code></pre></div>
<h3 id="adding-group-to-group">Adding group to group</h3>

<p>Following command add group <strong>group2</strong> into group <strong>group1</strong>:</p>

<div class="highlight"><pre class="highlight plaintext"><code>ovirt-aaa-jdbc-tool group-manage groupadd group1 --group=group2&#x000A;</code></pre></div>
<h3 id="removing-group-from-group">Removing group from group</h3>

<p>Following command removes group <strong>group2</strong> from group <strong>group1</strong>:</p>

<div class="highlight"><pre class="highlight plaintext"><code>ovirt-aaa-jdbc-tool group-manage groupdel group1 --group=group2&#x000A;</code></pre></div>
<h2 id="searching-usersgroups">Searching users/groups</h2>

<h3 id="seraching-users">Seraching users</h3>

<p>Following command displays all existing users:</p>

<div class="highlight"><pre class="highlight plaintext"><code>ovirt-aaa-jdbc-tool query --what=user&#x000A;</code></pre></div>
<p>To narrow results following user attributes can be used:</p>

<ul>
  <li>department</li>
  <li>description</li>
  <li>displayName</li>
  <li>email</li>
  <li>firstName</li>
  <li>id</li>
  <li>lastName</li>
  <li>name</li>
  <li>title</li>
</ul>

<p>For example following command searches for users which username starts with <strong>j</strong>:</p>

<div class="highlight"><pre class="highlight plaintext"><code>ovirt-aaa-jdbc-tool query --what=user --pattern="name=j*"&#x000A;</code></pre></div>
<h3 id="seraching-groups">Seraching groups</h3>

<p>Following command displays all existing groups:</p>

<div class="highlight"><pre class="highlight plaintext"><code>ovirt-aaa-jdbc-tool query --what=group&#x000A;</code></pre></div>
<p>To narrow results following group attributes can be used:</p>

<ul>
  <li>description</li>
  <li>displayName</li>
  <li>name</li>
</ul>

<p>For example following command searches for groups which name starts with <strong>gr</strong>:</p>

<div class="highlight"><pre class="highlight plaintext"><code>ovirt-aaa-jdbc-tool query --what=group --pattern="name=gr*"&#x000A;</code></pre></div>
<h2 id="settings">Settings</h2>

<p>AAA-JDBC extension settings can be displayed using:</p>

<div class="highlight"><pre class="highlight plaintext"><code>ovirt-aaa-jdbc-tool settings show&#x000A;</code></pre></div>
<p>Following command updates setting PASSWORD_EXPIRATION_DAYS:</p>

<div class="highlight"><pre class="highlight plaintext"><code>ovirt-aaa-jdbc-tool settings set --name=PASSWORD_EXPIRATION_DAYS --value=365&#x000A;</code></pre></div>
<h2 id="configuration-of-additional-domains">Configuration of additional domains</h2>

<p><strong>ATTENTION:</strong> Most up-to-date documentation can be found at README.admin inside ovirt-engine-extension-aaa-jdbc package.</p>

<p>To configure a new profile which uses aaa-jdbc extension please execute following steps:</p>

<ol>
  <li><code> Setup database for aaa-jdbc extension</code>
<code> </code>
    <div>
      <p>Please replace DB_NAME, DB_USER and DB_PASSWORD with real values:</p>

    </div>
<div class="highlight"><pre class="highlight plaintext"><code>su - postgres -c "psql -d template1 &lt;&lt; __EOF__&#x000A;create user DB_USER password 'DB_PASSWORD';&#x000A;create database DB_NAME owner DB_USER template template0&#x000A;encoding 'UTF8' lc_collate 'en_US.UTF-8' lc_ctype 'en_US.UTF-8';&#x000A;__EOF__&#x000A;"&#x000A;</code></pre></div></li>
  <li><code> Configure PostgreSQL</code>
<code> </code>
    <div>
      <p>Please add following line into /var/lib/pgsql/data/pg_hba.conf (please replace DB_NAME and DB_USER with real values):</p>

    </div>
<div class="highlight"><pre class="highlight plaintext"><code>host    DB_NAME    DB_USER    0.0.0.0/0       md5&#x000A;host    DB_NAME    DB_USER    ::0/0           md5&#x000A;</code></pre></div>
    <div>
      <p>These line must be located prior to following lines:</p>

    </div>
<div class="highlight"><pre class="highlight plaintext"><code>host    all        all        127.0.0.1/32    ident&#x000A;host    all        all        ::1/128         ident&#x000A;</code></pre></div>
    <div>
      <p>After that please restart postgresql service.</p>

    </div>
  </li>
  <li><code> Populate database for aaa-jdbc extension</code>
<code> </code>
    <div>
      <p>Please replace DB_HOST, DB_NAME, DB_USER and DB_PASSWORD with real values:</p>

    </div>
<div class="highlight"><pre class="highlight plaintext"><code>PGPASSWORD="DB_PASSWORD" \&#x000A;    /usr/share/ovirt-engine-extension-aaa-jdbc/dbscripts/schema.sh \&#x000A;    -s DB_HOST \&#x000A;    -p DB_PORT \&#x000A;    -d DB_NAME \&#x000A;    -u DB_USER \&#x000A;    -c apply&#x000A;</code></pre></div></li>
  <li><code> Setup AAA profile</code>
<code> </code>
    <div>
      <p>Select name of your profile (it will be visible to users during login) and copy example configuration files and rename according to your PROFILE (replace PROFILE with selected value):</p>

    </div>
<div class="highlight"><pre class="highlight plaintext"><code>cp /usr/share/ovirt-engine-extension-aaa-jdbc/examples/extension.d/authn.properties \&#x000A;    /etc/ovirt-engine/extensions.d/PROFILE-authn.properties&#x000A;cp /usr/share/ovirt-engine-extension-aaa-jdbc/examples/extension.d/authz.properties \&#x000A;    /etc/ovirt-engine/extensions.d/PROFILE-authz.properties&#x000A;cp /usr/share/ovirt-engine-extension-aaa-jdbc/examples/aaa/profile.properties \&#x000A;    /etc/ovirt-engine/aaa/PROFILE.properties&#x000A;</code></pre></div>
    <div>
      <p>Edit created PROFILE*.properties files and replace variables surrounded by @ with real values.</p>

    </div>
  </li>
  <li>Restart ovirt-engine service and check /var/log/ovirt-engine/engine.log to see if extension is initialized successfully according to PROFILE.</li>
  <li><code> Setup users and groups</code>
<code> </code>
    <div>
      <p>Setup your users and groups using ovirt-aaa-jdbc-tool and specify database configuration using –db-config command line option:</p>

    </div>
<div class="highlight"><pre class="highlight plaintext"><code>ovirt-aaa-jdbc-tool \&#x000A;    --db-config=/etc/ovirt-engine/aaa/PROFILE.properties \&#x000A;    OPTIONS&#x000A;</code></pre></div></li>
  <li>Login to webadmin using existing administrator account and assign desired permissions to users/groups defined in your PROFILE</li>
</ol>


</section>
</section>
</section>
<footer class='text-center' id='footer'>
<hr class='visible-print'>
<ul class='footer-nav-list'>
<li><a target="_blank" href="../../../../site/privacy-policy.html">Privacy policy</a></li>
<li><a target="_blank" href="../../../../community/about.html">About</a></li>
<li><a target="_blank" href="../../../../site/general-disclaimer.html">Disclaimers</a></li>
</ul>

&copy; 2013&ndash;2019 oVirt
<div class='edit-this-page'>
<a target="_blank" href="https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/source/develop/release-management/features/infra/aaa-jdbc.html.md&amp;template="><i class="icon fa fa-github"></i>Report an issue with this page</a>
</div>
<div class='edit-this-page'>
<a target="_blank" href="https://github.com/oVirt/ovirt-site/edit/master/source/develop/release-management/features/infra/aaa-jdbc.html.md"><i class="icon fa fa-github"></i>Edit this page</a>
</div>
<div class='last-modified'>
Page last modified
Wed 12 Jul 2017 17:57 UTC
</div>
        <script type="text/javascript">
        var _paq = _paq || [];
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
        var u=(("https:" == document.location.protocol) ? "https" : "http") + "://stats.phx.ovirt.org/";
        _paq.push(['setTrackerUrl', u+'piwik.php']);
        _paq.push(['setSiteId', 1]);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0]; g.type='text/javascript';
        g.defer=true; g.async=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
        })();
        </script>
<noscript><p><img src="https://stats.phx.ovirt.org/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
</footer>


<script src="/javascripts/application.js?1560777657" type="text/javascript"></script>

</body>
</html>
